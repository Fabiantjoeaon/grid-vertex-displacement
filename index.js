!function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[a]={exports:{}};t[a][0].call(f.exports,function(e){return i(t[a][1][e]||e)},f,f.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}}()({1:[function(e,t,n){t.exports={random:e("./random"),math:e("./math")}},{"./math":2,"./random":3}],2:[function(e,t,n){var r=e("defined"),i=Number.EPSILON;function o(e,t,n){return t<n?e<t?t:e>n?n:e:e<n?n:e>t?t:e}function a(e,t,n){return e*(1-n)+t*n}function s(e,t,n){return Math.abs(e-t)<i?0:(n-e)/(t-e)}function u(e,t){return t=r(t,0),"number"==typeof e&&isFinite(e)?e:t}function c(e){if("number"!=typeof e)throw new TypeError("Expected dims argument");return function(t,n){var i;n=r(n,0),null==t?i=n:"number"==typeof t&&isFinite(t)&&(i=t);var o,a=[];if(null==i)for(o=0;o<e;o++)a[o]=u(t[o],n);else for(o=0;o<e;o++)a[o]=i;return a}}function f(e,t,n,r){if(r=r||[],e.length!==t.length)throw new TypeError("min and max array are expected to have the same length");for(var i=0;i<e.length;i++)r[i]=a(e[i],t[i],n);return r}function l(e,t){if("number"!=typeof(e=r(e,0)))throw new TypeError("Expected n argument to be a number");for(var n=[],i=0;i<e;i++)n.push(t);return n}function d(e,t){return(e%t+t)%t}function p(e,t,n,r){return a(e,t,1-Math.exp(-n*r))}t.exports={mod:d,fract:function(e){return e-Math.floor(e)},sign:function(e){return e>0?1:e<0?-1:0},degToRad:function(e){return e*Math.PI/180},radToDeg:function(e){return 180*e/Math.PI},wrap:function(e,t,n){if("number"!=typeof t||"number"!=typeof n)throw new TypeError('Must specify "to" and "from" arguments as numbers');if(t>n){var r=t;t=n,n=r}var i=n-t;return 0===i?n:e-i*Math.floor((e-t)/i)},pingPong:function(e,t){return e=d(e,2*t),t-Math.abs(e-t)},linspace:function(e,t){if("number"!=typeof(e=r(e,0)))throw new TypeError("Expected n argument to be a number");"boolean"==typeof(t=t||{})&&(t={endpoint:!0});var n=r(t.offset,0);return t.endpoint?l(e).map(function(t,r){return e<=1?0:(r+n)/(e-1)}):l(e).map(function(t,r){return(r+n)/e})},lerp:a,lerpArray:f,inverseLerp:s,lerpFrames:function(e,t,n){t=o(t,0,1);var r=e.length-1,i=t*r,s=Math.floor(i),u=i-s,c=Math.min(s+1,r),l=e[s%e.length],d=e[c%e.length];if("number"==typeof l&&"number"==typeof d)return a(l,d,u);if(Array.isArray(l)&&Array.isArray(d))return f(l,d,u,n);throw new TypeError("Mismatch in value type of two array elements: "+s+" and "+c)},clamp:o,clamp01:function(e){return o(e,0,1)},smoothstep:function(e,t,n){var r=o(s(e,t,n),0,1);return r*r*(3-2*r)},damp:p,dampArray:function(e,t,n,r,i){i=i||[];for(var o=0;o<e.length;o++)i[o]=p(e[o],t[o],n,r);return i},mapRange:function(e,t,n,r,o,a){if(Math.abs(t-n)<i)return r;var s=(e-t)/(n-t)*(o-r)+r;return a&&(o<r?s<o?s=o:s>r&&(s=r):s>o?s=o:s<r&&(s=r)),s},expand2D:c(2),expand3D:c(3),expand4D:c(4)}},{defined:7}],3:[function(e,t,n){var r=e("seed-random"),i=e("simplex-noise"),o=e("defined");t.exports=function e(t){t=o(t,null);var n,a,s,u=Math.random,c=null,f=!1;return l(t),{value:d,createRandom:function(t){return e(t)},setSeed:l,getSeed:function(){return n},getRandomSeed:function(){return String(Math.floor(1e6*Math.random()))},valueNonZero:function(){for(var e=0;0===e;)e=d();return e},permuteNoise:function(){s=p()},noise1D:function(e,t,n){if(!isFinite(e))throw new TypeError("x component for noise() must be finite");return t=o(t,1),(n=o(n,1))*s.noise2D(e*t,0)},noise2D:function(e,t,n,r){if(!isFinite(e))throw new TypeError("x component for noise() must be finite");if(!isFinite(t))throw new TypeError("y component for noise() must be finite");return n=o(n,1),(r=o(r,1))*s.noise2D(e*n,t*n)},noise3D:function(e,t,n,r,i){if(!isFinite(e))throw new TypeError("x component for noise() must be finite");if(!isFinite(t))throw new TypeError("y component for noise() must be finite");if(!isFinite(n))throw new TypeError("z component for noise() must be finite");return r=o(r,1),(i=o(i,1))*s.noise3D(e*r,t*r,n*r)},noise4D:function(e,t,n,r,i,a){if(!isFinite(e))throw new TypeError("x component for noise() must be finite");if(!isFinite(t))throw new TypeError("y component for noise() must be finite");if(!isFinite(n))throw new TypeError("z component for noise() must be finite");if(!isFinite(r))throw new TypeError("w component for noise() must be finite");return i=o(i,1),(a=o(a,1))*s.noise4D(e*i,t*i,n*i,r*i)},sign:function(){return h()?1:-1},boolean:h,chance:function(e){if("number"!=typeof(e=o(e,.5)))throw new TypeError("expected n to be a number");return d()<e},range:m,rangeFloor:g,pick:function(e){return 0===e.length?void 0:e[g(0,e.length)]},shuffle:function(e){if(!Array.isArray(e))throw new TypeError("Expected Array, got "+typeof e);for(var t,n,r=e.length,i=e.slice();r;)t=Math.floor(d()*r--),n=i[r],i[r]=i[t],i[t]=n;return i},onCircle:v,insideCircle:function(e,t){e=o(e,1),v(1,t=t||[]);var n=e*Math.sqrt(d());return t[0]*=n,t[1]*=n,t},onSphere:function(e,t){e=o(e,1),t=t||[];var n=d()*Math.PI*2,r=2*d()-1,i=n,a=Math.acos(r);return t[0]=e*Math.sin(a)*Math.cos(i),t[1]=e*Math.sin(a)*Math.sin(i),t[2]=e*Math.cos(a),t},insideSphere:function(e,t){e=o(e,1),t=t||[];var n=d()*Math.PI*2,r=2*d()-1,i=d(),a=n,s=Math.acos(r),u=e*Math.cbrt(i);return t[0]=u*Math.sin(s)*Math.cos(a),t[1]=u*Math.sin(s)*Math.sin(a),t[2]=u*Math.cos(s),t},quaternion:function(e){e=e||[];var t=d(),n=d(),r=d(),i=Math.sqrt(1-t),o=Math.sqrt(t),a=2*Math.PI*n,s=2*Math.PI*r,u=Math.sin(a)*i,c=Math.cos(a)*i,f=Math.sin(s)*o,l=Math.cos(s)*o;return e[0]=u,e[1]=c,e[2]=f,e[3]=l,e},weighted:y,weightedSet:function(e){return 0===(e=e||[]).length?null:e[b(e)].value},weightedSetIndex:b,gaussian:function(e,t){if(e=o(e,0),t=o(t,1),f){f=!1;var n=c;return c=null,e+t*n}var r=0,i=0,a=0;do{r=2*d()-1,i=2*d()-1,a=r*r+i*i}while(a>=1||0===a);var s=Math.sqrt(-2*Math.log(a)/a);return c=i*s,f=!0,e+t*(r*s)}};function l(e,t){"number"==typeof e||"string"==typeof e?a=r(n=e,t):(n=void 0,a=u),s=p(),c=null,f=!1}function d(){return a()}function p(){return new i(a)}function h(){return d()>.5}function m(e,t){if(void 0===t&&(t=e,e=0),"number"!=typeof e||"number"!=typeof t)throw new TypeError("Expected all arguments to be numbers");return d()*(t-e)+e}function g(e,t){if(void 0===t&&(t=e,e=0),"number"!=typeof e||"number"!=typeof t)throw new TypeError("Expected all arguments to be numbers");return Math.floor(m(e,t))}function v(e,t){e=o(e,1),t=t||[];var n=2*d()*Math.PI;return t[0]=e*Math.cos(n),t[1]=e*Math.sin(n),t}function b(e){return 0===(e=e||[]).length?-1:y(e.map(function(e){return e.weight}))}function y(e){if(0===(e=e||[]).length)return-1;var t,n=0;for(t=0;t<e.length;t++)n+=e[t];if(n<=0)throw new Error("Weights must sum to > 0");var r=d()*n;for(t=0;t<e.length;t++){if(r<e[t])return t;r-=e[t]}return 0}}()},{defined:7,"seed-random":60,"simplex-noise":61}],4:[function(e,t,n){(function(r){!function(r,i){"object"==typeof n&&void 0!==t?t.exports=i(e("convert-length")):"function"==typeof define&&define.amd?define(["convert-length"],i):r.canvasSketch=i(null)}(this,function(e){e=e&&e.hasOwnProperty("default")?e.default:e;var t=function(){for(var e=0;e<arguments.length;e++)if(void 0!==arguments[e])return arguments[e]},n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;var a=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(e){r[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var r,a,s=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),u=1;u<arguments.length;u++){for(var c in r=Object(arguments[u]))i.call(r,c)&&(s[c]=r[c]);if(n){a=n(r);for(var f=0;f<a.length;f++)o.call(r,a[f])&&(s[a[f]]=r[a[f]])}}return s},s="undefined"!=typeof window?window:void 0!==r?r:"undefined"!=typeof self?self:{};function u(e,t){return e(t={exports:{}},t.exports),t.exports}var c=s.performance&&s.performance.now?function(){return performance.now()}:Date.now||function(){return+new Date},f=function(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then};var l=function(e){return!(!e||"object"!=typeof e)&&("object"==typeof window&&"object"==typeof window.Node?e instanceof window.Node:"number"==typeof e.nodeType&&"string"==typeof e.nodeName)};function d(){return"undefined"!=typeof window&&window["canvas-sketch-cli"]}function p(){return"undefined"!=typeof document}var h,m=u(function(e,t){function n(e){var t=[];for(var n in e)t.push(n);return t}(e.exports="function"==typeof Object.keys?Object.keys:n).shim=n}),g=u(function(e,t){var n="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();function r(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function i(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Object.prototype.hasOwnProperty.call(e,"callee")&&!Object.prototype.propertyIsEnumerable.call(e,"callee")||!1}(t=e.exports=n?r:i).supported=r,t.unsupported=i}),v=u(function(e){var t=Array.prototype.slice,n=e.exports=function(e,o,a){return a||(a={}),e===o||(e instanceof Date&&o instanceof Date?e.getTime()===o.getTime():!e||!o||"object"!=typeof e&&"object"!=typeof o?a.strict?e===o:e==o:function(e,o,a){var s,u;if(r(e)||r(o))return!1;if(e.prototype!==o.prototype)return!1;if(g(e))return!!g(o)&&(e=t.call(e),o=t.call(o),n(e,o,a));if(i(e)){if(!i(o))return!1;if(e.length!==o.length)return!1;for(s=0;s<e.length;s++)if(e[s]!==o[s])return!1;return!0}try{var c=m(e),f=m(o)}catch(e){return!1}if(c.length!=f.length)return!1;for(c.sort(),f.sort(),s=c.length-1;s>=0;s--)if(c[s]!=f[s])return!1;for(s=c.length-1;s>=0;s--)if(!n(e[u=c[s]],o[u],a))return!1;return typeof e==typeof o}(e,o,a))};function r(e){return null==e}function i(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length)&&("function"==typeof e.copy&&"function"==typeof e.slice&&!(e.length>0&&"number"!=typeof e[0]))}}),b=u(function(e,t){!function(t){var n,r,i,o=(n=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|"[^"]*"|'[^']*'/g,r=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,i=/[^-+\dA-Z]/g,function(e,t,s,u){if(1!==arguments.length||"string"!==(null===(c=e)?"null":void 0===c?"undefined":"object"!=typeof c?typeof c:Array.isArray(c)?"array":{}.toString.call(c).slice(8,-1).toLowerCase())||/\d/.test(e)||(t=e,e=void 0),(e=e||new Date)instanceof Date||(e=new Date(e)),isNaN(e))throw TypeError("Invalid date");var c,f=(t=String(o.masks[t]||t||o.masks.default)).slice(0,4);"UTC:"!==f&&"GMT:"!==f||(t=t.slice(4),s=!0,"GMT:"===f&&(u=!0));var l=s?"getUTC":"get",d=e[l+"Date"](),p=e[l+"Day"](),h=e[l+"Month"](),m=e[l+"FullYear"](),g=e[l+"Hours"](),v=e[l+"Minutes"](),b=e[l+"Seconds"](),y=e[l+"Milliseconds"](),_=s?0:e.getTimezoneOffset(),w=function(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate());t.setDate(t.getDate()-(t.getDay()+6)%7+3);var n=new Date(t.getFullYear(),0,4);n.setDate(n.getDate()-(n.getDay()+6)%7+3);var r=t.getTimezoneOffset()-n.getTimezoneOffset();return t.setHours(t.getHours()-r),1+Math.floor((t-n)/6048e5)}(e),x=function(e){var t=e.getDay();return 0===t&&(t=7),t}(e),k={d:d,dd:a(d),ddd:o.i18n.dayNames[p],dddd:o.i18n.dayNames[p+7],m:h+1,mm:a(h+1),mmm:o.i18n.monthNames[h],mmmm:o.i18n.monthNames[h+12],yy:String(m).slice(2),yyyy:m,h:g%12||12,hh:a(g%12||12),H:g,HH:a(g),M:v,MM:a(v),s:b,ss:a(b),l:a(y,3),L:a(Math.round(y/10)),t:g<12?o.i18n.timeNames[0]:o.i18n.timeNames[1],tt:g<12?o.i18n.timeNames[2]:o.i18n.timeNames[3],T:g<12?o.i18n.timeNames[4]:o.i18n.timeNames[5],TT:g<12?o.i18n.timeNames[6]:o.i18n.timeNames[7],Z:u?"GMT":s?"UTC":(String(e).match(r)||[""]).pop().replace(i,""),o:(_>0?"-":"+")+a(100*Math.floor(Math.abs(_)/60)+Math.abs(_)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!=10)*d%10],W:w,N:x};return t.replace(n,function(e){return e in k?k[e]:e.slice(1,e.length-1)})});function a(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e}o.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},o.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]},e.exports=o}()}),y="",_=function(e,t){if("string"!=typeof e)throw new TypeError("expected a string");if(1===t)return e;if(2===t)return e+e;var n=e.length*t;if(h!==e||void 0===h)h=e,y="";else if(y.length>=n)return y.substr(0,n);for(;n>y.length&&t>1;)1&t&&(y+=e),t>>=1,e+=e;return y=(y+=e).substr(0,n)};var w,x=function(e,t,n){return e=e.toString(),void 0===t?e:(n=0===n?"0":n?n.toString():" ",_(n,t-e.length)+e)},k=function(){},A=["image/png","image/jpeg","image/webp"];function E(e,t){return void 0===t&&(t={}),function(e){return new Promise(function(t){var n=e.indexOf(",");if(-1!==n){for(var r=e.slice(n+1),i=window.atob(r),o=/data:([^;+]);/.exec(e),a=(o?o[1]:"")||void 0,s=new ArrayBuffer(i.length),u=new Uint8Array(s),c=0;c<i.length;c++)u[c]=i.charCodeAt(c);t(new window.Blob([s],{type:a}))}else t(new window.Blob)})}(e).then(function(e){return C(e,t)})}function C(e,t){return void 0===t&&(t={}),new Promise(function(n){var r=function(e){void 0===e&&(e={});if("function"==typeof(e=a({},e)).file)return e.file(e);if(e.file)return e.file;var t=null,n="";"string"==typeof e.extension&&(n=e.extension);if("number"==typeof e.frame){var r;r="number"==typeof e.totalFrames?e.totalFrames:Math.max(1e3,e.frame),t=x(String(e.frame),String(r).length,"0")}var i=isFinite(e.totalLayers)&&isFinite(e.layer)&&e.totalLayers>1?""+e.layer:"";if(null!=t)return[i,t].filter(Boolean).join("-")+n;var o=e.timeStamp;return[e.prefix,e.name||o,i,e.hash,e.suffix].filter(Boolean).join("-")+n}(t=a({extension:"",prefix:"",suffix:""},t)),i=d();if(i&&"function"==typeof i.saveBlob&&i.output)return i.saveBlob(e,a({},t,{filename:r})).then(function(e){return n(e)});w||((w=document.createElement("a")).style.visibility="hidden",w.target="_blank"),w.download=r,w.href=window.URL.createObjectURL(e),document.body.appendChild(w),w.onclick=function(){w.onclick=k,setTimeout(function(){window.URL.revokeObjectURL(e),document.body.removeChild(w),w.removeAttribute("href"),n({filename:r,client:!1})})},w.click()})}var S=[["postcard",101.6,152.4],["poster-small",280,430],["poster",460,610],["poster-large",610,910],["business-card",50.8,88.9],["a0",841,1189],["a1",594,841],["a2",420,594],["a3",297,420],["a4",210,297],["a5",148,210],["a6",105,148],["a7",74,105],["a8",52,74],["a9",37,52],["a10",26,37],["2a0",1189,1682],["4a0",1682,2378],["b0",1e3,1414],["b1",707,1e3],["b1+",720,1020],["b2",500,707],["b2+",520,720],["b3",353,500],["b4",250,353],["b5",176,250],["b6",125,176],["b7",88,125],["b8",62,88],["b9",44,62],["b10",31,44],["b11",22,32],["b12",16,22],["c0",917,1297],["c1",648,917],["c2",458,648],["c3",324,458],["c4",229,324],["c5",162,229],["c6",114,162],["c7",81,114],["c8",57,81],["c9",40,57],["c10",28,40],["c11",22,32],["c12",16,22],["half-letter",5.5,8.5,"in"],["letter",8.5,11,"in"],["legal",8.5,14,"in"],["junior-legal",5,8,"in"],["ledger",11,17,"in"],["tabloid",11,17,"in"],["ansi-a",8.5,11,"in"],["ansi-b",11,17,"in"],["ansi-c",17,22,"in"],["ansi-d",22,34,"in"],["ansi-e",34,44,"in"],["arch-a",9,12,"in"],["arch-b",12,18,"in"],["arch-c",18,24,"in"],["arch-d",24,36,"in"],["arch-e",36,48,"in"],["arch-e1",30,42,"in"],["arch-e2",26,38,"in"],["arch-e3",27,39,"in"]].reduce(function(e,t){var n={units:t[3]||"mm",dimensions:[t[1],t[2]]};return e[t[0]]=n,e[t[0].replace(/-/g," ")]=n,e},{});function T(t,n,r,i){return void 0===n&&(n="px"),void 0===r&&(r="px"),void 0===i&&(i=72),e(t,n,r,{pixelsPerInch:i,precision:4,roundPixel:!0})}function O(e,n){var r,i,o,a,s,u,c,f,l=n.dimensions,d=function(e){return!(!e.dimensions||"string"!=typeof e.dimensions&&!(Array.isArray(e.dimensions)&&e.dimensions.length>=2))}(n),h=e.exporting,m=!!d&&!1!==n.scaleToFit,g=!(!h&&d)||n.scaleToView,v=n.units,b="number"==typeof n.pixelsPerInch&&isFinite(n.pixelsPerInch)?n.pixelsPerInch:72,y=t(n.bleed,0),_=p()?window.devicePixelRatio:1,w=g?_:1;"number"==typeof n.pixelRatio&&isFinite(n.pixelRatio)?f=t(n.exportPixelRatio,c=n.pixelRatio):d?(c=w,f=t(n.exportPixelRatio,1)):f=t(n.exportPixelRatio,c=_),"number"==typeof n.maxPixelRatio&&isFinite(n.maxPixelRatio)&&(c=Math.min(n.maxPixelRatio,c),f=Math.min(n.maxPixelRatio,f)),h&&(c=f);var x,k,A=function(e,t){if(!p)return[300,150];var n=t.parent||window;if(n===window||n===document||n===document.body)return[window.innerWidth,window.innerHeight];var r=n.getBoundingClientRect();return[r.width,r.height]}(0,n),E=A[0],C=A[1];if(d){var O=function(e,t,n){if(void 0===t&&(t="px"),void 0===n&&(n=72),"string"==typeof e){var r=e.toLowerCase();if(!(r in S))throw new Error('The dimension preset "'+e+'" is not supported or could not be found; try using a4, a3, postcard, letter, etc.');var i=S[r];return i.dimensions.map(function(e){return T(e,i.units,t,n)})}return e}(l,v,b),D=Math.max(O[0],O[1]),M=Math.min(O[0],O[1]);if(n.orientation){var P="landscape"===n.orientation;r=P?D:M,i=P?M:D}else r=O[0],i=O[1];x=r,k=i,r+=2*y,i+=2*y}else x=r=E,k=i=C;var F=r,j=i;if(d&&v&&(F=T(r,v,"px",b),j=T(i,v,"px",b)),o=Math.round(F),a=Math.round(j),m&&!h&&d){var z=r/i,R=E/C,B=t(n.scaleToFitPadding,40),L=Math.round(E-2*B),I=Math.round(C-2*B);(o>L||a>I)&&(R>z?(a=I,o=Math.round(a*z)):(o=L,a=Math.round(o/z)))}return{bleed:y,pixelRatio:c,width:r,height:i,dimensions:[r,i],units:v||"px",scaleX:(s=g?Math.round(c*o):Math.round(f*F))/r,scaleY:(u=g?Math.round(c*a):Math.round(f*j))/i,viewportWidth:g?Math.round(o):Math.round(F),viewportHeight:g?Math.round(a):Math.round(j),canvasWidth:s,canvasHeight:u,trimWidth:x,trimHeight:k,styleWidth:o,styleHeight:a}}var D=function(e,t){if("string"!=typeof e)throw new TypeError("must specify type string");if(t=t||{},"undefined"==typeof document&&!t.canvas)return null;var n=t.canvas||document.createElement("canvas");"number"==typeof t.width&&(n.width=t.width);"number"==typeof t.height&&(n.height=t.height);var r,i=t;try{var o=[e];0===e.indexOf("webgl")&&o.push("experimental-"+e);for(var a=0;a<o.length;a++)if(r=n.getContext(o[a],i))return r}catch(e){r=null}return r||null};function M(e){var t,n;void 0===e&&(e={});var r=!1;if(!1!==e.canvas){if(!(t=e.context)||"string"==typeof t){var i=e.canvas;i||(i=function(){if(!p())throw new Error("It appears you are runing from Node.js or a non-browser environment. Try passing in an existing { canvas } interface instead.");return document.createElement("canvas")}(),r=!0);var o=t||"2d";if("function"!=typeof i.getContext)throw new Error("The specified { canvas } element does not have a getContext() function, maybe it is not a <canvas> tag?");if(!(t=D(o,a({},e.attributes,{canvas:i}))))throw new Error("Failed at canvas.getContext('"+o+"') - the browser may not support this context, or a different context may already be in use with this canvas.")}if(n=t.canvas,e.canvas&&n!==e.canvas)throw new Error("The { canvas } and { context } settings must point to the same underlying canvas element");e.pixelated&&(t.imageSmoothingEnabled=!1,t.mozImageSmoothingEnabled=!1,t.oImageSmoothingEnabled=!1,t.webkitImageSmoothingEnabled=!1,t.msImageSmoothingEnabled=!1,n.style["image-rendering"]="pixelated")}return{canvas:n,context:t,ownsCanvas:r}}var P=function(){var e=this;this._settings={},this._props={},this._sketch=void 0,this._raf=null,this._lastRedrawResult=void 0,this._isP5Resizing=!1,this._keyboardShortcuts=function(e){void 0===e&&(e={});var t=function(t){if(e.enabled()){var n=d();83!==t.keyCode||t.altKey||!t.metaKey&&!t.ctrlKey?32===t.keyCode?e.togglePlay(t):n&&!t.altKey&&75===t.keyCode&&(t.metaKey||t.ctrlKey)&&(t.preventDefault(),e.commit(t)):(t.preventDefault(),e.save(t))}};return{attach:function(){window.addEventListener("keydown",t)},detach:function(){window.removeEventListener("keydown",t)}}}({enabled:function(){return!1!==e.settings.hotkeys},save:function(t){t.shiftKey?e.props.recording?(e.endRecord(),e.run()):e.record():e.exportFrame()},togglePlay:function(){e.props.playing?e.pause():e.play()},commit:function(t){e.exportFrame({commit:!0})}}),this._animateHandler=function(){return e.animate()},this._resizeHandler=function(){e.resize()&&e.render()}},F={sketch:{configurable:!0},settings:{configurable:!0},props:{configurable:!0}};F.sketch.get=function(){return this._sketch},F.settings.get=function(){return this._settings},F.props.get=function(){return this._props},P.prototype._computePlayhead=function(e,t){return"number"==typeof t&&isFinite(t)?e/t:0},P.prototype._computeFrame=function(e,t,n,r){return isFinite(n)&&n>1?Math.floor(e*(n-1)):Math.floor(r*t)},P.prototype._computeCurrentFrame=function(){return this._computeFrame(this.props.playhead,this.props.time,this.props.totalFrames,this.props.fps)},P.prototype._getSizeProps=function(){var e=this.props;return{width:e.width,height:e.height,pixelRatio:e.pixelRatio,canvasWidth:e.canvasWidth,canvasHeight:e.canvasHeight,viewportWidth:e.viewportWidth,viewportHeight:e.viewportHeight}},P.prototype.run=function(){if(!this.sketch)throw new Error("should wait until sketch is loaded before trying to play()");return!1!==this.settings.playing&&this.play(),"function"==typeof this.sketch.dispose&&console.warn("In canvas-sketch@0.0.23 the dispose() event has been renamed to unload()"),this.props.started||(this._signalBegin(),this.props.started=!0),this.tick(),this.render(),this},P.prototype.play=function(){var e=this.settings.animate;"animation"in this.settings&&(e=!0,console.warn("[canvas-sketch] { animation } has been renamed to { animate }")),e&&(p()?this.props.playing||(this.props.started||(this._signalBegin(),this.props.started=!0),this.props.playing=!0,null!=this._raf&&window.cancelAnimationFrame(this._raf),this._lastTime=c(),this._raf=window.requestAnimationFrame(this._animateHandler)):console.error("[canvas-sketch] WARN: Using { animate } in Node.js is not yet supported"))},P.prototype.pause=function(){this.props.recording&&this.endRecord(),this.props.playing=!1,null!=this._raf&&p()&&window.cancelAnimationFrame(this._raf)},P.prototype.togglePlay=function(){this.props.playing?this.pause():this.play()},P.prototype.stop=function(){this.pause(),this.props.frame=0,this.props.playhead=0,this.props.time=0,this.props.deltaTime=0,this.props.started=!1,this.render()},P.prototype.record=function(){var e=this;if(!this.props.recording)if(p()){this.stop(),this.props.playing=!0,this.props.recording=!0;var t=1/this.props.fps;null!=this._raf&&window.cancelAnimationFrame(this._raf);var n=function(){return e.props.recording?(e.props.deltaTime=t,e.tick(),e.exportFrame({sequence:!0}).then(function(){e.props.recording&&(e.props.deltaTime=0,e.props.frame++,e.props.frame<e.props.totalFrames?(e.props.time+=t,e.props.playhead=e._computePlayhead(e.props.time,e.props.duration),e._raf=window.requestAnimationFrame(n)):(console.log("Finished recording"),e._signalEnd(),e.endRecord(),e.stop(),e.run()))})):Promise.resolve()};this.props.started||(this._signalBegin(),this.props.started=!0),this._raf=window.requestAnimationFrame(n)}else console.error("[canvas-sketch] WARN: Recording from Node.js is not yet supported")},P.prototype._signalBegin=function(){var e=this;this.sketch&&"function"==typeof this.sketch.begin&&this._wrapContextScale(function(t){return e.sketch.begin(t)})},P.prototype._signalEnd=function(){var e=this;this.sketch&&"function"==typeof this.sketch.end&&this._wrapContextScale(function(t){return e.sketch.end(t)})},P.prototype.endRecord=function(){null!=this._raf&&p()&&window.cancelAnimationFrame(this._raf),this.props.recording=!1,this.props.deltaTime=0,this.props.playing=!1},P.prototype.exportFrame=function(e){var t=this;if(void 0===e&&(e={}),!this.sketch)return Promise.all([]);"function"==typeof this.sketch.preExport&&this.sketch.preExport();var n=a({sequence:e.sequence,frame:e.sequence?this.props.frame:void 0,file:this.settings.file,name:this.settings.name,prefix:this.settings.prefix,suffix:this.settings.suffix,encoding:this.settings.encoding,encodingQuality:this.settings.encodingQuality,timeStamp:b(new Date,"yyyy.mm.dd-HH.MM.ss"),totalFrames:isFinite(this.props.totalFrames)?Math.max(100,this.props.totalFrames):1e3}),r=d(),i=Promise.resolve();if(r&&e.commit&&"function"==typeof r.commit){var o=a({},n),s=r.commit(o);i=f(s)?s:Promise.resolve(s)}return i.then(function(e){return t._doExportFrame(a({},n,{hash:e||""}))})},P.prototype._doExportFrame=function(e){var n=this;void 0===e&&(e={}),this._props.exporting=!0,this.resize();var r=this.render();return void 0===r&&(r=[this.props.canvas]),r=(r=[].concat(r).filter(Boolean)).map(function(n){var r,i="object"==typeof n&&n&&("data"in n||"dataURL"in n),o=i?n.data:n,s=i?a({},n,{data:o}):{data:o};if(l(r=o)&&/canvas/i.test(r.nodeName)&&"function"==typeof r.getContext){var u=function(e,t){void 0===t&&(t={});var n=t.encoding||"image/png";if(!A.includes(n))throw new Error("Invalid canvas encoding "+n);var r=(n.split("/")[1]||"").replace(/jpeg/i,"jpg");return r&&(r=("."+r).toLowerCase()),{extension:r,type:n,dataURL:e.toDataURL(n,t.encodingQuality)}}(o,{encoding:s.encoding||e.encoding,encodingQuality:t(s.encodingQuality,e.encodingQuality,.95)});return Object.assign(s,{dataURL:u.dataURL,extension:u.extension,type:u.type})}return s}),this._props.exporting=!1,this.resize(),this.render(),Promise.all(r.map(function(t,n,r){var i=a({},e,t,{layer:n,totalLayers:r.length}),o=t.data;if(t.dataURL){var s=t.dataURL;return delete i.dataURL,E(s,i)}return function(e,t){void 0===t&&(t={});var n=Array.isArray(e)?e:[e];return C(new window.Blob(n,{type:t.type||""}),t)}(o,i)})).then(function(t){if(t.length>0){var r,i=t.find(function(e){return e.outputName}),o=t.some(function(e){return e.client});r=t.length>1?t.length:i?i.outputName+"/"+t[0].filename:""+t[0].filename;var a="";if(e.sequence)a=isFinite(n.props.totalFrames)?" (frame "+(e.frame+1)+" / "+n.props.totalFrames+")":" (frame "+e.frame+")";else t.length>1&&(a=" files");console.log("%c["+(o?"canvas-sketch-cli":"canvas-sketch")+"]%c Exported %c"+r+"%c"+a,"color: #8e8e8e;","color: initial;","font-weight: bold;","font-weight: initial;")}"function"==typeof n.sketch.postExport&&n.sketch.postExport()})},P.prototype._wrapContextScale=function(e){this._preRender(),e(this.props),this._postRender()},P.prototype._preRender=function(){var e=this.props;this.props.gl||!e.context||e.p5?e.p5&&e.p5.scale(e.scaleX/e.pixelRatio,e.scaleY/e.pixelRatio):(e.context.save(),!1!==this.settings.scaleContext&&e.context.scale(e.scaleX,e.scaleY))},P.prototype._postRender=function(){var e=this.props;this.props.gl||!e.context||e.p5||e.context.restore(),e.gl&&!1!==this.settings.flush&&!e.p5&&e.gl.flush()},P.prototype.tick=function(){this.sketch&&"function"==typeof this.sketch.tick&&(this._preRender(),this.sketch.tick(this.props),this._postRender())},P.prototype.render=function(){return this.props.p5?(this._lastRedrawResult=void 0,this.props.p5.redraw(),this._lastRedrawResult):this.submitDrawCall()},P.prototype.submitDrawCall=function(){if(this.sketch){var e,t=this.props;return this._preRender(),"function"==typeof this.sketch?e=this.sketch(t):"function"==typeof this.sketch.render&&(e=this.sketch.render(t)),this._postRender(),e}},P.prototype.update=function(e){var t=this;void 0===e&&(e={});var n=["animate"];Object.keys(e).forEach(function(e){if(n.indexOf(e)>=0)throw new Error("Sorry, the { "+e+" } option is not yet supported with update().")});var r=this._settings.canvas,i=this._settings.context;for(var o in e){var a=e[o];void 0!==a&&(t._settings[o]=a)}var s=Object.assign({},this._settings,e);if("time"in e&&"frame"in e)throw new Error("You should specify { time } or { frame } but not both");if("time"in e?delete s.frame:"frame"in e&&delete s.time,"duration"in e&&"totalFrames"in e)throw new Error("You should specify { duration } or { totalFrames } but not both");"duration"in e?delete s.totalFrames:"totalFrames"in e&&delete s.duration;var u=this.getTimeProps(s);if(Object.assign(this._props,u),r!==this._settings.canvas||i!==this._settings.context){var c=M(this._settings),f=c.context;this.props.canvas=c.canvas,this.props.context=f,this._setupGLKey(),this._appendCanvasIfNeeded()}return e.p5&&"function"!=typeof e.p5&&(this.props.p5=e.p5,this.props.p5.draw=function(){t._isP5Resizing||(t._lastRedrawResult=t.submitDrawCall())}),"playing"in e&&(e.playing?this.play():this.pause()),this.resize(),this.render(),this.props},P.prototype.resize=function(){var e=this._getSizeProps(),t=this.settings,n=this.props,r=O(n,t);Object.assign(this._props,r);var i=this.props,o=i.pixelRatio,a=i.canvasWidth,s=i.canvasHeight,u=i.styleWidth,c=i.styleHeight,f=this.props.canvas;f&&!1!==t.resizeCanvas&&(n.p5?f.width===a&&f.height===s||(this._isP5Resizing=!0,n.p5.pixelDensity(o),n.p5.resizeCanvas(a/o,s/o,!1),this._isP5Resizing=!1):(f.width!==a&&(f.width=a),f.height!==s&&(f.height=s)),p()&&!1!==t.styleCanvas&&(f.style.width=u+"px",f.style.height=c+"px"));var l=this._getSizeProps(),d=!v(e,l);return d&&this._sizeChanged(),d},P.prototype._sizeChanged=function(){this.sketch&&"function"==typeof this.sketch.resize&&this.sketch.resize(this.props)},P.prototype.animate=function(){if(this.props.playing)if(p()){this._raf=window.requestAnimationFrame(this._animateHandler);var e=c(),t=1e3/this.props.fps,n=e-this._lastTime,r=this.props.duration,i="number"==typeof r&&isFinite(r),o=!0,a=this.settings.playbackRate;"fixed"===a?n=t:"throttle"===a?n>t?this._lastTime=e-=n%t:o=!1:this._lastTime=e;var s=n/1e3,u=this.props.time+s*this.props.timeScale;u<0&&i&&(u=r+u);var f=!1,l=!1;if(i&&u>=r&&(!1!==this.settings.loop?(o=!0,u%=r,l=!0):(o=!1,u=r,f=!0),this._signalEnd()),o){this.props.deltaTime=s,this.props.time=u,this.props.playhead=this._computePlayhead(u,r);var d=this.props.frame;this.props.frame=this._computeCurrentFrame(),l&&this._signalBegin(),d!==this.props.frame&&this.tick(),this.render(),this.props.deltaTime=0}f&&this.pause()}else console.error("[canvas-sketch] WARN: Animation in Node.js is not yet supported")},P.prototype.dispatch=function(e){if("function"!=typeof e)throw new Error("must pass function into dispatch()");e(this.props),this.render()},P.prototype.mount=function(){this._appendCanvasIfNeeded()},P.prototype.unmount=function(){p()&&(window.removeEventListener("resize",this._resizeHandler),this._keyboardShortcuts.detach()),this.props.canvas.parentElement&&this.props.canvas.parentElement.removeChild(this.props.canvas)},P.prototype._appendCanvasIfNeeded=function(){p()&&(!1!==this.settings.parent&&this.props.canvas&&!this.props.canvas.parentElement&&(this.settings.parent||document.body).appendChild(this.props.canvas))},P.prototype._setupGLKey=function(){var e;this.props.context&&("function"==typeof(e=this.props.context).clear&&"function"==typeof e.clearColor&&"function"==typeof e.bufferData?this._props.gl=this.props.context:delete this._props.gl)},P.prototype.getTimeProps=function(e){void 0===e&&(e={});var n=e.duration,r=e.totalFrames,i=t(e.timeScale,1),o=t(e.fps,24),a="number"==typeof n&&isFinite(n),s="number"==typeof r&&isFinite(r),u=a?Math.floor(o*n):void 0,c=s?r/o:void 0;if(a&&s&&u!==r)throw new Error("You should specify either duration or totalFrames, but not both. Or, they must match exactly.");void 0===e.dimensions&&void 0!==e.units&&console.warn("You've specified a { units } setting but no { dimension }, so the units will be ignored."),r=t(r,u,Infinity),n=t(n,c,Infinity);var f=e.time,l=e.frame,d="number"==typeof f&&isFinite(f),p="number"==typeof l&&isFinite(l),h=0,m=0,g=0;if(d&&p)throw new Error("You should specify either start frame or time, but not both.");return d?(g=this._computePlayhead(h=f,n),m=this._computeFrame(g,h,r,o)):p&&(g=this._computePlayhead(h=(m=l)/o,n)),{playhead:g,time:h,frame:m,duration:n,totalFrames:r,fps:o,timeScale:i}},P.prototype.setup=function(e,t){var n=this;if(void 0===e&&(e={}),void 0===t&&(t={}),this.sketch)throw new Error("Multiple setup() calls not yet supported.");this._settings=Object.assign({},e,this._settings);var r=M(this._settings),i=r.context,o=r.canvas,a=this.getTimeProps(this._settings);this._props=Object.assign({},a,{canvas:o,context:i,deltaTime:0,started:!1,exporting:!1,playing:!1,recording:!1,settings:this.settings,render:function(){return n.render()},togglePlay:function(){return n.togglePlay()},dispatch:function(e){return n.dispatch(e)},tick:function(){return n.tick()},resize:function(){return n.resize()},update:function(e){return n.update(e)},exportFrame:function(e){return n.exportFrame(e)},record:function(){return n.record()},play:function(){return n.play()},pause:function(){return n.pause()},stop:function(){return n.stop()}}),this._setupGLKey(),this.resize()},P.prototype.loadAndRun=function(e,t){var n=this;return this.load(e,t).then(function(){return n.run(),n})},P.prototype.unload=function(){var e=this;this.pause(),this.sketch&&("function"==typeof this.sketch.unload&&this._wrapContextScale(function(t){return e.sketch.unload(t)}),this._sketch=null)},P.prototype.destroy=function(){this.unload(),this.unmount()},P.prototype.load=function(e,t){var n=this;if("function"!=typeof e)throw new Error("The function must take in a function as the first parameter. Example:\n  canvasSketcher(() => { ... }, settings)");this.sketch&&this.unload(),void 0!==t&&this.update(t),this._preRender();var r=Promise.resolve();if(this.settings.p5){if(!p())throw new Error("[canvas-sketch] ERROR: Using p5.js in Node.js is not supported");r=new Promise(function(e){var t,r=n.settings.p5;r.p5&&(t=r.preload,r=r.p5);var i=function(r){t&&(r.preload=function(){return t(r)}),r.setup=function(){var t=n.props,i="webgl"===n.settings.context,o=i?r.WEBGL:r.P2D;r.noLoop(),r.pixelDensity(t.pixelRatio),r.createCanvas(t.viewportWidth,t.viewportHeight,o),i&&n.settings.attributes&&r.setAttributes(n.settings.attributes),n.update({p5:r,canvas:r.canvas,context:r._renderer.drawingContext}),e()}};if("function"==typeof r)new r(i);else{if("function"!=typeof window.createCanvas)throw new Error("{ p5 } setting is passed but can't find p5.js in global (window) scope. Maybe you did not create it globally?\nnew p5(); // <-- attaches to global scope");i(window)}})}return r.then(function(){var t=e(n.props);return f(t)||(t=Promise.resolve(t)),t}).then(function(e){return e||(e={}),n._sketch=e,p()&&(n._keyboardShortcuts.attach(),window.addEventListener("resize",n._resizeHandler)),n._postRender(),n._sizeChanged(),n}).catch(function(e){throw console.warn("Could not start sketch, the async loading function rejected with an error:\n    Error: "+e.message),e})},Object.defineProperties(P.prototype,F);var j="hot-id-cache",z=[];function R(e,n){if(void 0===n&&(n={}),n.p5){if(n.canvas||n.context&&"string"!=typeof n.context)throw new Error('In { p5 } mode, you can\'t pass your own canvas or context, unless the context is a "webgl" or "2d" string');n=Object.assign({},n,{canvas:!1,context:"string"==typeof n.context&&n.context})}var r,i,o=(r=d())&&r.hot;o&&(i=t(n.id,"$__DEFAULT_CANVAS_SKETCH_ID__$"));var a=o&&"string"==typeof i;a&&z.includes(i)&&(console.warn("Warning: You have multiple calls to canvasSketch() in --hot mode. You must pass unique { id } strings in settings to enable hot reload across multiple sketches. ",i),a=!1);var s=Promise.resolve();if(a){z.push(i);var u=function(e){var t=d();if(t)return t[j]=t[j]||{},t[j][e]}(i);if(u){var c=function(){var e,t=(e=u.manager,n.animate?{time:e.props.time}:void 0);return u.manager.destroy(),t};s=u.load.then(c).catch(c)}}return s.then(function(t){var r,o,s,u,c=new P;return e?(n=Object.assign({},n,t),c.setup(n),c.mount(),r=c.loadAndRun(e)):r=Promise.resolve(c),a&&(o=i,s={load:r,manager:c},(u=d())&&(u[j]=u[j]||{},u[j][o]=s)),r})}return R.canvasSketch=R,R.PaperSizes=S,R})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"convert-length":5}],5:[function(e,t,n){var r=e("defined"),i=["mm","cm","m","pc","pt","in","ft","px"],o={m:{system:"metric",factor:1},cm:{system:"metric",factor:.01},mm:{system:"metric",factor:.001},pt:{system:"imperial",factor:1/72},pc:{system:"imperial",factor:1/6},in:{system:"imperial",factor:1},ft:{system:"imperial",factor:12}};const a={metric:{unit:"m",ratio:1/.0254},imperial:{unit:"in",ratio:.0254}};t.exports=function(e,t,n,s){if("number"!=typeof e||!isFinite(e))throw new Error("Value must be a finite number");if(!t||!n)throw new Error("Must specify from and to units");var u=r((s=s||{}).pixelsPerInch,96),c=s.precision,f=!1!==s.roundPixel;if(t=t.toLowerCase(),n=n.toLowerCase(),-1===i.indexOf(t))throw new Error('Invalid from unit "'+t+'", must be one of: '+i.join(", "));if(-1===i.indexOf(n))throw new Error('Invalid from unit "'+n+'", must be one of: '+i.join(", "));if(t===n)return e;var l=1,d=1,p=!1;"px"===t&&(d=1/u,t="in"),"px"===n&&(p=!0,l=u,n="in");var h=o[t],m=o[n],g=e*h.factor*d;h.system!==m.system&&(g*=a[h.system].ratio);var v=g/m.factor*l;return p&&f?v=Math.round(v):"number"==typeof c&&isFinite(c)&&(v=function(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)}(v,c)),v},t.exports.units=i},{defined:7}],6:[function(e,t,n){var r,i;r=this,i=function(e){"use strict";function t(e,t){var n=e.__state.conversionName.toString(),r=Math.round(e.r),i=Math.round(e.g),o=Math.round(e.b),a=e.a,s=Math.round(e.h),u=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var f=e.hex.toString(16);f.length<6;)f="0"+f;return"#"+f}return"CSS_RGB"===n?"rgb("+r+","+i+","+o+")":"CSS_RGBA"===n?"rgba("+r+","+i+","+o+","+a+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+r+","+i+","+o+"]":"RGBA_ARRAY"===n?"["+r+","+i+","+o+","+a+"]":"RGB_OBJ"===n?"{r:"+r+",g:"+i+",b:"+o+"}":"RGBA_OBJ"===n?"{r:"+r+",g:"+i+",b:"+o+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+u+",v:"+c+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+u+",v:"+c+",a:"+a+"}":"unknown format"}var n=Array.prototype.forEach,r=Array.prototype.slice,i={BREAK:{},extend:function(e){return this.each(r.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(t[n])||(e[n]=t[n])}.bind(this))},this),e},defaults:function(e){return this.each(r.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(e[n])&&(e[n]=t[n])}.bind(this))},this),e},compose:function(){var e=r.call(arguments);return function(){for(var t=r.call(arguments),n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},each:function(e,t,r){if(e)if(n&&e.forEach&&e.forEach===n)e.forEach(t,r);else if(e.length===e.length+0){var i,o=void 0;for(o=0,i=e.length;o<i;o++)if(o in e&&t.call(r,e[o],o)===this.BREAK)return}else for(var a in e)if(t.call(r,e[a],a)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var r=void 0;return function(){var i=this,o=arguments;var a=n||!r;clearTimeout(r),r=setTimeout(function(){r=null,n||e.apply(i,o)},t),a&&e.apply(i,o)}},toArray:function(e){return e.toArray?e.toArray():r.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return isNaN(e)}),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}},o=[{litmus:i.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:t},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:t},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:t},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:t}}},{litmus:i.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:i.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:i.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(i.isNumber(e.r)&&i.isNumber(e.g)&&i.isNumber(e.b)&&i.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(i.isNumber(e.r)&&i.isNumber(e.g)&&i.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(i.isNumber(e.h)&&i.isNumber(e.s)&&i.isNumber(e.v)&&i.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(i.isNumber(e.h)&&i.isNumber(e.s)&&i.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],a=void 0,s=void 0,u=function(){s=!1;var e=arguments.length>1?i.toArray(arguments):arguments[0];return i.each(o,function(t){if(t.litmus(e))return i.each(t.conversions,function(t,n){if(a=t.read(e),!1===s&&!1!==a)return s=a,a.conversionName=n,a.conversion=t,i.BREAK}),i.BREAK}),s},c=void 0,f={hsv_to_rgb:function(e,t,n){var r=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),o=n*(1-t),a=n*(1-i*t),s=n*(1-(1-i)*t),u=[[n,s,o],[a,n,o],[o,n,s],[o,a,n],[s,o,n],[n,o,a]][r];return{r:255*u[0],g:255*u[1],b:255*u[2]}},rgb_to_hsv:function(e,t,n){var r=Math.min(e,t,n),i=Math.max(e,t,n),o=i-r,a=void 0;return 0===i?{h:NaN,s:0,v:0}:(a=e===i?(t-n)/o:t===i?2+(n-e)/o:4+(e-t)/o,(a/=6)<0&&(a+=1),{h:360*a,s:o/i,v:i/255})},rgb_to_hex:function(e,t,n){var r=this.hex_with_component(0,2,e);return r=this.hex_with_component(r,1,t),r=this.hex_with_component(r,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(c=8*t)|e&~(255<<c)}},l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},p=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),h=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},m=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},g=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},v=function(){function e(){if(d(this,e),this.__state=u.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return p(e,[{key:"toString",value:function(){return t(this)}},{key:"toHexString",value:function(){return t(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();function b(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(v.recalculateRGB(this,t,n),this.__state[t])},set:function(e){"RGB"!==this.__state.space&&(v.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function y(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(v.recalculateHSV(this),this.__state[t])},set:function(e){"HSV"!==this.__state.space&&(v.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}v.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=f.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");i.extend(e.__state,f.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},v.recalculateHSV=function(e){var t=f.rgb_to_hsv(e.r,e.g,e.b);i.extend(e.__state,{s:t.s,v:t.v}),i.isNaN(t.h)?i.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},v.COMPONENTS=["r","g","b","h","s","v","hex","a"],b(v.prototype,"r",2),b(v.prototype,"g",1),b(v.prototype,"b",0),y(v.prototype,"h"),y(v.prototype,"s"),y(v.prototype,"v"),Object.defineProperty(v.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(v.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=f.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var _=function(){function e(t,n){d(this,e),this.initialValue=t[n],this.domElement=document.createElement("div"),this.object=t,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return p(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),w={};i.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){i.each(e,function(e){w[e]=t})});var x=/(\d+(\.\d+)?)px/;function k(e){if("0"===e||i.isUndefined(e))return 0;var t=e.match(x);return i.isNull(t)?0:parseFloat(t[1])}var A={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){var r=n,o=t;i.isUndefined(o)&&(o=!0),i.isUndefined(r)&&(r=!0),e.style.position="absolute",o&&(e.style.left=0,e.style.right=0),r&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,r){var o=n||{},a=w[t];if(!a)throw new Error("Event type "+t+" not supported.");var s=document.createEvent(a);switch(a){case"MouseEvents":s.initMouseEvent(t,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,o.x||o.clientX||0,o.y||o.clientY||0,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var u=s.initKeyboardEvent||s.initKeyEvent;i.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),u(t,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break;default:s.initEvent(t,o.bubbles||!1,o.cancelable||!0)}i.defaults(s,r),e.dispatchEvent(s)},bind:function(e,t,n,r){return e.addEventListener?e.addEventListener(t,n,r||!1):e.attachEvent&&e.attachEvent("on"+t,n),A},unbind:function(e,t,n,r){return e.removeEventListener?e.removeEventListener(t,n,r||!1):e.detachEvent&&e.detachEvent("on"+t,n),A},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1===n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return A},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),r=n.indexOf(t);-1!==r&&(n.splice(r,1),e.className=n.join(" "))}else e.className=void 0;return A},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return k(t["border-left-width"])+k(t["border-right-width"])+k(t["padding-left"])+k(t["padding-right"])+k(t.width)},getHeight:function(e){var t=getComputedStyle(e);return k(t["border-top-width"])+k(t["border-bottom-width"])+k(t["padding-top"])+k(t["padding-bottom"])+k(t.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do{n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent}while(t);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},E=function(e){function t(e,n){d(this,t);var r=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=r;return r.__prev=r.getValue(),r.__checkbox=document.createElement("input"),r.__checkbox.setAttribute("type","checkbox"),A.bind(r.__checkbox,"change",function(){i.setValue(!i.__prev)},!1),r.domElement.appendChild(r.__checkbox),r.updateDisplay(),r}return m(t,_),p(t,[{key:"setValue",value:function(e){var n=h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),C=function(e){function t(e,n,r){d(this,t);var o=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),a=r,s=o;if(o.__select=document.createElement("select"),i.isArray(a)){var u={};i.each(a,function(e){u[e]=e}),a=u}return i.each(a,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),s.__select.appendChild(n)}),o.updateDisplay(),A.bind(o.__select,"change",function(){s.setValue(this.options[this.selectedIndex].value)}),o.domElement.appendChild(o.__select),o}return m(t,_),p(t,[{key:"setValue",value:function(e){var n=h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return A.isActive(this.__select)?this:(this.__select.value=this.getValue(),h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(),S=function(e){function t(e,n){d(this,t);var r=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=r;function o(){i.setValue(i.__input.value)}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),A.bind(r.__input,"keyup",o),A.bind(r.__input,"change",o),A.bind(r.__input,"blur",function(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}),A.bind(r.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return m(t,_),p(t,[{key:"updateDisplay",value:function(){return A.isActive(this.__input)||(this.__input.value=this.getValue()),h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}();function T(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var O=function(e){function t(e,n,r){d(this,t);var o=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),a=r||{};return o.__min=a.min,o.__max=a.max,o.__step=a.step,o.__impliedStep=i.isUndefined(o.__step)?0===o.initialValue?1:Math.pow(10,Math.floor(Math.log(Math.abs(o.initialValue))/Math.LN10))/10:o.__step,o.__precision=T(o.__impliedStep),o}return m(t,_),p(t,[{key:"setValue",value:function(e){var n=e;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=T(e),this}}]),t}();var D=function(e){function t(e,n,r){d(this,t);var o=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));o.__truncationSuspended=!1;var a=o,s=void 0;function u(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function c(e){var t=s-e.clientY;a.setValue(a.getValue()+t*a.__impliedStep),s=e.clientY}function f(){A.unbind(window,"mousemove",c),A.unbind(window,"mouseup",f),u()}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),A.bind(o.__input,"change",function(){var e=parseFloat(a.__input.value);i.isNaN(e)||a.setValue(e)}),A.bind(o.__input,"blur",function(){u()}),A.bind(o.__input,"mousedown",function(e){A.bind(window,"mousemove",c),A.bind(window,"mouseup",f),s=e.clientY}),A.bind(o.__input,"keydown",function(e){13===e.keyCode&&(a.__truncationSuspended=!0,this.blur(),a.__truncationSuspended=!1,u())}),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return m(t,O),p(t,[{key:"updateDisplay",value:function(){var e,n;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),n=Math.pow(10,this.__precision),Math.round(e*n)/n),h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}();function M(e,t,n,r,i){return r+(e-t)/(n-t)*(i-r)}var P=function(e){function t(e,n,r,i,o){d(this,t);var a=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,{min:r,max:i,step:o})),s=a;function u(e){e.preventDefault();var t=s.__background.getBoundingClientRect();return s.setValue(M(e.clientX,t.left,t.right,s.__min,s.__max)),!1}function c(){A.unbind(window,"mousemove",u),A.unbind(window,"mouseup",c),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function f(e){var t=e.touches[0].clientX,n=s.__background.getBoundingClientRect();s.setValue(M(t,n.left,n.right,s.__min,s.__max))}function l(){A.unbind(window,"touchmove",f),A.unbind(window,"touchend",l),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),A.bind(a.__background,"mousedown",function(e){document.activeElement.blur(),A.bind(window,"mousemove",u),A.bind(window,"mouseup",c),u(e)}),A.bind(a.__background,"touchstart",function(e){if(1!==e.touches.length)return;A.bind(window,"touchmove",f),A.bind(window,"touchend",l),f(e)}),A.addClass(a.__background,"slider"),A.addClass(a.__foreground,"slider-fg"),a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return m(t,O),p(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),F=function(e){function t(e,n,r){d(this,t);var i=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=i;return i.__button=document.createElement("div"),i.__button.innerHTML=void 0===r?"Fire":r,A.bind(i.__button,"click",function(e){return e.preventDefault(),o.fire(),!1}),A.addClass(i.__button,"button"),i.domElement.appendChild(i.__button),i}return m(t,_),p(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(),j=function(e){function t(e,n){d(this,t);var r=g(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));r.__color=new v(r.getValue()),r.__temp=new v(0);var o=r;r.domElement=document.createElement("div"),A.makeSelectable(r.domElement,!1),r.__selector=document.createElement("div"),r.__selector.className="selector",r.__saturation_field=document.createElement("div"),r.__saturation_field.className="saturation-field",r.__field_knob=document.createElement("div"),r.__field_knob.className="field-knob",r.__field_knob_border="2px solid ",r.__hue_knob=document.createElement("div"),r.__hue_knob.className="hue-knob",r.__hue_field=document.createElement("div"),r.__hue_field.className="hue-field",r.__input=document.createElement("input"),r.__input.type="text",r.__input_textShadow="0 1px 1px ",A.bind(r.__input,"keydown",function(e){13===e.keyCode&&h.call(this)}),A.bind(r.__input,"blur",h),A.bind(r.__selector,"mousedown",function(){A.addClass(this,"drag").bind(window,"mouseup",function(){A.removeClass(o.__selector,"drag")})}),A.bind(r.__selector,"touchstart",function(){A.addClass(this,"drag").bind(window,"touchend",function(){A.removeClass(o.__selector,"drag")})});var a,s=document.createElement("div");function c(e){b(e),A.bind(window,"mousemove",b),A.bind(window,"touchmove",b),A.bind(window,"mouseup",l),A.bind(window,"touchend",l)}function f(e){y(e),A.bind(window,"mousemove",y),A.bind(window,"touchmove",y),A.bind(window,"mouseup",p),A.bind(window,"touchend",p)}function l(){A.unbind(window,"mousemove",b),A.unbind(window,"touchmove",b),A.unbind(window,"mouseup",l),A.unbind(window,"touchend",l),m()}function p(){A.unbind(window,"mousemove",y),A.unbind(window,"touchmove",y),A.unbind(window,"mouseup",p),A.unbind(window,"touchend",p),m()}function h(){var e=u(this.value);!1!==e?(o.__color.__state=e,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function m(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}function b(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,r=(n.clientX-t.left)/(t.right-t.left),i=1-(n.clientY-t.top)/(t.bottom-t.top);return i>1?i=1:i<0&&(i=0),r>1?r=1:r<0&&(r=0),o.__color.v=i,o.__color.s=r,o.setValue(o.__color.toOriginal()),!1}function y(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__hue_field.getBoundingClientRect(),n=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return n>1?n=1:n<0&&(n=0),o.__color.h=360*n,o.setValue(o.__color.toOriginal()),!1}return i.extend(r.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),i.extend(r.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:r.__field_knob_border+(r.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),i.extend(r.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),i.extend(r.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),i.extend(s.style,{width:"100%",height:"100%",background:"none"}),R(s,"top","rgba(0,0,0,0)","#000"),i.extend(r.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(a=r.__hue_field).style.background="",a.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",a.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",i.extend(r.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:r.__input_textShadow+"rgba(0,0,0,0.7)"}),A.bind(r.__saturation_field,"mousedown",c),A.bind(r.__saturation_field,"touchstart",c),A.bind(r.__field_knob,"mousedown",c),A.bind(r.__field_knob,"touchstart",c),A.bind(r.__hue_field,"mousedown",f),A.bind(r.__hue_field,"touchstart",f),r.__saturation_field.appendChild(s),r.__selector.appendChild(r.__field_knob),r.__selector.appendChild(r.__saturation_field),r.__selector.appendChild(r.__hue_field),r.__hue_field.appendChild(r.__hue_knob),r.domElement.appendChild(r.__input),r.domElement.appendChild(r.__selector),r.updateDisplay(),r}return m(t,_),p(t,[{key:"updateDisplay",value:function(){var e=u(this.getValue());if(!1!==e){var t=!1;i.each(v.COMPONENTS,function(n){if(!i.isUndefined(e[n])&&!i.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}},this),t&&i.extend(this.__color.__state,e)}i.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,r=255-n;i.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,R(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),i.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),t}(),z=["-moz-","-o-","-webkit-","-ms-",""];function R(e,t,n,r){e.style.background="",i.each(z,function(i){e.style.cssText+="background: "+i+"linear-gradient("+t+", "+n+" 0%, "+r+" 100%); "})}var B=function(e,t){var n=t||document,r=document.createElement("style");r.type="text/css",r.innerHTML=e;var i=n.getElementsByTagName("head")[0];try{i.appendChild(r)}catch(e){}},L=function(e,t){var n=e[t];return i.isArray(arguments[2])||i.isObject(arguments[2])?new C(e,t,arguments[2]):i.isNumber(n)?i.isNumber(arguments[2])&&i.isNumber(arguments[3])?i.isNumber(arguments[4])?new P(e,t,arguments[2],arguments[3],arguments[4]):new P(e,t,arguments[2],arguments[3]):i.isNumber(arguments[4])?new D(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new D(e,t,{min:arguments[2],max:arguments[3]}):i.isString(n)?new S(e,t):i.isFunction(n)?new F(e,t,""):i.isBoolean(n)?new E(e,t):null};var I=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},N=function(){function e(){d(this,e),this.backgroundElement=document.createElement("div"),i.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),A.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),i.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;A.bind(this.backgroundElement,"click",function(){t.hide()})}return p(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),i.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",A.unbind(e.domElement,"webkitTransitionEnd",t),A.unbind(e.domElement,"transitionend",t),A.unbind(e.domElement,"oTransitionEnd",t)};A.bind(this.domElement,"webkitTransitionEnd",t),A.bind(this.domElement,"transitionend",t),A.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-A.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-A.getHeight(this.domElement)/2+"px"}}]),e}();B(function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var H="Default",U=function(){try{return!!window.localStorage}catch(e){return!1}}(),V=void 0,G=!0,W=void 0,q=!1,Y=[],Q=function e(t){var n=this,r=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),A.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=i.defaults(r,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),r=i.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),i.isUndefined(r.load)?r.load={preset:H}:r.preset&&(r.load.preset=r.preset),i.isUndefined(r.parent)&&r.hideable&&Y.push(this),r.resizable=i.isUndefined(r.parent)&&r.resizable,r.autoPlace&&i.isUndefined(r.scrollable)&&(r.scrollable=!0);var o,a=U&&"true"===localStorage.getItem(ee(this,"isLocal")),s=void 0,u=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:r.load.preset},set:function(e){n.parent?n.getRoot().preset=e:r.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),n.revert()}},width:{get:function(){return r.width},set:function(e){r.width=e,ie(n,e)}},name:{get:function(){return r.name},set:function(e){r.name=e,u&&(u.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(t){r.closed=t,r.closed?A.addClass(n.__ul,e.CLASS_CLOSED):A.removeClass(n.__ul,e.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return a},set:function(e){U&&(a=e,e?A.bind(window,"unload",s):A.unbind(window,"unload",s),localStorage.setItem(ee(n,"isLocal"),e))}}}),i.isUndefined(r.parent)){if(r.closed=!1,A.addClass(this.domElement,e.CLASS_MAIN),A.makeSelectable(this.domElement,!1),U&&a){n.useLocalStorage=!0;var c=localStorage.getItem(ee(this,"gui"));c&&(r.load=JSON.parse(c))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,A.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),r.closeOnTop?(A.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(A.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),A.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{void 0===r.closed&&(r.closed=!0);var f=document.createTextNode(r.name);A.addClass(f,"controller-name"),u=X(n,f);A.addClass(this.__ul,e.CLASS_CLOSED),A.addClass(u,"title"),A.bind(u,"click",function(e){return e.preventDefault(),n.closed=!n.closed,!1}),r.closed||(this.closed=!1)}r.autoPlace&&(i.isUndefined(r.parent)&&(G&&(W=document.createElement("div"),A.addClass(W,"dg"),A.addClass(W,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(W),G=!1),W.appendChild(this.domElement),A.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||ie(n,r.width)),this.__resizeHandler=function(){n.onResizeDebounced()},A.bind(window,"resize",this.__resizeHandler),A.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),A.bind(this.__ul,"transitionend",this.__resizeHandler),A.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&re(this),this.saveToLocalStorageIfPossible=s=function(){U&&"true"===localStorage.getItem(ee(n,"isLocal"))&&localStorage.setItem(ee(n,"gui"),JSON.stringify(n.getSaveObject()))},r.parent||((o=n.getRoot()).width+=1,i.defer(function(){o.width-=1}))};function X(e,t,n){var r=document.createElement("li");return t&&r.appendChild(t),n?e.__ul.insertBefore(r,n):e.__ul.appendChild(r),e.onResize(),r}function K(e){A.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&A.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function J(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function Z(e,t){var n=e.getRoot(),r=n.__rememberedObjects.indexOf(t.object);if(-1!==r){var i=n.__rememberedObjectIndecesToControllers[r];if(void 0===i&&(n.__rememberedObjectIndecesToControllers[r]=i={}),i[t.property]=t,n.load&&n.load.remembered){var o=n.load.remembered,a=void 0;if(o[e.preset])a=o[e.preset];else{if(!o[H])return;a=o[H]}if(a[r]&&void 0!==a[r][t.property]){var s=a[r][t.property];t.initialValue=s,t.setValue(s)}}}}function $(e,t,n,r){if(void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var o=void 0;if(r.color)o=new j(t,n);else{var a=[t,n].concat(r.factoryArgs);o=L.apply(e,a)}r.before instanceof _&&(r.before=r.before.__li),Z(e,o),A.addClass(o.domElement,"c");var s=document.createElement("span");A.addClass(s,"property-name"),s.innerHTML=o.property;var u=document.createElement("div");u.appendChild(s),u.appendChild(o.domElement);var c=X(e,u,r.before);return A.addClass(c,Q.CLASS_CONTROLLER_ROW),A.addClass(c,o instanceof j?"color":l(o.getValue())),function(e,t,n){if(n.__li=t,n.__gui=e,i.extend(n,{options:function(t){if(arguments.length>1){var r=n.__li.nextElementSibling;return n.remove(),$(e,n.object,n.property,{before:r,factoryArgs:[i.toArray(arguments)]})}if(i.isArray(t)||i.isObject(t)){var o=n.__li.nextElementSibling;return n.remove(),$(e,n.object,n.property,{before:o,factoryArgs:[t]})}},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof P){var r=new D(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});i.each(["updateDisplay","onChange","onFinishChange","step"],function(e){var t=n[e],i=r[e];n[e]=r[e]=function(){var e=Array.prototype.slice.call(arguments);return i.apply(r,e),t.apply(n,e)}}),A.addClass(t,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof D){var o=function(t){if(i.isNumber(n.__min)&&i.isNumber(n.__max)){var r=n.__li.firstElementChild.firstElementChild.innerHTML,o=n.__gui.__listening.indexOf(n)>-1;n.remove();var a=$(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return a.name(r),o&&a.listen(),a}return t};n.min=i.compose(o,n.min),n.max=i.compose(o,n.max)}else n instanceof E?(A.bind(t,"click",function(){A.fakeEvent(n.__checkbox,"click")}),A.bind(n.__checkbox,"click",function(e){e.stopPropagation()})):n instanceof F?(A.bind(t,"click",function(){A.fakeEvent(n.__button,"click")}),A.bind(t,"mouseover",function(){A.addClass(n.__button,"hover")}),A.bind(t,"mouseout",function(){A.removeClass(n.__button,"hover")})):n instanceof j&&(A.addClass(t,"color"),n.updateDisplay=i.compose(function(e){return t.style.borderLeftColor=n.__color.toString(),e},n.updateDisplay),n.updateDisplay());n.setValue=i.compose(function(t){return e.getRoot().__preset_select&&n.isModified()&&J(e.getRoot(),!0),t},n.setValue)}(e,c,o),e.__controllers.push(o),o}function ee(e,t){return document.location.href+"."+t}function te(e,t,n){var r=document.createElement("option");r.innerHTML=t,r.value=t,e.__preset_select.appendChild(r),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function ne(e,t){t.style.display=e.useLocalStorage?"block":"none"}function re(e){var t=void 0;function n(n){return n.preventDefault(),e.width+=t-n.clientX,e.onResize(),t=n.clientX,!1}function r(){A.removeClass(e.__closeButton,Q.CLASS_DRAG),A.unbind(window,"mousemove",n),A.unbind(window,"mouseup",r)}function o(i){return i.preventDefault(),t=i.clientX,A.addClass(e.__closeButton,Q.CLASS_DRAG),A.bind(window,"mousemove",n),A.bind(window,"mouseup",r),!1}e.__resize_handle=document.createElement("div"),i.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),A.bind(e.__resize_handle,"mousedown",o),A.bind(e.__closeButton,"mousedown",o),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function ie(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function oe(e,t){var n={};return i.each(e.__rememberedObjects,function(r,o){var a={};i.each(e.__rememberedObjectIndecesToControllers[o],function(e,n){a[n]=t?e.initialValue:e.getValue()}),n[o]=a}),n}Q.toggleHide=function(){q=!q,i.each(Y,function(e){e.domElement.style.display=q?"none":""})},Q.CLASS_AUTO_PLACE="a",Q.CLASS_AUTO_PLACE_CONTAINER="ac",Q.CLASS_MAIN="main",Q.CLASS_CONTROLLER_ROW="cr",Q.CLASS_TOO_TALL="taller-than-window",Q.CLASS_CLOSED="closed",Q.CLASS_CLOSE_BUTTON="close-button",Q.CLASS_CLOSE_TOP="close-top",Q.CLASS_CLOSE_BOTTOM="close-bottom",Q.CLASS_DRAG="drag",Q.DEFAULT_WIDTH=245,Q.TEXT_CLOSED="Close Controls",Q.TEXT_OPEN="Open Controls",Q._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||Q.toggleHide()},A.bind(window,"keydown",Q._keydownHandler,!1),i.extend(Q.prototype,{add:function(e,t){return $(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return $(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;i.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&W.removeChild(this.domElement);var e=this;i.each(this.__folders,function(t){e.removeFolder(t)}),A.unbind(window,"keydown",Q._keydownHandler,!1),K(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new Q(t);this.__folders[e]=n;var r=X(this,n.domElement);return A.addClass(r,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],K(e);var t=this;i.each(e.__folders,function(t){e.removeFolder(t)}),i.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=A.getOffset(e.__ul).top,n=0;i.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(n+=A.getHeight(t))}),window.innerHeight-t-20<n?(A.addClass(e.domElement,Q.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(A.removeClass(e.domElement,Q.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&i.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:i.debounce(function(){this.onResize()},50),remember:function(){if(i.isUndefined(V)&&((V=new N).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;i.each(Array.prototype.slice.call(arguments),function(t){0===e.__rememberedObjects.length&&function(e){var t=e.__save_row=document.createElement("li");A.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),A.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",A.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",A.addClass(r,"button"),A.addClass(r,"save");var o=document.createElement("span");o.innerHTML="New",A.addClass(o,"button"),A.addClass(o,"save-as");var a=document.createElement("span");a.innerHTML="Revert",A.addClass(a,"button"),A.addClass(a,"revert");var s=e.__preset_select=document.createElement("select");e.load&&e.load.remembered?i.each(e.load.remembered,function(t,n){te(e,n,n===e.preset)}):te(e,H,!1);if(A.bind(s,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(s),t.appendChild(n),t.appendChild(r),t.appendChild(o),t.appendChild(a),U){var u=document.getElementById("dg-local-explain"),c=document.getElementById("dg-local-storage"),f=document.getElementById("dg-save-locally");f.style.display="block","true"===localStorage.getItem(ee(e,"isLocal"))&&c.setAttribute("checked","checked"),ne(e,u),A.bind(c,"change",function(){e.useLocalStorage=!e.useLocalStorage,ne(e,u)})}var l=document.getElementById("dg-new-constructor");A.bind(l,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||V.hide()}),A.bind(n,"click",function(){l.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),V.show(),l.focus(),l.select()}),A.bind(r,"click",function(){e.save()}),A.bind(o,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),A.bind(a,"click",function(){e.revert()})}(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)}),this.autoPlace&&ie(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=oe(this)),e.folders={},i.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=oe(this),J(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[H]=oe(this,!0)),this.load.remembered[e]=oe(this),this.preset=e,te(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){i.each(this.__controllers,function(t){this.getRoot().load.remembered?Z(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),i.each(this.__folders,function(e){e.revert(e)}),e||J(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&function e(t){0!==t.length&&I.call(window,function(){e(t)});i.each(t,function(e){e.updateDisplay()})}(this.__listening)},updateDisplay:function(){i.each(this.__controllers,function(e){e.updateDisplay()}),i.each(this.__folders,function(e){e.updateDisplay()})}});var ae={Color:v,math:f,interpret:u},se={Controller:_,BooleanController:E,OptionController:C,StringController:S,NumberController:O,NumberControllerBox:D,NumberControllerSlider:P,FunctionController:F,ColorController:j},ue={dom:A},ce={GUI:Q},fe=Q,le={color:ae,controllers:se,dom:ue,gui:ce,GUI:fe};e.color=ae,e.controllers=se,e.dom=ue,e.gui=ce,e.GUI=fe,e.default=le,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof n&&void 0!==t?i(n):"function"==typeof define&&define.amd?define(["exports"],i):i(r.dat={})},{}],7:[function(e,t,n){t.exports=function(){for(var e=0;e<arguments.length;e++)if(void 0!==arguments[e])return arguments[e]}},{}],8:[function(e,t,n){t.exports=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],f=t[8],l=t[9],d=t[10],p=t[11],h=t[12],m=t[13],g=t[14],v=t[15];return e[0]=s*(d*v-p*g)-l*(u*v-c*g)+m*(u*p-c*d),e[1]=-(r*(d*v-p*g)-l*(i*v-o*g)+m*(i*p-o*d)),e[2]=r*(u*v-c*g)-s*(i*v-o*g)+m*(i*c-o*u),e[3]=-(r*(u*p-c*d)-s*(i*p-o*d)+l*(i*c-o*u)),e[4]=-(a*(d*v-p*g)-f*(u*v-c*g)+h*(u*p-c*d)),e[5]=n*(d*v-p*g)-f*(i*v-o*g)+h*(i*p-o*d),e[6]=-(n*(u*v-c*g)-a*(i*v-o*g)+h*(i*c-o*u)),e[7]=n*(u*p-c*d)-a*(i*p-o*d)+f*(i*c-o*u),e[8]=a*(l*v-p*m)-f*(s*v-c*m)+h*(s*p-c*l),e[9]=-(n*(l*v-p*m)-f*(r*v-o*m)+h*(r*p-o*l)),e[10]=n*(s*v-c*m)-a*(r*v-o*m)+h*(r*c-o*s),e[11]=-(n*(s*p-c*l)-a*(r*p-o*l)+f*(r*c-o*s)),e[12]=-(a*(l*g-d*m)-f*(s*g-u*m)+h*(s*d-u*l)),e[13]=n*(l*g-d*m)-f*(r*g-i*m)+h*(r*d-i*l),e[14]=-(n*(s*g-u*m)-a*(r*g-i*m)+h*(r*u-i*s)),e[15]=n*(s*d-u*l)-a*(r*d-i*l)+f*(r*u-i*s),e}},{}],9:[function(e,t,n){t.exports=function(e){var t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}},{}],10:[function(e,t,n){t.exports=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}},{}],11:[function(e,t,n){t.exports=function(){var e=new Float32Array(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}},{}],12:[function(e,t,n){t.exports=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],u=e[7],c=e[8],f=e[9],l=e[10],d=e[11],p=e[12],h=e[13],m=e[14],g=e[15];return(t*a-n*o)*(l*g-d*m)-(t*s-r*o)*(f*g-d*h)+(t*u-i*o)*(f*m-l*h)+(n*s-r*a)*(c*g-d*p)-(n*u-i*a)*(c*m-l*p)+(r*u-i*s)*(c*h-f*p)}},{}],13:[function(e,t,n){t.exports=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n+n,s=r+r,u=i+i,c=n*a,f=r*a,l=r*s,d=i*a,p=i*s,h=i*u,m=o*a,g=o*s,v=o*u;return e[0]=1-l-h,e[1]=f+v,e[2]=d-g,e[3]=0,e[4]=f-v,e[5]=1-c-h,e[6]=p+m,e[7]=0,e[8]=d+g,e[9]=p-m,e[10]=1-c-l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}},{}],14:[function(e,t,n){t.exports=function(e,t,n){var r,i,o,a=n[0],s=n[1],u=n[2],c=Math.sqrt(a*a+s*s+u*u);if(Math.abs(c)<1e-6)return null;return a*=c=1/c,s*=c,u*=c,r=Math.sin(t),i=Math.cos(t),e[0]=a*a*(o=1-i)+i,e[1]=s*a*o+u*r,e[2]=u*a*o-s*r,e[3]=0,e[4]=a*s*o-u*r,e[5]=s*s*o+i,e[6]=u*s*o+a*r,e[7]=0,e[8]=a*u*o+s*r,e[9]=s*u*o-a*r,e[10]=u*u*o+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}},{}],15:[function(e,t,n){t.exports=function(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=r+r,u=i+i,c=o+o,f=r*s,l=r*u,d=r*c,p=i*u,h=i*c,m=o*c,g=a*s,v=a*u,b=a*c;return e[0]=1-(p+m),e[1]=l+b,e[2]=d-v,e[3]=0,e[4]=l-b,e[5]=1-(f+m),e[6]=h+g,e[7]=0,e[8]=d+v,e[9]=h-g,e[10]=1-(f+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}},{}],16:[function(e,t,n){t.exports=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}},{}],17:[function(e,t,n){t.exports=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}},{}],18:[function(e,t,n){t.exports=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}},{}],19:[function(e,t,n){t.exports=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}},{}],20:[function(e,t,n){t.exports=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}},{}],21:[function(e,t,n){t.exports=function(e,t,n,r,i,o,a){var s=1/(n-t),u=1/(i-r),c=1/(o-a);return e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*u,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(i+r)*u,e[10]=(a+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*c,e[15]=0,e}},{}],22:[function(e,t,n){t.exports=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}},{}],23:[function(e,t,n){t.exports={create:e("./create"),clone:e("./clone"),copy:e("./copy"),identity:e("./identity"),transpose:e("./transpose"),invert:e("./invert"),adjoint:e("./adjoint"),determinant:e("./determinant"),multiply:e("./multiply"),translate:e("./translate"),scale:e("./scale"),rotate:e("./rotate"),rotateX:e("./rotateX"),rotateY:e("./rotateY"),rotateZ:e("./rotateZ"),fromRotation:e("./fromRotation"),fromRotationTranslation:e("./fromRotationTranslation"),fromScaling:e("./fromScaling"),fromTranslation:e("./fromTranslation"),fromXRotation:e("./fromXRotation"),fromYRotation:e("./fromYRotation"),fromZRotation:e("./fromZRotation"),fromQuat:e("./fromQuat"),frustum:e("./frustum"),perspective:e("./perspective"),perspectiveFromFieldOfView:e("./perspectiveFromFieldOfView"),ortho:e("./ortho"),lookAt:e("./lookAt"),str:e("./str")}},{"./adjoint":8,"./clone":9,"./copy":10,"./create":11,"./determinant":12,"./fromQuat":13,"./fromRotation":14,"./fromRotationTranslation":15,"./fromScaling":16,"./fromTranslation":17,"./fromXRotation":18,"./fromYRotation":19,"./fromZRotation":20,"./frustum":21,"./identity":22,"./invert":24,"./lookAt":25,"./multiply":26,"./ortho":27,"./perspective":28,"./perspectiveFromFieldOfView":29,"./rotate":30,"./rotateX":31,"./rotateY":32,"./rotateZ":33,"./scale":34,"./str":35,"./translate":36,"./transpose":37}],24:[function(e,t,n){t.exports=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],f=t[8],l=t[9],d=t[10],p=t[11],h=t[12],m=t[13],g=t[14],v=t[15],b=n*s-r*a,y=n*u-i*a,_=n*c-o*a,w=r*u-i*s,x=r*c-o*s,k=i*c-o*u,A=f*m-l*h,E=f*g-d*h,C=f*v-p*h,S=l*g-d*m,T=l*v-p*m,O=d*v-p*g,D=b*O-y*T+_*S+w*C-x*E+k*A;if(!D)return null;return e[0]=(s*O-u*T+c*S)*(D=1/D),e[1]=(i*T-r*O-o*S)*D,e[2]=(m*k-g*x+v*w)*D,e[3]=(d*x-l*k-p*w)*D,e[4]=(u*C-a*O-c*E)*D,e[5]=(n*O-i*C+o*E)*D,e[6]=(g*_-h*k-v*y)*D,e[7]=(f*k-d*_+p*y)*D,e[8]=(a*T-s*C+c*A)*D,e[9]=(r*C-n*T-o*A)*D,e[10]=(h*x-m*_+v*b)*D,e[11]=(l*_-f*x-p*b)*D,e[12]=(s*E-a*S-u*A)*D,e[13]=(n*S-r*E+i*A)*D,e[14]=(m*y-h*w-g*b)*D,e[15]=(f*w-l*y+d*b)*D,e}},{}],25:[function(e,t,n){var r=e("./identity");t.exports=function(e,t,n,i){var o,a,s,u,c,f,l,d,p,h,m=t[0],g=t[1],v=t[2],b=i[0],y=i[1],_=i[2],w=n[0],x=n[1],k=n[2];if(Math.abs(m-w)<1e-6&&Math.abs(g-x)<1e-6&&Math.abs(v-k)<1e-6)return r(e);l=m-w,d=g-x,p=v-k,h=1/Math.sqrt(l*l+d*d+p*p),o=y*(p*=h)-_*(d*=h),a=_*(l*=h)-b*p,s=b*d-y*l,(h=Math.sqrt(o*o+a*a+s*s))?(o*=h=1/h,a*=h,s*=h):(o=0,a=0,s=0);u=d*s-p*a,c=p*o-l*s,f=l*a-d*o,(h=Math.sqrt(u*u+c*c+f*f))?(u*=h=1/h,c*=h,f*=h):(u=0,c=0,f=0);return e[0]=o,e[1]=u,e[2]=l,e[3]=0,e[4]=a,e[5]=c,e[6]=d,e[7]=0,e[8]=s,e[9]=f,e[10]=p,e[11]=0,e[12]=-(o*m+a*g+s*v),e[13]=-(u*m+c*g+f*v),e[14]=-(l*m+d*g+p*v),e[15]=1,e}},{"./identity":22}],26:[function(e,t,n){t.exports=function(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],f=t[7],l=t[8],d=t[9],p=t[10],h=t[11],m=t[12],g=t[13],v=t[14],b=t[15],y=n[0],_=n[1],w=n[2],x=n[3];return e[0]=y*r+_*s+w*l+x*m,e[1]=y*i+_*u+w*d+x*g,e[2]=y*o+_*c+w*p+x*v,e[3]=y*a+_*f+w*h+x*b,e[4]=(y=n[4])*r+(_=n[5])*s+(w=n[6])*l+(x=n[7])*m,e[5]=y*i+_*u+w*d+x*g,e[6]=y*o+_*c+w*p+x*v,e[7]=y*a+_*f+w*h+x*b,e[8]=(y=n[8])*r+(_=n[9])*s+(w=n[10])*l+(x=n[11])*m,e[9]=y*i+_*u+w*d+x*g,e[10]=y*o+_*c+w*p+x*v,e[11]=y*a+_*f+w*h+x*b,e[12]=(y=n[12])*r+(_=n[13])*s+(w=n[14])*l+(x=n[15])*m,e[13]=y*i+_*u+w*d+x*g,e[14]=y*o+_*c+w*p+x*v,e[15]=y*a+_*f+w*h+x*b,e}},{}],27:[function(e,t,n){t.exports=function(e,t,n,r,i,o,a){var s=1/(t-n),u=1/(r-i),c=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=(a+o)*c,e[15]=1,e}},{}],28:[function(e,t,n){t.exports=function(e,t,n,r,i){var o=1/Math.tan(t/2),a=1/(r-i);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(i+r)*a,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*i*r*a,e[15]=0,e}},{}],29:[function(e,t,n){t.exports=function(e,t,n,r){var i=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(a+s),c=2/(i+o);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(a-s)*u*.5,e[9]=(i-o)*c*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}},{}],30:[function(e,t,n){t.exports=function(e,t,n,r){var i,o,a,s,u,c,f,l,d,p,h,m,g,v,b,y,_,w,x,k,A,E,C,S,T=r[0],O=r[1],D=r[2],M=Math.sqrt(T*T+O*O+D*D);if(Math.abs(M)<1e-6)return null;T*=M=1/M,O*=M,D*=M,i=Math.sin(n),o=Math.cos(n),u=t[1],c=t[2],f=t[3],d=t[5],p=t[6],h=t[7],g=t[9],v=t[10],b=t[11],x=T*O*(a=1-o)-D*i,k=O*O*a+o,A=D*O*a+T*i,E=T*D*a+O*i,C=O*D*a-T*i,S=D*D*a+o,e[0]=(s=t[0])*(y=T*T*a+o)+(l=t[4])*(_=O*T*a+D*i)+(m=t[8])*(w=D*T*a-O*i),e[1]=u*y+d*_+g*w,e[2]=c*y+p*_+v*w,e[3]=f*y+h*_+b*w,e[4]=s*x+l*k+m*A,e[5]=u*x+d*k+g*A,e[6]=c*x+p*k+v*A,e[7]=f*x+h*k+b*A,e[8]=s*E+l*C+m*S,e[9]=u*E+d*C+g*S,e[10]=c*E+p*C+v*S,e[11]=f*E+h*C+b*S,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e}},{}],31:[function(e,t,n){t.exports=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],f=t[9],l=t[10],d=t[11];t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e[4]=o*i+c*r,e[5]=a*i+f*r,e[6]=s*i+l*r,e[7]=u*i+d*r,e[8]=c*i-o*r,e[9]=f*i-a*r,e[10]=l*i-s*r,e[11]=d*i-u*r,e}},{}],32:[function(e,t,n){t.exports=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],u=t[3],c=t[8],f=t[9],l=t[10],d=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e[0]=o*i-c*r,e[1]=a*i-f*r,e[2]=s*i-l*r,e[3]=u*i-d*r,e[8]=o*r+c*i,e[9]=a*r+f*i,e[10]=s*r+l*i,e[11]=u*r+d*i,e}},{}],33:[function(e,t,n){t.exports=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],u=t[3],c=t[4],f=t[5],l=t[6],d=t[7];t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);return e[0]=o*i+c*r,e[1]=a*i+f*r,e[2]=s*i+l*r,e[3]=u*i+d*r,e[4]=c*i-o*r,e[5]=f*i-a*r,e[6]=l*i-s*r,e[7]=d*i-u*r,e}},{}],34:[function(e,t,n){t.exports=function(e,t,n){var r=n[0],i=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}},{}],35:[function(e,t,n){t.exports=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}},{}],36:[function(e,t,n){t.exports=function(e,t,n){var r,i,o,a,s,u,c,f,l,d,p,h,m=n[0],g=n[1],v=n[2];t===e?(e[12]=t[0]*m+t[4]*g+t[8]*v+t[12],e[13]=t[1]*m+t[5]*g+t[9]*v+t[13],e[14]=t[2]*m+t[6]*g+t[10]*v+t[14],e[15]=t[3]*m+t[7]*g+t[11]*v+t[15]):(i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],f=t[7],l=t[8],d=t[9],p=t[10],h=t[11],e[0]=r=t[0],e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=u,e[6]=c,e[7]=f,e[8]=l,e[9]=d,e[10]=p,e[11]=h,e[12]=r*m+s*g+l*v+t[12],e[13]=i*m+u*g+d*v+t[13],e[14]=o*m+c*g+p*v+t[14],e[15]=a*m+f*g+h*v+t[15]);return e}},{}],37:[function(e,t,n){t.exports=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],o=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=i,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}},{}],38:[function(e,t,n){t.exports=function(e,t){t||(t={});var n,r,i=t.attributes?{}:null,o=i&&Object.keys(t.attributes);if(i)for(var a=0;a<o.length;a++)i[o[a]]=[];var s=[],u=[],c=[],f=e.positions,l=e.cells,d=0;for(n=0;n<e.cells.length;n++){var p=l[n];if(3===p.length&&(s.push(f[p[0]]),s.push(f[p[1]]),s.push(f[p[2]]),c.push([0,0]),c.push([1,0]),c.push([0,1]),u.push(d++),u.push(d++),u.push(d++),o))for(r=0;r<o.length;r++){var h=o[r];i[h].push(t.attributes[h][p[0]]),i[h].push(t.attributes[h][p[1]]),i[h].push(t.attributes[h][p[2]])}}var m={positions:s,attributes:i,barycentric:c};return e.cells&&(m.cells=u),m}},{}],39:[function(e,t,n){var r=e("./_root");t.exports=r.Symbol},{"./_root":47}],40:[function(e,t,n){var r=e("./_Symbol"),i=e("./_getRawTag"),o=e("./_objectToString"),a="[object Null]",s="[object Undefined]",u=r?r.toStringTag:void 0;t.exports=function(e){return null==e?void 0===e?s:a:u&&u in Object(e)?i(e):o(e)}},{"./_Symbol":39,"./_getRawTag":43,"./_objectToString":46}],41:[function(e,t,n){t.exports=function(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var o=Array(i);++r<i;)o[r]=e[r+t];return o}},{}],42:[function(e,t,n){(function(e){var n="object"==typeof e&&e&&e.Object===Object&&e;t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],43:[function(e,t,n){var r=e("./_Symbol"),i=Object.prototype,o=i.hasOwnProperty,a=i.toString,s=r?r.toStringTag:void 0;t.exports=function(e){var t=o.call(e,s),n=e[s];try{e[s]=void 0;var r=!0}catch(e){}var i=a.call(e);return r&&(t?e[s]=n:delete e[s]),i}},{"./_Symbol":39}],44:[function(e,t,n){var r=9007199254740991,i=/^(?:0|[1-9]\d*)$/;t.exports=function(e,t){var n=typeof e;return!!(t=null==t?r:t)&&("number"==n||"symbol"!=n&&i.test(e))&&e>-1&&e%1==0&&e<t}},{}],45:[function(e,t,n){var r=e("./eq"),i=e("./isArrayLike"),o=e("./_isIndex"),a=e("./isObject");t.exports=function(e,t,n){if(!a(n))return!1;var s=typeof t;return!!("number"==s?i(n)&&o(t,n.length):"string"==s&&t in n)&&r(n[t],e)}},{"./_isIndex":44,"./eq":49,"./isArrayLike":50,"./isObject":53}],46:[function(e,t,n){var r=Object.prototype.toString;t.exports=function(e){return r.call(e)}},{}],47:[function(e,t,n){var r=e("./_freeGlobal"),i="object"==typeof self&&self&&self.Object===Object&&self,o=r||i||Function("return this")();t.exports=o},{"./_freeGlobal":42}],48:[function(e,t,n){var r=e("./_baseSlice"),i=e("./_isIterateeCall"),o=e("./toInteger"),a=Math.ceil,s=Math.max;t.exports=function(e,t,n){t=(n?i(e,t,n):void 0===t)?1:s(o(t),0);var u=null==e?0:e.length;if(!u||t<1)return[];for(var c=0,f=0,l=Array(a(u/t));c<u;)l[f++]=r(e,c,c+=t);return l}},{"./_baseSlice":41,"./_isIterateeCall":45,"./toInteger":57}],49:[function(e,t,n){t.exports=function(e,t){return e===t||e!=e&&t!=t}},{}],50:[function(e,t,n){var r=e("./isFunction"),i=e("./isLength");t.exports=function(e){return null!=e&&i(e.length)&&!r(e)}},{"./isFunction":51,"./isLength":52}],51:[function(e,t,n){var r=e("./_baseGetTag"),i=e("./isObject"),o="[object AsyncFunction]",a="[object Function]",s="[object GeneratorFunction]",u="[object Proxy]";t.exports=function(e){if(!i(e))return!1;var t=r(e);return t==a||t==s||t==o||t==u}},{"./_baseGetTag":40,"./isObject":53}],52:[function(e,t,n){var r=9007199254740991;t.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}},{}],53:[function(e,t,n){t.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},{}],54:[function(e,t,n){t.exports=function(e){return null!=e&&"object"==typeof e}},{}],55:[function(e,t,n){var r=e("./_baseGetTag"),i=e("./isObjectLike"),o="[object Symbol]";t.exports=function(e){return"symbol"==typeof e||i(e)&&r(e)==o}},{"./_baseGetTag":40,"./isObjectLike":54}],56:[function(e,t,n){var r=e("./toNumber"),i=1/0,o=1.7976931348623157e308;t.exports=function(e){return e?(e=r(e))===i||e===-i?(e<0?-1:1)*o:e==e?e:0:0===e?e:0}},{"./toNumber":58}],57:[function(e,t,n){var r=e("./toFinite");t.exports=function(e){var t=r(e),n=t%1;return t==t?n?t-n:t:0}},{"./toFinite":56}],58:[function(e,t,n){var r=e("./isObject"),i=e("./isSymbol"),o=NaN,a=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,u=/^0b[01]+$/i,c=/^0o[0-7]+$/i,f=parseInt;t.exports=function(e){if("number"==typeof e)return e;if(i(e))return o;if(r(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=r(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(a,"");var n=u.test(e);return n||c.test(e)?f(e.slice(2),n?2:8):s.test(e)?o:+e}},{"./isObject":53,"./isSymbol":55}],59:[function(e,t,n){var r,i;r=this,i=function(){function e(e,t){this.id=H++,this.type=e,this.data=t}function t(e){return"["+function e(t){if(0===t.length)return[];var n=t.charAt(0),r=t.charAt(t.length-1);if(1<t.length&&n===r&&('"'===n||"'"===n))return['"'+t.substr(1,t.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(n=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t))return e(t.substr(0,n.index)).concat(e(n[1])).concat(e(t.substr(n.index+n[0].length)));if(1===(n=t.split(".")).length)return['"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];for(t=[],r=0;r<n.length;++r)t=t.concat(e(n[r]));return t}(e).join("][")+"]"}function n(e){return"string"==typeof e?e.split():e}function r(e){return"string"==typeof e?document.querySelector(e):e}function i(e){var t,i,o,a,s=e||{};e={};var u=[],c=[],f="undefined"==typeof window?1:window.devicePixelRatio,l=!1,d=function(e){},p=function(){};if("string"==typeof s?t=document.querySelector(s):"object"==typeof s&&("string"==typeof s.nodeName&&"function"==typeof s.appendChild&&"function"==typeof s.getBoundingClientRect?t=s:"function"==typeof s.drawArrays||"function"==typeof s.drawElements?o=(a=s).canvas:("gl"in s?a=s.gl:"canvas"in s?o=r(s.canvas):"container"in s&&(i=r(s.container)),"attributes"in s&&(e=s.attributes),"extensions"in s&&(u=n(s.extensions)),"optionalExtensions"in s&&(c=n(s.optionalExtensions)),"onDone"in s&&(d=s.onDone),"profile"in s&&(l=!!s.profile),"pixelRatio"in s&&(f=+s.pixelRatio))),t&&("canvas"===t.nodeName.toLowerCase()?o=t:i=t),!a){if(!o){if(!(t=function(e,t,n){function r(){var t=window.innerWidth,r=window.innerHeight;e!==document.body&&(t=(r=e.getBoundingClientRect()).right-r.left,r=r.bottom-r.top),i.width=n*t,i.height=n*r,N(i.style,{width:t+"px",height:r+"px"})}var i=document.createElement("canvas");return N(i.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(i),e===document.body&&(i.style.position="absolute",N(e.style,{margin:0,padding:0})),window.addEventListener("resize",r,!1),r(),{canvas:i,onDestroy:function(){window.removeEventListener("resize",r),e.removeChild(i)}}}(i||document.body,0,f)))return null;o=t.canvas,p=t.onDestroy}a=function(e,t){function n(n){try{return e.getContext(n,t)}catch(e){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}(o,e)}return a?{gl:a,canvas:o,container:i,extensions:u,optionalExtensions:c,pixelRatio:f,profile:l,onDone:d,onDestroy:p}:(p(),d("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function o(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}function a(e){var t,n;return t=(65535<e)<<4,t|=n=(255<(e>>>=t))<<3,(t|=n=(15<(e>>>=n))<<2)|(n=(3<(e>>>=n))<<1)|e>>>n>>1}function s(){function e(e){e:{for(var t=16;268435456>=t;t*=16)if(e<=t){e=t;break e}e=0}return 0<(t=n[a(e)>>2]).length?t.pop():new ArrayBuffer(e)}function t(e){n[a(e.byteLength)>>2].push(e)}var n=o(8,function(){return[]});return{alloc:e,free:t,allocType:function(t,n){var r=null;switch(t){case 5120:r=new Int8Array(e(n),0,n);break;case 5121:r=new Uint8Array(e(n),0,n);break;case 5122:r=new Int16Array(e(2*n),0,n);break;case 5123:r=new Uint16Array(e(2*n),0,n);break;case 5124:r=new Int32Array(e(4*n),0,n);break;case 5125:r=new Uint32Array(e(4*n),0,n);break;case 5126:r=new Float32Array(e(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r},freeType:function(e){t(e.buffer)}}}function u(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||Y(e.data))}function c(e,t,n,r,i,o){for(var a=0;a<t;++a)for(var s=e[a],u=0;u<n;++u)for(var c=s[u],f=0;f<r;++f)i[o++]=c[f]}function f(e){return 0|K[Object.prototype.toString.call(e)]}function l(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function d(e,t,n,r,i,o,a){for(var s=0,u=0;u<n;++u)for(var c=0;c<r;++c)e[s++]=t[i*u+o*c+a]}function p(e,t,n,r){function i(t){this.id=c++,this.buffer=e.createBuffer(),this.type=t,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=5121,this.persistentData=null,n.profile&&(this.stats={size:0})}function o(t,n,r){t.byteLength=n.byteLength,e.bufferData(t.type,n,r)}function a(e,t,n,r,i,a){if(e.usage=n,Array.isArray(t)){if(e.dtype=r||5126,0<t.length)if(Array.isArray(t[0])){i=ee(t);for(var s=r=1;s<i.length;++s)r*=i[s];e.dimension=r,o(e,t=$(t,i,e.dtype),n),a?e.persistentData=t:W.freeType(t)}else"number"==typeof t[0]?(e.dimension=i,l(i=W.allocType(e.dtype,t.length),t),o(e,i,n),a?e.persistentData=i:W.freeType(i)):Y(t[0])&&(e.dimension=t[0].length,e.dtype=r||f(t[0])||5126,o(e,t=$(t,[t.length,t[0].length],e.dtype),n),a?e.persistentData=t:W.freeType(t))}else if(Y(t))e.dtype=r||f(t),e.dimension=i,o(e,t,n),a&&(e.persistentData=new Uint8Array(new Uint8Array(t.buffer)));else if(u(t)){var c=t.stride,p=(s=t.offset,0),h=0,m=0,g=0;1===(i=t.shape).length?(p=i[0],h=1,m=c[0],g=0):2===i.length&&(p=i[0],h=i[1],m=c[0],g=c[1]),e.dtype=r||f(t.data)||5126,e.dimension=h,d(i=W.allocType(e.dtype,p*h),t.data,p,h,m,g,s),o(e,i,n),a?e.persistentData=i:W.freeType(i)}}function s(n){t.bufferCount--;for(var i=0;i<r.state.length;++i){var o=r.state[i];o.buffer===n&&(e.disableVertexAttribArray(i),o.buffer=null)}e.deleteBuffer(n.buffer),n.buffer=null,delete p[n.id]}var c=0,p={};i.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},i.prototype.destroy=function(){s(this)};var h=[];return n.profile&&(t.getTotalBufferSize=function(){var e=0;return Object.keys(p).forEach(function(t){e+=p[t].stats.size}),e}),{create:function(r,o,c,h){function m(t){var r=35044,i=null,o=0,s=0,c=1;return Array.isArray(t)||Y(t)||u(t)?i=t:"number"==typeof t?o=0|t:t&&("data"in t&&(i=t.data),"usage"in t&&(r=Z[t.usage]),"type"in t&&(s=J[t.type]),"dimension"in t&&(c=0|t.dimension),"length"in t&&(o=0|t.length)),g.bind(),i?a(g,i,r,s,c,h):(o&&e.bufferData(g.type,o,r),g.dtype=s||5121,g.usage=r,g.dimension=c,g.byteLength=o),n.profile&&(g.stats.size=g.byteLength*te[g.dtype]),m}t.bufferCount++;var g=new i(o);return p[g.id]=g,c||m(r),m._reglType="buffer",m._buffer=g,m.subdata=function(t,n){var r,i=0|(n||0);if(g.bind(),Y(t))e.bufferSubData(g.type,i,t);else if(Array.isArray(t)){if(0<t.length)if("number"==typeof t[0]){var o=W.allocType(g.dtype,t.length);l(o,t),e.bufferSubData(g.type,i,o),W.freeType(o)}else(Array.isArray(t[0])||Y(t[0]))&&(r=ee(t),o=$(t,r,g.dtype),e.bufferSubData(g.type,i,o),W.freeType(o))}else if(u(t)){var a=t.stride,s=o=0,c=0,p=0;1===(r=t.shape).length?(o=r[0],s=1,c=a[0],p=0):2===r.length&&(o=r[0],s=r[1],c=a[0],p=a[1]),r=Array.isArray(t.data)?g.dtype:f(t.data),d(r=W.allocType(r,o*s),t.data,o,s,c,p,t.offset),e.bufferSubData(g.type,i,r),W.freeType(r)}return m},n.profile&&(m.stats=g.stats),m.destroy=function(){s(g)},m},createStream:function(e,t){var n=h.pop();return n||(n=new i(e)),n.bind(),a(n,t,35040,0,1,!1),n},destroyStream:function(e){h.push(e)},clear:function(){Q(p).forEach(s),h.forEach(s)},getBuffer:function(e){return e&&e._buffer instanceof i?e._buffer:null},restore:function(){Q(p).forEach(function(t){t.buffer=e.createBuffer(),e.bindBuffer(t.type,t.buffer),e.bufferData(t.type,t.persistentData||t.byteLength,t.usage)})},_initBuffer:a}}function h(e,t,n,r){function i(e){this.id=c++,s[this.id]=this,this.buffer=e,this.primType=4,this.type=this.vertCount=0}function o(r,i,o,a,s,c,f){if(r.buffer.bind(),i){var l=f;f||Y(i)&&(!u(i)||Y(i.data))||(l=t.oes_element_index_uint?5125:5123),n._initBuffer(r.buffer,i,o,l,3)}else e.bufferData(34963,c,o),r.buffer.dtype=l||5121,r.buffer.usage=o,r.buffer.dimension=3,r.buffer.byteLength=c;if(l=f,!f){switch(r.buffer.dtype){case 5121:case 5120:l=5121;break;case 5123:case 5122:l=5123;break;case 5125:case 5124:l=5125}r.buffer.dtype=l}r.type=l,0>(i=s)&&(i=r.buffer.byteLength,5123===l?i>>=1:5125===l&&(i>>=2)),r.vertCount=i,i=a,0>a&&(i=4,1===(a=r.buffer.dimension)&&(i=0),2===a&&(i=1),3===a&&(i=4)),r.primType=i}function a(e){r.elementsCount--,delete s[e.id],e.buffer.destroy(),e.buffer=null}var s={},c=0,f={uint8:5121,uint16:5123};t.oes_element_index_uint&&(f.uint32=5125),i.prototype.bind=function(){this.buffer.bind()};var l=[];return{create:function(e,t){function s(e){if(e)if("number"==typeof e)c(e),l.primType=4,l.vertCount=0|e,l.type=5121;else{var t=null,n=35044,r=-1,i=-1,a=0,d=0;Array.isArray(e)||Y(e)||u(e)?t=e:("data"in e&&(t=e.data),"usage"in e&&(n=Z[e.usage]),"primitive"in e&&(r=ne[e.primitive]),"count"in e&&(i=0|e.count),"type"in e&&(d=f[e.type]),"length"in e?a=0|e.length:(a=i,5123===d||5122===d?a*=2:5125!==d&&5124!==d||(a*=4))),o(l,t,n,r,i,a,d)}else c(),l.primType=4,l.vertCount=0,l.type=5121;return s}var c=n.create(null,34963,!0),l=new i(c._buffer);return r.elementsCount++,s(e),s._reglType="elements",s._elements=l,s.subdata=function(e,t){return c.subdata(e,t),s},s.destroy=function(){a(l)},s},createStream:function(e){var t=l.pop();return t||(t=new i(n.create(null,34963,!0,!1)._buffer)),o(t,e,35040,-1,-1,0,0),t},destroyStream:function(e){l.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof i?e._elements:null},clear:function(){Q(s).forEach(a)}}}function m(e){for(var t=W.allocType(5123,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(Infinity===e[n])t[n]=31744;else if(-Infinity===e[n])t[n]=64512;else{re[0]=e[n];var r=(o=ie[0])>>>31<<15,i=(o<<1>>>24)-127,o=o>>13&1023;t[n]=-24>i?r:-14>i?r+(o+1024>>-14-i):15<i?r+31744:r+(i+15<<10)+o}return t}function g(e){return Array.isArray(e)||Y(e)}function v(e){return"[object "+e+"]"}function b(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function y(e){return!(!Array.isArray(e)||0===e.length||!g(e[0]))}function _(e){return Object.prototype.toString.call(e)}function w(e){if(!e)return!1;var t=_(e);return 0<=pe.indexOf(t)||(b(e)||y(e)||u(e))}function x(e,t){36193===e.type?(e.data=m(t),W.freeType(t)):e.data=t}function k(e,t,n,r,i,o){if(e=void 0!==me[e]?me[e]:se[e]*he[t],o&&(e*=6),i){for(r=0;1<=n;)r+=e*n*n,n/=2;return r}return e*n*r}function A(e,t,n,r,i,o,a){function s(){this.format=this.internalformat=6408,this.type=5121,this.flipY=this.premultiplyAlpha=this.compressed=!1,this.unpackAlignment=1,this.colorSpace=37444,this.channels=this.height=this.width=0}function c(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function f(e,t){if("object"==typeof t&&t){"premultiplyAlpha"in t&&(e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(e.flipY=t.flipY),"alignment"in t&&(e.unpackAlignment=t.alignment),"colorSpace"in t&&(e.colorSpace=V[t.colorSpace]),"type"in t&&(e.type=G[t.type]);var n=e.width,r=e.height,i=e.channels,o=!1;"shape"in t?(n=t.shape[0],r=t.shape[1],3===t.shape.length&&(i=t.shape[2],o=!0)):("radius"in t&&(n=r=t.radius),"width"in t&&(n=t.width),"height"in t&&(r=t.height),"channels"in t&&(i=t.channels,o=!0)),e.width=0|n,e.height=0|r,e.channels=0|i,n=!1,"format"in t&&(r=e.internalformat=q[n=t.format],e.format=pe[r],n in G&&!("type"in t)&&(e.type=G[n]),n in J&&(e.compressed=!0),n=!0),!o&&n?e.channels=se[e.format]:o&&!n&&e.channels!==ae[e.format]&&(e.format=e.internalformat=ae[e.channels])}}function l(t){e.pixelStorei(37440,t.flipY),e.pixelStorei(37441,t.premultiplyAlpha),e.pixelStorei(37443,t.colorSpace),e.pixelStorei(3317,t.unpackAlignment)}function d(){s.call(this),this.yOffset=this.xOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function p(e,t){var n=null;if(w(t)?n=t:t&&(f(e,t),"x"in t&&(e.xOffset=0|t.x),"y"in t&&(e.yOffset=0|t.y),w(t.data)&&(n=t.data)),t.copy){var r=i.viewportWidth,o=i.viewportHeight;e.width=e.width||r-e.xOffset,e.height=e.height||o-e.yOffset,e.needsCopy=!0}else if(n){if(Y(n))e.channels=e.channels||4,e.data=n,"type"in t||5121!==e.type||(e.type=0|K[Object.prototype.toString.call(n)]);else if(b(n)){switch(e.channels=e.channels||4,o=(r=n).length,e.type){case 5121:case 5123:case 5125:case 5126:(o=W.allocType(e.type,o)).set(r),e.data=o;break;case 36193:e.data=m(r)}e.alignment=1,e.needsFree=!0}else if(u(n)){r=n.data,Array.isArray(r)||5121!==e.type||(e.type=0|K[Object.prototype.toString.call(r)]);var a,s,c,l,d=n.stride;3===(o=n.shape).length?(c=o[2],l=d[2]):l=c=1,a=o[0],s=o[1],o=d[0],d=d[1],e.alignment=1,e.width=a,e.height=s,e.channels=c,e.format=e.internalformat=ae[c],e.needsFree=!0,a=l,n=n.offset;for(var p=W.allocType(36193===e.type?5126:e.type,(c=e.width)*(l=e.height)*(s=e.channels)),h=0,v=0;v<l;++v)for(var k=0;k<c;++k)for(var A=0;A<s;++A)p[h++]=r[o*k+d*v+a*A+n];x(e,p)}else if(_(n)===ue||_(n)===ce)e.element=_(n)===ue?n:n.canvas,e.width=e.element.width,e.height=e.element.height,e.channels=4;else if(_(n)===fe)e.element=n,e.width=n.width,e.height=n.height,e.channels=4;else if(_(n)===le)e.element=n,e.width=n.naturalWidth,e.height=n.naturalHeight,e.channels=4;else if(_(n)===de)e.element=n,e.width=n.videoWidth,e.height=n.videoHeight,e.channels=4;else if(y(n)){for(r=e.width||n[0].length,o=e.height||n.length,d=e.channels,d=g(n[0][0])?d||n[0][0].length:d||1,a=X.shape(n),c=1,l=0;l<a.length;++l)c*=a[l];c=W.allocType(36193===e.type?5126:e.type,c),X.flatten(n,a,"",c),x(e,c),e.alignment=1,e.width=r,e.height=o,e.channels=d,e.format=e.internalformat=ae[d],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1,e.channels=e.channels||4}function h(t,n,i,o,a){var s=t.element,u=t.data,c=t.internalformat,f=t.format,d=t.type,p=t.width,h=t.height;l(t),s?e.texSubImage2D(n,a,i,o,f,d,s):t.compressed?e.compressedTexSubImage2D(n,a,i,o,c,p,h,u):t.needsCopy?(r(),e.copyTexSubImage2D(n,a,i,o,t.xOffset,t.yOffset,p,h)):e.texSubImage2D(n,a,i,o,p,h,f,d,u)}function v(){return he.pop()||new d}function A(e){e.needsFree&&W.freeType(e.data),d.call(e),he.push(e)}function E(){s.call(this),this.genMipmaps=!1,this.mipmapHint=4352,this.mipmask=0,this.images=Array(16)}function C(e,t,n){var r=e.images[0]=v();e.mipmask=1,r.width=e.width=t,r.height=e.height=n,r.channels=e.channels=4}function S(e,t){var n=null;if(w(t))c(n=e.images[0]=v(),e),p(n,t),e.mipmask=1;else if(f(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,i=0;i<r.length;++i)c(n=e.images[i]=v(),e),n.width>>=i,n.height>>=i,p(n,r[i]),e.mipmask|=1<<i;else c(n=e.images[0]=v(),e),p(n,t),e.mipmask=1;c(e,e.images[0])}function T(t,n){for(var i=t.images,o=0;o<i.length&&i[o];++o){var a=i[o],s=n,u=o,c=a.element,f=a.data,d=a.internalformat,p=a.format,h=a.type,m=a.width,g=a.height,v=a.channels;l(a),c?e.texImage2D(s,u,p,p,h,c):a.compressed?e.compressedTexImage2D(s,u,d,m,g,0,f):a.needsCopy?(r(),e.copyTexImage2D(s,u,p,a.xOffset,a.yOffset,m,g,0)):((a=!f)&&(f=W.zero.allocType(h,m*g*v)),e.texImage2D(s,u,p,m,g,0,p,h,f),a&&f&&W.zero.freeType(f))}}function O(){var e=me.pop()||new E;s.call(e);for(var t=e.mipmask=0;16>t;++t)e.images[t]=null;return e}function D(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&A(t[n]),t[n]=null;me.push(e)}function M(){this.magFilter=this.minFilter=9728,this.wrapT=this.wrapS=33071,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=4352}function P(e,t){"min"in t&&(e.minFilter=U[t.min],0<=oe.indexOf(e.minFilter)&&!("faces"in t)&&(e.genMipmaps=!0)),"mag"in t&&(e.magFilter=H[t.mag]);var n=e.wrapS,r=e.wrapT;if("wrap"in t){var i=t.wrap;"string"==typeof i?n=r=I[i]:Array.isArray(i)&&(n=I[i[0]],r=I[i[1]])}else"wrapS"in t&&(n=I[t.wrapS]),"wrapT"in t&&(r=I[t.wrapT]);if(e.wrapS=n,e.wrapT=r,"anisotropic"in t&&(e.anisotropic=t.anisotropic),"mipmap"in t){switch(n=!1,typeof t.mipmap){case"string":e.mipmapHint=L[t.mipmap],n=e.genMipmaps=!0;break;case"boolean":n=e.genMipmaps=t.mipmap;break;case"object":e.genMipmaps=!1,n=!0}!n||"min"in t||(e.minFilter=9984)}}function F(n,r){e.texParameteri(r,10241,n.minFilter),e.texParameteri(r,10240,n.magFilter),e.texParameteri(r,10242,n.wrapS),e.texParameteri(r,10243,n.wrapT),t.ext_texture_filter_anisotropic&&e.texParameteri(r,34046,n.anisotropic),n.genMipmaps&&(e.hint(33170,n.mipmapHint),e.generateMipmap(r))}function j(t){s.call(this),this.mipmask=0,this.internalformat=6408,this.id=ge++,this.refCount=1,this.target=t,this.texture=e.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new M,a.profile&&(this.stats={size:0})}function z(t){e.activeTexture(33984),e.bindTexture(t.target,t.texture)}function R(){var t=ye[0];t?e.bindTexture(t.target,t.texture):e.bindTexture(3553,null)}function B(t){var n=t.texture,r=t.unit,i=t.target;0<=r&&(e.activeTexture(33984+r),e.bindTexture(i,null),ye[r]=null),e.deleteTexture(n),t.texture=null,t.params=null,t.pixels=null,t.refCount=0,delete ve[t.id],o.textureCount--}var L={"don't care":4352,"dont care":4352,nice:4354,fast:4353},I={repeat:10497,clamp:33071,mirror:33648},H={nearest:9728,linear:9729},U=N({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},H),V={none:0,browser:37444},G={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},q={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},J={};t.ext_srgb&&(q.srgb=35904,q.srgba=35906),t.oes_texture_float&&(G.float32=G.float=5126),t.oes_texture_half_float&&(G.float16=G["half float"]=36193),t.webgl_depth_texture&&(N(q,{depth:6402,"depth stencil":34041}),N(G,{uint16:5123,uint32:5125,"depth stencil":34042})),t.webgl_compressed_texture_s3tc&&N(J,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779}),t.webgl_compressed_texture_atc&&N(J,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),t.webgl_compressed_texture_pvrtc&&N(J,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),t.webgl_compressed_texture_etc1&&(J["rgb etc1"]=36196);var Z=Array.prototype.slice.call(e.getParameter(34467));Object.keys(J).forEach(function(e){var t=J[e];0<=Z.indexOf(t)&&(q[e]=t)});var $=Object.keys(q);n.textureFormats=$;var ee=[];Object.keys(q).forEach(function(e){ee[q[e]]=e});var te=[];Object.keys(G).forEach(function(e){te[G[e]]=e});var ne=[];Object.keys(H).forEach(function(e){ne[H[e]]=e});var re=[];Object.keys(U).forEach(function(e){re[U[e]]=e});var ie=[];Object.keys(I).forEach(function(e){ie[I[e]]=e});var pe=$.reduce(function(e,t){var n=q[t];return e[n]=6409===n||6406===n||6409===n||6410===n||6402===n||34041===n?n:32855===n||0<=t.indexOf("rgba")?6408:6407,e},{}),he=[],me=[],ge=0,ve={},be=n.maxTextureUnits,ye=Array(be).map(function(){return null});return N(j.prototype,{bind:function(){this.bindCount+=1;var t=this.unit;if(0>t){for(var n=0;n<be;++n){var r=ye[n];if(r){if(0<r.bindCount)continue;r.unit=-1}ye[n]=this,t=n;break}a.profile&&o.maxTextureUnits<t+1&&(o.maxTextureUnits=t+1),this.unit=t,e.activeTexture(33984+t),e.bindTexture(this.target,this.texture)}return t},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&B(this)}}),a.profile&&(o.getTotalTextureSize=function(){var e=0;return Object.keys(ve).forEach(function(t){e+=ve[t].stats.size}),e}),{create2D:function(t,n){function r(e,t){var n=i.texInfo;M.call(n);var o=O();return"number"==typeof e?C(o,0|e,"number"==typeof t?0|t:0|e):e?(P(n,e),S(o,e)):C(o,1,1),n.genMipmaps&&(o.mipmask=(o.width<<1)-1),i.mipmask=o.mipmask,c(i,o),i.internalformat=o.internalformat,r.width=o.width,r.height=o.height,z(i),T(o,3553),F(n,3553),R(),D(o),a.profile&&(i.stats.size=k(i.internalformat,i.type,o.width,o.height,n.genMipmaps,!1)),r.format=ee[i.internalformat],r.type=te[i.type],r.mag=ne[n.magFilter],r.min=re[n.minFilter],r.wrapS=ie[n.wrapS],r.wrapT=ie[n.wrapT],r}var i=new j(3553);return ve[i.id]=i,o.textureCount++,r(t,n),r.subimage=function(e,t,n,o){t|=0,n|=0,o|=0;var a=v();return c(a,i),a.width=0,a.height=0,p(a,e),a.width=a.width||(i.width>>o)-t,a.height=a.height||(i.height>>o)-n,z(i),h(a,3553,t,n,o),R(),A(a),r},r.resize=function(t,n){var o=0|t,s=0|n||o;if(o===i.width&&s===i.height)return r;r.width=i.width=o,r.height=i.height=s,z(i);for(var u,c=i.channels,f=i.type,l=0;i.mipmask>>l;++l){var d=o>>l,p=s>>l;if(!d||!p)break;u=W.zero.allocType(f,d*p*c),e.texImage2D(3553,l,i.format,d,p,0,i.format,i.type,u),u&&W.zero.freeType(u)}return R(),a.profile&&(i.stats.size=k(i.internalformat,i.type,o,s,!1,!1)),r},r._reglType="texture2d",r._texture=i,a.profile&&(r.stats=i.stats),r.destroy=function(){i.decRef()},r},createCube:function(t,n,r,i,s,u){function l(e,t,n,r,i,o){var s,u=d.texInfo;for(M.call(u),s=0;6>s;++s)m[s]=O();if("number"!=typeof e&&e){if("object"==typeof e)if(t)S(m[0],e),S(m[1],t),S(m[2],n),S(m[3],r),S(m[4],i),S(m[5],o);else if(P(u,e),f(d,e),"faces"in e)for(e=e.faces,s=0;6>s;++s)c(m[s],d),S(m[s],e[s]);else for(s=0;6>s;++s)S(m[s],e)}else for(e=0|e||1,s=0;6>s;++s)C(m[s],e,e);for(c(d,m[0]),d.mipmask=u.genMipmaps?(m[0].width<<1)-1:m[0].mipmask,d.internalformat=m[0].internalformat,l.width=m[0].width,l.height=m[0].height,z(d),s=0;6>s;++s)T(m[s],34069+s);for(F(u,34067),R(),a.profile&&(d.stats.size=k(d.internalformat,d.type,l.width,l.height,u.genMipmaps,!0)),l.format=ee[d.internalformat],l.type=te[d.type],l.mag=ne[u.magFilter],l.min=re[u.minFilter],l.wrapS=ie[u.wrapS],l.wrapT=ie[u.wrapT],s=0;6>s;++s)D(m[s]);return l}var d=new j(34067);ve[d.id]=d,o.cubeCount++;var m=Array(6);return l(t,n,r,i,s,u),l.subimage=function(e,t,n,r,i){n|=0,r|=0,i|=0;var o=v();return c(o,d),o.width=0,o.height=0,p(o,t),o.width=o.width||(d.width>>i)-n,o.height=o.height||(d.height>>i)-r,z(d),h(o,34069+e,n,r,i),R(),A(o),l},l.resize=function(t){if((t|=0)!==d.width){l.width=d.width=t,l.height=d.height=t,z(d);for(var n=0;6>n;++n)for(var r=0;d.mipmask>>r;++r)e.texImage2D(34069+n,r,d.format,t>>r,t>>r,0,d.format,d.type,null);return R(),a.profile&&(d.stats.size=k(d.internalformat,d.type,l.width,l.height,!1,!0)),l}},l._reglType="textureCube",l._texture=d,a.profile&&(l.stats=d.stats),l.destroy=function(){d.decRef()},l},clear:function(){for(var t=0;t<be;++t)e.activeTexture(33984+t),e.bindTexture(3553,null),ye[t]=null;Q(ve).forEach(B),o.cubeCount=0,o.textureCount=0},getTexture:function(e){return null},restore:function(){for(var t=0;t<be;++t){var n=ye[t];n&&(n.bindCount=0,n.unit=-1,ye[t]=null)}Q(ve).forEach(function(t){t.texture=e.createTexture(),e.bindTexture(t.target,t.texture);for(var n=0;32>n;++n)if(0!=(t.mipmask&1<<n))if(3553===t.target)e.texImage2D(3553,n,t.internalformat,t.width>>n,t.height>>n,0,t.internalformat,t.type,null);else for(var r=0;6>r;++r)e.texImage2D(34069+r,n,t.internalformat,t.width>>n,t.height>>n,0,t.internalformat,t.type,null);F(t.texInfo,t.target)})}}}function E(e,t,n,r,i,o){function a(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=e=0;t?(e=t.width,r=t.height):n&&(e=n.width,r=n.height),this.width=e,this.height=r}function s(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function u(e,t,n){e&&(e.texture?e.texture._texture.refCount+=1:e.renderbuffer._renderbuffer.refCount+=1)}function c(t,n){n&&(n.texture?e.framebufferTexture2D(36160,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(36160,t,36161,n.renderbuffer._renderbuffer.renderbuffer))}function f(e){var t=3553,n=null,r=null,i=e;return"object"==typeof e&&(i=e.data,"target"in e&&(t=0|e.target)),"texture2d"===(e=i._reglType)?n=i:"textureCube"===e?n=i:"renderbuffer"===e&&(r=i,t=36161),new a(t,n,r)}function l(e,t,n,o,s){return n?((e=r.create2D({width:e,height:t,format:o,type:s}))._texture.refCount=0,new a(3553,e,null)):((e=i.create({width:e,height:t,format:o}))._renderbuffer.refCount=0,new a(36161,null,e))}function d(e){return e&&(e.texture||e.renderbuffer)}function p(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n),e.width=t,e.height=n)}function h(){this.id=k++,A[this.id]=this,this.framebuffer=e.createFramebuffer(),this.height=this.width=0,this.colorAttachments=[],this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function m(e){e.colorAttachments.forEach(s),s(e.depthAttachment),s(e.stencilAttachment),s(e.depthStencilAttachment)}function g(t){e.deleteFramebuffer(t.framebuffer),t.framebuffer=null,o.framebufferCount--,delete A[t.id]}function v(t){var r;e.bindFramebuffer(36160,t.framebuffer);var i=t.colorAttachments;for(r=0;r<i.length;++r)c(36064+r,i[r]);for(r=i.length;r<n.maxColorAttachments;++r)e.framebufferTexture2D(36160,36064+r,3553,null,0);e.framebufferTexture2D(36160,33306,3553,null,0),e.framebufferTexture2D(36160,36096,3553,null,0),e.framebufferTexture2D(36160,36128,3553,null,0),c(36096,t.depthAttachment),c(36128,t.stencilAttachment),c(33306,t.depthStencilAttachment),e.checkFramebufferStatus(36160),e.isContextLost(),e.bindFramebuffer(36160,y.next?y.next.framebuffer:null),y.cur=y.next,e.getError()}function b(e,t){function n(e,t){var i,o=0,a=0,s=!0,c=!0;i=null;var p=!0,h="rgba",g="uint8",b=1,y=null,x=null,k=null,A=!1;"number"==typeof e?(o=0|e,a=0|t||o):e?("shape"in e?(o=(a=e.shape)[0],a=a[1]):("radius"in e&&(o=a=e.radius),"width"in e&&(o=e.width),"height"in e&&(a=e.height)),("color"in e||"colors"in e)&&(i=e.color||e.colors,Array.isArray(i)),i||("colorCount"in e&&(b=0|e.colorCount),"colorTexture"in e&&(p=!!e.colorTexture,h="rgba4"),"colorType"in e&&(g=e.colorType,!p)&&("half float"===g||"float16"===g?h="rgba16f":"float"!==g&&"float32"!==g||(h="rgba32f")),"colorFormat"in e&&(0<=_.indexOf(h=e.colorFormat)?p=!0:0<=w.indexOf(h)&&(p=!1))),("depthTexture"in e||"depthStencilTexture"in e)&&(A=!(!e.depthTexture&&!e.depthStencilTexture)),"depth"in e&&("boolean"==typeof e.depth?s=e.depth:(y=e.depth,c=!1)),"stencil"in e&&("boolean"==typeof e.stencil?c=e.stencil:(x=e.stencil,s=!1)),"depthStencil"in e&&("boolean"==typeof e.depthStencil?s=c=e.depthStencil:(k=e.depthStencil,c=s=!1))):o=a=1;var E=null,C=null,S=null,T=null;if(Array.isArray(i))E=i.map(f);else if(i)E=[f(i)];else for(E=Array(b),i=0;i<b;++i)E[i]=l(o,a,p,h,g);for(o=o||E[0].width,a=a||E[0].height,y?C=f(y):s&&!c&&(C=l(o,a,A,"depth","uint32")),x?S=f(x):c&&!s&&(S=l(o,a,!1,"stencil","uint8")),k?T=f(k):!y&&!x&&c&&s&&(T=l(o,a,A,"depth stencil","depth stencil")),s=null,i=0;i<E.length;++i)u(E[i]),E[i]&&E[i].texture&&(c=be[E[i].texture._texture.format]*ye[E[i].texture._texture.type],null===s&&(s=c));return u(C),u(S),u(T),m(r),r.width=o,r.height=a,r.colorAttachments=E,r.depthAttachment=C,r.stencilAttachment=S,r.depthStencilAttachment=T,n.color=E.map(d),n.depth=d(C),n.stencil=d(S),n.depthStencil=d(T),n.width=r.width,n.height=r.height,v(r),n}var r=new h;return o.framebufferCount++,n(e,t),N(n,{resize:function(e,t){var i=Math.max(0|e,1),o=Math.max(0|t||i,1);if(i===r.width&&o===r.height)return n;for(var a=r.colorAttachments,s=0;s<a.length;++s)p(a[s],i,o);return p(r.depthAttachment,i,o),p(r.stencilAttachment,i,o),p(r.depthStencilAttachment,i,o),r.width=n.width=i,r.height=n.height=o,v(r),n},_reglType:"framebuffer",_framebuffer:r,destroy:function(){g(r),m(r)},use:function(e){y.setFBO({framebuffer:n},e)}})}var y={cur:null,next:null,dirty:!1,setFBO:null},_=["rgba"],w=["rgba4","rgb565","rgb5 a1"];t.ext_srgb&&w.push("srgba"),t.ext_color_buffer_half_float&&w.push("rgba16f","rgb16f"),t.webgl_color_buffer_float&&w.push("rgba32f");var x=["uint8"];t.oes_texture_half_float&&x.push("half float","float16"),t.oes_texture_float&&x.push("float","float32");var k=0,A={};return N(y,{getFramebuffer:function(e){return"function"==typeof e&&"framebuffer"===e._reglType&&(e=e._framebuffer)instanceof h?e:null},create:b,createCube:function(e){function t(e){var i,o={color:null},a=0,s=null;i="rgba";var u="uint8",c=1;if("number"==typeof e?a=0|e:e?("shape"in e?a=e.shape[0]:("radius"in e&&(a=0|e.radius),"width"in e?a=0|e.width:"height"in e&&(a=0|e.height)),("color"in e||"colors"in e)&&(s=e.color||e.colors,Array.isArray(s)),s||("colorCount"in e&&(c=0|e.colorCount),"colorType"in e&&(u=e.colorType),"colorFormat"in e&&(i=e.colorFormat)),"depth"in e&&(o.depth=e.depth),"stencil"in e&&(o.stencil=e.stencil),"depthStencil"in e&&(o.depthStencil=e.depthStencil)):a=1,s)if(Array.isArray(s))for(e=[],i=0;i<s.length;++i)e[i]=s[i];else e=[s];else for(e=Array(c),s={radius:a,format:i,type:u},i=0;i<c;++i)e[i]=r.createCube(s);for(o.color=Array(e.length),i=0;i<e.length;++i)c=e[i],a=a||c.width,o.color[i]={target:34069,data:e[i]};for(i=0;6>i;++i){for(c=0;c<e.length;++c)o.color[c].target=34069+i;0<i&&(o.depth=n[0].depth,o.stencil=n[0].stencil,o.depthStencil=n[0].depthStencil),n[i]?n[i](o):n[i]=b(o)}return N(t,{width:a,height:a,color:e})}var n=Array(6);return t(e),N(t,{faces:n,resize:function(e){var r=0|e;if(r===t.width)return t;var i=t.color;for(e=0;e<i.length;++e)i[e].resize(r);for(e=0;6>e;++e)n[e].resize(r);return t.width=t.height=r,t},_reglType:"framebufferCube",destroy:function(){n.forEach(function(e){e.destroy()})}})},clear:function(){Q(A).forEach(g)},restore:function(){y.cur=null,y.next=null,y.dirty=!0,Q(A).forEach(function(t){t.framebuffer=e.createFramebuffer(),v(t)})}})}function C(){this.w=this.z=this.y=this.x=this.state=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.divisor=this.stride=this.offset=0}function S(e,t,n,r){function i(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function o(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function a(n,r,i){if(!(a=(i=35632===n?c:f)[r])){var o=t.str(r),a=e.createShader(n);e.shaderSource(a,o),e.compileShader(a),i[r]=a}return a}function s(e,t){this.id=p++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],r.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function u(n,s){var u,c;u=a(35632,n.fragId),c=a(35633,n.vertId);var f=n.program=e.createProgram();e.attachShader(f,u),e.attachShader(f,c),e.linkProgram(f);var l=e.getProgramParameter(f,35718);r.profile&&(n.stats.uniformsCount=l);var d=n.uniforms;for(u=0;u<l;++u)if(c=e.getActiveUniform(f,u))if(1<c.size)for(var p=0;p<c.size;++p){var h=c.name.replace("[0]","["+p+"]");o(d,new i(h,t.id(h),e.getUniformLocation(f,h),c))}else o(d,new i(c.name,t.id(c.name),e.getUniformLocation(f,c.name),c));for(l=e.getProgramParameter(f,35721),r.profile&&(n.stats.attributesCount=l),d=n.attributes,u=0;u<l;++u)(c=e.getActiveAttrib(f,u))&&o(d,new i(c.name,t.id(c.name),e.getAttribLocation(f,c.name),c))}var c={},f={},l={},d=[],p=0;return r.profile&&(n.getMaxUniformsCount=function(){var e=0;return d.forEach(function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)}),e},n.getMaxAttributesCount=function(){var e=0;return d.forEach(function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)}),e}),{clear:function(){var t=e.deleteShader.bind(e);Q(c).forEach(t),c={},Q(f).forEach(t),f={},d.forEach(function(t){e.deleteProgram(t.program)}),d.length=0,l={},n.shaderCount=0},program:function(e,t,r){var i=l[t];i||(i=l[t]={});var o=i[e];return o||(o=new s(t,e),n.shaderCount++,u(o),i[e]=o,d.push(o)),o},restore:function(){c={},f={};for(var e=0;e<d.length;++e)u(d[e])},shader:a,frag:-1,vert:-1}}function T(e,t,n,r,i,o,a){function s(i){var o;o=null===t.next?5121:t.next.colorAttachments[0].texture._texture.type;var a=0,s=0,u=r.framebufferWidth,c=r.framebufferHeight,f=null;return Y(i)?f=i:i&&(a=0|i.x,s=0|i.y,u=0|(i.width||r.framebufferWidth-a),c=0|(i.height||r.framebufferHeight-s),f=i.data||null),n(),i=u*c*4,f||(5121===o?f=new Uint8Array(i):5126===o&&(f=f||new Float32Array(i))),e.pixelStorei(3333,4),e.readPixels(a,s,u,c,6408,o,f),f}return function(e){return e&&"framebuffer"in e?function(e){var n;return t.setFBO({framebuffer:e.framebuffer},function(){n=s(e)}),n}(e):s(e)}}function O(e){return Array.prototype.slice.call(e)}function D(e){return O(e).join("")}function M(){function e(){var e=[],t=[];return N(function(){e.push.apply(e,O(arguments))},{def:function(){var r="v"+n++;return t.push(r),0<arguments.length&&(e.push(r,"="),e.push.apply(e,O(arguments)),e.push(";")),r},toString:function(){return D([0<t.length?"var "+t+";":"",D(e)])}})}function t(){function t(e,t){r(e,t,"=",n.def(e,t),";")}var n=e(),r=e(),i=n.toString,o=r.toString;return N(function(){n.apply(n,O(arguments))},{def:n.def,entry:n,exit:r,save:t,set:function(e,r,i){t(e,r),n(e,r,"=",i,";")},toString:function(){return i()+o()}})}var n=0,r=[],i=[],o=e(),a={};return{global:o,link:function(e){for(var t=0;t<i.length;++t)if(i[t]===e)return r[t];return t="g"+n++,r.push(t),i.push(e),t},block:e,proc:function(e,n){function r(){var e="a"+i.length;return i.push(e),e}var i=[];n=n||0;for(var o=0;o<n;++o)r();var s=(o=t()).toString;return a[e]=N(o,{arg:r,toString:function(){return D(["function(",i.join(),"){",s(),"}"])}})},scope:t,cond:function(){var e=D(arguments),n=t(),r=t(),i=n.toString,o=r.toString;return N(n,{then:function(){return n.apply(n,O(arguments)),this},else:function(){return r.apply(r,O(arguments)),this},toString:function(){var t=o();return t&&(t="else{"+t+"}"),D(["if(",e,"){",i(),"}",t])}})},compile:function(){var e=['"use strict";',o,"return {"];Object.keys(a).forEach(function(t){e.push('"',t,'":',a[t].toString(),",")}),e.push("}");var t=D(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,r.concat(t)).apply(null,i)}}}function P(e){return Array.isArray(e)||Y(e)||u(e)}function F(e){return e.sort(function(e,t){return"viewport"===e?-1:"viewport"===t?1:e<t?-1:1})}function j(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function z(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function R(e){return new j(!1,!1,!1,e)}function B(e,t){var n=e.type;return 0===n?new j(!0,1<=(n=e.data.length),2<=n,t):4===n?new j((n=e.data).thisDep,n.contextDep,n.propDep,t):new j(3===n,2===n,1===n,t)}function L(e,t,n,r,i,a,s,u,c,f,l,d,p,h,m){function v(e){return e.replace(".","_")}function b(e,t,n){var r=v(e);re.push(e),te[r]=ee[r]=!!n,ie[r]=t}function y(e,t,n){var r=v(e);re.push(e),Array.isArray(n)?(ee[r]=n.slice(),te[r]=n.slice()):ee[r]=te[r]=n,oe[r]=t}function _(){var e=M(),n=e.link,r=e.global;e.id=ue++,e.batchId="0";var i=n(ae),o=e.shared={props:"a0"};Object.keys(ae).forEach(function(e){o[e]=r.def(i,".",e)});var a=e.next={},s=e.current={};Object.keys(oe).forEach(function(e){Array.isArray(ee[e])&&(a[e]=r.def(o.next,".",e),s[e]=r.def(o.current,".",e))});var u=e.constants={};Object.keys(se).forEach(function(e){u[e]=r.def(JSON.stringify(se[e]))}),e.invoke=function(t,r){switch(r.type){case 0:var i=["this",o.context,o.props,e.batchId];return t.def(n(r.data),".call(",i.slice(0,Math.max(r.data.length+1,4)),")");case 1:return t.def(o.props,r.data);case 2:return t.def(o.context,r.data);case 3:return t.def("this",r.data);case 4:return r.data.append(e,t),r.data.ref}},e.attribCache={};var c={};return e.scopeAttrib=function(e){if((e=t.id(e))in c)return c[e];var r=f.scope[e];return r||(r=f.scope[e]=new X),c[e]=n(r)},e}function w(e,t){var n=e.static,r=e.dynamic;if("framebuffer"in n){var i=n.framebuffer;return i?(i=u.getFramebuffer(i),R(function(e,t){var n=e.link(i),r=e.shared;return t.set(r.framebuffer,".next",n),t.set(r=r.context,".framebufferWidth",n+".width"),t.set(r,".framebufferHeight",n+".height"),n})):R(function(e,t){var n=e.shared;return t.set(n.framebuffer,".next","null"),t.set(n=n.context,".framebufferWidth",n+".drawingBufferWidth"),t.set(n,".framebufferHeight",n+".drawingBufferHeight"),"null"})}if("framebuffer"in r){var o=r.framebuffer;return B(o,function(e,t){var n=e.invoke(t,o),r=e.shared,i=r.framebuffer;n=t.def(i,".getFramebuffer(",n,")");return t.set(i,".next",n),t.set(r=r.context,".framebufferWidth",n+"?"+n+".width:"+r+".drawingBufferWidth"),t.set(r,".framebufferHeight",n+"?"+n+".height:"+r+".drawingBufferHeight"),n})}return null}function x(e){function n(e){if(e in r){var n=t.id(r[e]);return(e=R(function(){return n})).id=n,e}if(e in i){var o=i[e];return B(o,function(e,t){var n=e.invoke(t,o);return t.def(e.shared.strings,".id(",n,")")})}return null}var r=e.static,i=e.dynamic,o=n("frag"),a=n("vert"),s=null;return z(o)&&z(a)?(s=l.program(a.id,o.id),e=R(function(e,t){return e.link(s)})):e=new j(o&&o.thisDep||a&&a.thisDep,o&&o.contextDep||a&&a.contextDep,o&&o.propDep||a&&a.propDep,function(e,t){var n,r,i=e.shared.shader;return n=o?o.append(e,t):t.def(i,".","frag"),r=a?a.append(e,t):t.def(i,".","vert"),t.def(i+".program("+r+","+n+")")}),{frag:o,vert:a,progVar:e,program:s}}function k(e,t){function n(e,t){if(e in r){var n=0|r[e];return R(function(e,r){return t&&(e.OFFSET=n),n})}if(e in i){var a=i[e];return B(a,function(e,n){var r=e.invoke(n,a);return t&&(e.OFFSET=r),r})}return t&&o?R(function(e,t){return e.OFFSET="0",0}):null}var r=e.static,i=e.dynamic,o=function(){if("elements"in r){var e=r.elements;P(e)?e=a.getElements(a.create(e,!0)):e&&(e=a.getElements(e));var t=R(function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r}return t.ELEMENTS=null});return t.value=e,t}if("elements"in i){var n=i.elements;return B(n,function(e,t){var r=(i=e.shared).isBufferArgs,i=i.elements,o=e.invoke(t,n),a=t.def("null");r=t.def(r,"(",o,")"),o=e.cond(r).then(a,"=",i,".createStream(",o,");").else(a,"=",i,".getElements(",o,");");return t.entry(o),t.exit(e.cond(r).then(i,".destroyStream(",a,");")),e.ELEMENTS=a})}return null}(),s=n("offset",!0);return{elements:o,primitive:function(){if("primitive"in r){var e=r.primitive;return R(function(t,n){return ne[e]})}if("primitive"in i){var t=i.primitive;return B(t,function(e,n){var r=e.constants.primTypes,i=e.invoke(n,t);return n.def(r,"[",i,"]")})}return o?z(o)?R(o.value?function(e,t){return t.def(e.ELEMENTS,".primType")}:function(){return 4}):new j(o.thisDep,o.contextDep,o.propDep,function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",4)}):null}(),count:function(){if("count"in r){var e=0|r.count;return R(function(){return e})}if("count"in i){var t=i.count;return B(t,function(e,n){return e.invoke(n,t)})}return o?z(o)?o?s?new j(s.thisDep,s.contextDep,s.propDep,function(e,t){return t.def(e.ELEMENTS,".vertCount-",e.OFFSET)}):R(function(e,t){return t.def(e.ELEMENTS,".vertCount")}):R(function(){return-1}):new j(o.thisDep||s.thisDep,o.contextDep||s.contextDep,o.propDep||s.propDep,function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")}):null}(),instances:n("instances",!1),offset:s}}function A(e,n){var r=e.static,o=e.dynamic,a={};return Object.keys(r).forEach(function(e){var n=r[e],o=t.id(e),s=new X;if(P(n))s.state=1,s.buffer=i.getBuffer(i.create(n,34962,!1,!0)),s.type=0;else if(c=i.getBuffer(n))s.state=1,s.buffer=c,s.type=0;else if("constant"in n){var u=n.constant;s.buffer="null",s.state=2,"number"==typeof u?s.x=u:_e.forEach(function(e,t){t<u.length&&(s[e]=u[t])})}else{var c=P(n.buffer)?i.getBuffer(i.create(n.buffer,34962,!1,!0)):i.getBuffer(n.buffer),f=0|n.offset,l=0|n.stride,d=0|n.size,p=!!n.normalized,h=0;"type"in n&&(h=J[n.type]),n=0|n.divisor,s.buffer=c,s.state=1,s.size=d,s.normalized=p,s.type=h||c.dtype,s.offset=f,s.stride=l,s.divisor=n}a[e]=R(function(e,t){var n=e.attribCache;if(o in n)return n[o];var r={isStream:!1};return Object.keys(s).forEach(function(e){r[e]=s[e]}),s.buffer&&(r.buffer=e.link(s.buffer),r.type=r.type||r.buffer+".dtype"),n[o]=r})}),Object.keys(o).forEach(function(e){var t=o[e];a[e]=B(t,function(e,n){function r(e){n(u[e],"=",i,".",e,"|0;")}var i=e.invoke(n,t),o=e.shared,a=o.isBufferArgs,s=o.buffer,u={isStream:n.def(!1)},c=new X;c.state=1,Object.keys(c).forEach(function(e){u[e]=n.def(""+c[e])});var f=u.buffer,l=u.type;return n("if(",a,"(",i,")){",u.isStream,"=true;",f,"=",s,".createStream(",34962,",",i,");",l,"=",f,".dtype;","}else{",f,"=",s,".getBuffer(",i,");","if(",f,"){",l,"=",f,".dtype;",'}else if("constant" in ',i,"){",u.state,"=",2,";","if(typeof "+i+'.constant === "number"){',u[_e[0]],"=",i,".constant;",_e.slice(1).map(function(e){return u[e]}).join("="),"=0;","}else{",_e.map(function(e,t){return u[e]+"="+i+".constant.length>"+t+"?"+i+".constant["+t+"]:0;"}).join(""),"}}else{","if(",a,"(",i,".buffer)){",f,"=",s,".createStream(",34962,",",i,".buffer);","}else{",f,"=",s,".getBuffer(",i,".buffer);","}",l,'="type" in ',i,"?",o.glTypes,"[",i,".type]:",f,".dtype;",u.normalized,"=!!",i,".normalized;"),r("size"),r("offset"),r("stride"),r("divisor"),n("}}"),n.exit("if(",u.isStream,"){",s,".destroyStream(",f,");","}"),u})}),a}function E(e,t,n,r,i){var a=w(e),s=function(e,t,n){function r(e){if(e in i){var n=i[e];e=!0;var r,a,s=0|n.x,u=0|n.y;return"width"in n?r=0|n.width:e=!1,"height"in n?a=0|n.height:e=!1,new j(!e&&t&&t.thisDep,!e&&t&&t.contextDep,!e&&t&&t.propDep,function(e,t){var i=e.shared.context,o=r;"width"in n||(o=t.def(i,".","framebufferWidth","-",s));var c=a;return"height"in n||(c=t.def(i,".","framebufferHeight","-",u)),[s,u,o,c]})}if(e in o){var c=o[e];return e=B(c,function(e,t){var n=e.invoke(t,c),r=e.shared.context,i=t.def(n,".x|0"),o=t.def(n,".y|0");return[i,o,t.def('"width" in ',n,"?",n,".width|0:","(",r,".","framebufferWidth","-",i,")"),n=t.def('"height" in ',n,"?",n,".height|0:","(",r,".","framebufferHeight","-",o,")")]}),t&&(e.thisDep=e.thisDep||t.thisDep,e.contextDep=e.contextDep||t.contextDep,e.propDep=e.propDep||t.propDep),e}return t?new j(t.thisDep,t.contextDep,t.propDep,function(e,t){var n=e.shared.context;return[0,0,t.def(n,".","framebufferWidth"),t.def(n,".","framebufferHeight")]}):null}var i=e.static,o=e.dynamic;if(e=r("viewport")){var a=e;e=new j(e.thisDep,e.contextDep,e.propDep,function(e,t){var n=a.append(e,t),r=e.shared.context;return t.set(r,".viewportWidth",n[2]),t.set(r,".viewportHeight",n[3]),n})}return{viewport:e,scissor_box:r("scissor.box")}}(e,a),u=k(e),c=function(e,t){var n=e.static,r=e.dynamic,i={};return re.forEach(function(e){function t(t,o){if(e in n){var s=t(n[e]);i[a]=R(function(){return s})}else if(e in r){var u=r[e];i[a]=B(u,function(e,t){return o(e,t,e.invoke(t,u))})}}var a=v(e);switch(e){case"cull.enable":case"blend.enable":case"dither":case"stencil.enable":case"depth.enable":case"scissor.enable":case"polygonOffset.enable":case"sample.alpha":case"sample.enable":case"depth.mask":return t(function(e){return e},function(e,t,n){return n});case"depth.func":return t(function(e){return ke[e]},function(e,t,n){return t.def(e.constants.compareFuncs,"[",n,"]")});case"depth.range":return t(function(e){return e},function(e,t,n){return[t.def("+",n,"[0]"),t=t.def("+",n,"[1]")]});case"blend.func":return t(function(e){return[xe["srcRGB"in e?e.srcRGB:e.src],xe["dstRGB"in e?e.dstRGB:e.dst],xe["srcAlpha"in e?e.srcAlpha:e.src],xe["dstAlpha"in e?e.dstAlpha:e.dst]]},function(e,t,n){function r(e,r){return t.def('"',e,r,'" in ',n,"?",n,".",e,r,":",n,".",e)}e=e.constants.blendFuncs;var i=r("src","RGB"),o=r("dst","RGB"),a=(i=t.def(e,"[",i,"]"),t.def(e,"[",r("src","Alpha"),"]"));return[i,o=t.def(e,"[",o,"]"),a,e=t.def(e,"[",r("dst","Alpha"),"]")]});case"blend.equation":return t(function(e){return"string"==typeof e?[K[e],K[e]]:"object"==typeof e?[K[e.rgb],K[e.alpha]]:void 0},function(e,t,n){var r=e.constants.blendEquations,i=t.def(),o=t.def();return(e=e.cond("typeof ",n,'==="string"')).then(i,"=",o,"=",r,"[",n,"];"),e.else(i,"=",r,"[",n,".rgb];",o,"=",r,"[",n,".alpha];"),t(e),[i,o]});case"blend.color":return t(function(e){return o(4,function(t){return+e[t]})},function(e,t,n){return o(4,function(e){return t.def("+",n,"[",e,"]")})});case"stencil.mask":return t(function(e){return 0|e},function(e,t,n){return t.def(n,"|0")});case"stencil.func":return t(function(e){return[ke[e.cmp||"keep"],e.ref||0,"mask"in e?e.mask:-1]},function(e,t,n){return[e=t.def('"cmp" in ',n,"?",e.constants.compareFuncs,"[",n,".cmp]",":",7680),t.def(n,".ref|0"),t=t.def('"mask" in ',n,"?",n,".mask|0:-1")]});case"stencil.opFront":case"stencil.opBack":return t(function(t){return["stencil.opBack"===e?1029:1028,Ae[t.fail||"keep"],Ae[t.zfail||"keep"],Ae[t.zpass||"keep"]]},function(t,n,r){function i(e){return n.def('"',e,'" in ',r,"?",o,"[",r,".",e,"]:",7680)}var o=t.constants.stencilOps;return["stencil.opBack"===e?1029:1028,i("fail"),i("zfail"),i("zpass")]});case"polygonOffset.offset":return t(function(e){return[0|e.factor,0|e.units]},function(e,t,n){return[t.def(n,".factor|0"),t=t.def(n,".units|0")]});case"cull.face":return t(function(e){var t=0;return"front"===e?t=1028:"back"===e&&(t=1029),t},function(e,t,n){return t.def(n,'==="front"?',1028,":",1029)});case"lineWidth":return t(function(e){return e},function(e,t,n){return n});case"frontFace":return t(function(e){return Ee[e]},function(e,t,n){return t.def(n+'==="cw"?2304:2305')});case"colorMask":return t(function(e){return e.map(function(e){return!!e})},function(e,t,n){return o(4,function(e){return"!!"+n+"["+e+"]"})});case"sample.coverage":return t(function(e){return["value"in e?e.value:1,!!e.invert]},function(e,t,n){return[t.def('"value" in ',n,"?+",n,".value:1"),t=t.def("!!",n,".invert")]})}}),i}(e),f=x(e),l=s.viewport;return l&&(c.viewport=l),(s=s[l=v("scissor.box")])&&(c[l]=s),(a={framebuffer:a,draw:u,shader:f,state:c,dirty:s=0<Object.keys(c).length}).profile=function(e){var t,n=e.static;if(e=e.dynamic,"profile"in n){var r=!!n.profile;(t=R(function(e,t){return r})).enable=r}else if("profile"in e){var i=e.profile;t=B(i,function(e,t){return e.invoke(t,i)})}return t}(e),a.uniforms=function(e,t){var n=e.static,r=e.dynamic,i={};return Object.keys(n).forEach(function(e){var t,r=n[e];if("number"==typeof r||"boolean"==typeof r)t=R(function(){return r});else if("function"==typeof r){var a=r._reglType;"texture2d"===a||"textureCube"===a?t=R(function(e){return e.link(r)}):"framebuffer"!==a&&"framebufferCube"!==a||(t=R(function(e){return e.link(r.color[0])}))}else g(r)&&(t=R(function(e){return e.global.def("[",o(r.length,function(e){return r[e]}),"]")}));t.value=r,i[e]=t}),Object.keys(r).forEach(function(e){var t=r[e];i[e]=B(t,function(e,n){return e.invoke(n,t)})}),i}(n),a.attributes=A(t),a.context=function(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach(function(e){var n=t[e];r[e]=R(function(e,t){return"number"==typeof n||"boolean"==typeof n?""+n:e.link(n)})}),Object.keys(n).forEach(function(e){var t=n[e];r[e]=B(t,function(e,n){return e.invoke(n,t)})}),r}(r),a}function C(e,t,n){var r=e.shared.context,i=e.scope();Object.keys(n).forEach(function(o){t.save(r,"."+o),i(r,".",o,"=",n[o].append(e,t),";")}),t(i)}function S(e,t,n,r){var i,o=(s=e.shared).gl,a=s.framebuffer;$&&(i=t.def(s.extensions,".webgl_draw_buffers"));var s=(u=e.constants).drawBuffer,u=u.backBuffer;e=n?n.append(e,t):t.def(a,".next"),r||t("if(",e,"!==",a,".cur){"),t("if(",e,"){",o,".bindFramebuffer(",36160,",",e,".framebuffer);"),$&&t(i,".drawBuffersWEBGL(",s,"[",e,".colorAttachments.length]);"),t("}else{",o,".bindFramebuffer(",36160,",null);"),$&&t(i,".drawBuffersWEBGL(",u,");"),t("}",a,".cur=",e,";"),r||t("}")}function T(e,t,n){var r=e.shared,i=r.gl,a=e.current,s=e.next,u=r.current,c=r.next,f=e.cond(u,".dirty");re.forEach(function(t){var r,l;if(!((t=v(t))in n.state))if(t in s){r=s[t],l=a[t];var d=o(ee[t].length,function(e){return f.def(r,"[",e,"]")});f(e.cond(d.map(function(e,t){return e+"!=="+l+"["+t+"]"}).join("||")).then(i,".",oe[t],"(",d,");",d.map(function(e,t){return l+"["+t+"]="+e}).join(";"),";"))}else r=f.def(c,".",t),d=e.cond(r,"!==",u,".",t),f(d),t in ie?d(e.cond(r).then(i,".enable(",ie[t],");").else(i,".disable(",ie[t],");"),u,".",t,"=",r,";"):d(i,".",oe[t],"(",r,");",u,".",t,"=",r,";")}),0===Object.keys(n.state).length&&f(u,".dirty=false;"),t(f)}function O(e,t,n,r){var i=e.shared,o=e.current,a=i.current,s=i.gl;F(Object.keys(n)).forEach(function(i){var u=n[i];if(!r||r(u)){var c=u.append(e,t);if(ie[i]){var f=ie[i];z(u)?t(s,c?".enable(":".disable(",f,");"):t(e.cond(c).then(s,".enable(",f,");").else(s,".disable(",f,");")),t(a,".",i,"=",c,";")}else if(g(c)){var l=o[i];t(s,".",oe[i],"(",c,");",c.map(function(e,t){return l+"["+t+"]="+e}).join(";"),";")}else t(s,".",oe[i],"(",c,");",a,".",i,"=",c,";")}})}function D(e,t){Z&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function L(e,t,n,r,i){function o(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function a(e){e(c=t.def(),"=",o(),";"),"string"==typeof i?e(d,".count+=",i,";"):e(d,".count++;"),h&&(r?e(f=t.def(),"=",m,".getNumPendingQueries();"):e(m,".beginQuery(",d,");"))}function s(e){e(d,".cpuTime+=",o(),"-",c,";"),h&&(r?e(m,".pushScopeStats(",f,",",m,".getNumPendingQueries(),",d,");"):e(m,".endQuery();"))}function u(e){var n=t.def(p,".profile");t(p,".profile=",e,";"),t.exit(p,".profile=",n,";")}var c,f,l=e.shared,d=e.stats,p=l.current,m=l.timer;if(n=n.profile){if(z(n))return void(n.enable?(a(t),s(t.exit),u("true")):u("false"));u(n=n.append(e,t))}else n=t.def(p,".profile");a(l=e.block()),t("if(",n,"){",l,"}"),s(e=e.block()),t.exit("if(",n,"){",e,"}")}function I(e,t,n,r,i){function o(n,r,i){function o(){t("if(!",f,".buffer){",u,".enableVertexAttribArray(",c,");}");var n,o=i.type;n=i.size?t.def(i.size,"||",r):r,t("if(",f,".type!==",o,"||",f,".size!==",n,"||",p.map(function(e){return f+"."+e+"!=="+i[e]}).join("||"),"){",u,".bindBuffer(",34962,",",l,".buffer);",u,".vertexAttribPointer(",[c,n,o,i.normalized,i.stride,i.offset],");",f,".type=",o,";",f,".size=",n,";",p.map(function(e){return f+"."+e+"="+i[e]+";"}).join(""),"}"),Z&&t("if(",f,".divisor!==",o=i.divisor,"){",e.instancing,".vertexAttribDivisorANGLE(",[c,o],");",f,".divisor=",o,";}")}function s(){t("if(",f,".buffer){",u,".disableVertexAttribArray(",c,");","}if(",_e.map(function(e,t){return f+"."+e+"!=="+d[t]}).join("||"),"){",u,".vertexAttrib4f(",c,",",d,");",_e.map(function(e,t){return f+"."+e+"="+d[t]+";"}).join(""),"}")}var u=a.gl,c=t.def(n,".location"),f=t.def(a.attributes,"[",c,"]"),l=i.buffer,d=[i.x,i.y,i.z,i.w],p=["buffer","normalized","offset","stride"];1===(n=i.state)?o():2===n?s():(t("if(",n,"===",1,"){"),o(),t("}else{"),s(),t("}"))}var a=e.shared;r.forEach(function(r){var a,s=r.name,u=n.attributes[s];if(u){if(!i(u))return;a=u.append(e,t)}else{if(!i(Ce))return;var c=e.scopeAttrib(s);a={},Object.keys(new X).forEach(function(e){a[e]=t.def(c,".",e)})}o(e.link(r),function(e){switch(e){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}(r.info.type),a)})}function N(e,n,r,i,a){for(var s,u=e.shared,c=u.gl,f=0;f<i.length;++f){var l,d=(m=i[f]).name,p=m.info.type,h=r.uniforms[d],m=e.link(m)+".location";if(h){if(!a(h))continue;if(z(h)){if(d=h.value,35678===p||35680===p)n(c,".uniform1i(",m,",",(p=e.link(d._texture||d.color[0]._texture))+".bind());"),n.exit(p,".unbind();");else if(35674===p||35675===p||35676===p)h=2,35675===p?h=3:35676===p&&(h=4),n(c,".uniformMatrix",h,"fv(",m,",false,",d=e.global.def("new Float32Array(["+Array.prototype.slice.call(d)+"])"),");");else{switch(p){case 5126:s="1f";break;case 35664:s="2f";break;case 35665:s="3f";break;case 35666:s="4f";break;case 35670:case 5124:s="1i";break;case 35671:case 35667:s="2i";break;case 35672:case 35668:s="3i";break;case 35673:s="4i";break;case 35669:s="4i"}n(c,".uniform",s,"(",m,",",g(d)?Array.prototype.slice.call(d):d,");")}continue}l=h.append(e,n)}else{if(!a(Ce))continue;l=n.def(u.uniforms,"[",t.id(d),"]")}switch(35678===p?n("if(",l,"&&",l,'._reglType==="framebuffer"){',l,"=",l,".color[0];","}"):35680===p&&n("if(",l,"&&",l,'._reglType==="framebufferCube"){',l,"=",l,".color[0];","}"),d=1,p){case 35678:case 35680:p=n.def(l,"._texture"),n(c,".uniform1i(",m,",",p,".bind());"),n.exit(p,".unbind();");continue;case 5124:case 35670:s="1i";break;case 35667:case 35671:s="2i",d=2;break;case 35668:case 35672:s="3i",d=3;break;case 35669:case 35673:s="4i",d=4;break;case 5126:s="1f";break;case 35664:s="2f",d=2;break;case 35665:s="3f",d=3;break;case 35666:s="4f",d=4;break;case 35674:s="Matrix2fv";break;case 35675:s="Matrix3fv";break;case 35676:s="Matrix4fv"}if(n(c,".uniform",s,"(",m,","),"M"===s.charAt(0)){m=Math.pow(p-35674+2,2);var v=e.global.def("new Float32Array(",m,")");n("false,(Array.isArray(",l,")||",l," instanceof Float32Array)?",l,":(",o(m,function(e){return v+"["+e+"]="+l+"["+e+"]"}),",",v,")")}else n(1<d?o(d,function(e){return l+"["+e+"]"}):l);n(");")}}function H(e,t,n,r){function i(i){var o=d[i];return o?o.append(e,o.contextDep&&r.contextDynamic||o.propDep?n:t):t.def(l,".",i)}function o(){function e(){n(u,".drawElementsInstancedANGLE(",[h,g,v,m+"<<(("+v+"-5121)>>1)",s],");")}function t(){n(u,".drawArraysInstancedANGLE(",[h,m,g,s],");")}p?b?e():(n("if(",p,"){"),e(),n("}else{"),t(),n("}")):t()}function a(){function e(){n(f+".drawElements("+[h,g,v,m+"<<(("+v+"-5121)>>1)"]+");")}function t(){n(f+".drawArrays("+[h,m,g]+");")}p?b?e():(n("if(",p,"){"),e(),n("}else{"),t(),n("}")):t()}var s,u,c=e.shared,f=c.gl,l=c.draw,d=r.draw,p=function(){var i=d.elements,o=t;return i?((i.contextDep&&r.contextDynamic||i.propDep)&&(o=n),i=i.append(e,o)):i=o.def(l,".","elements"),i&&o("if("+i+")"+f+".bindBuffer(34963,"+i+".buffer.buffer);"),i}(),h=i("primitive"),m=i("offset"),g=function(){var i=d.count,o=t;return i?((i.contextDep&&r.contextDynamic||i.propDep)&&(o=n),i=i.append(e,o)):i=o.def(l,".","count"),i}();if("number"==typeof g){if(0===g)return}else n("if(",g,"){"),n.exit("}");Z&&(s=i("instances"),u=e.instancing);var v=p+".type",b=d.elements&&z(d.elements);Z&&("number"!=typeof s||0<=s)?"string"==typeof s?(n("if(",s,">0){"),o(),n("}else if(",s,"<0){"),a(),n("}")):o():a()}function V(e,t,n,r,i){return i=(t=_()).proc("body",i),Z&&(t.instancing=i.def(t.shared.extensions,".angle_instanced_arrays")),e(t,i,n,r),t.compile().body}function G(e,t,n,r){D(e,t),I(e,t,n,r.attributes,function(){return!0}),N(e,t,n,r.uniforms,function(){return!0}),H(e,t,t,n)}function W(e,t,n,r){function i(){return!0}e.batchId="a1",D(e,t),I(e,t,n,r.attributes,i),N(e,t,n,r.uniforms,i),H(e,t,t,n)}function q(e,t,n,r){function i(e){return e.contextDep&&a||e.propDep}function o(e){return!i(e)}D(e,t);var a=n.contextDep,s=t.def(),u=t.def();e.shared.props=u,e.batchId=s;var c=e.scope(),f=e.scope();t(c.entry,"for(",s,"=0;",s,"<","a1",";++",s,"){",u,"=","a0","[",s,"];",f,"}",c.exit),n.needsContext&&C(e,f,n.context),n.needsFramebuffer&&S(e,f,n.framebuffer),O(e,f,n.state,i),n.profile&&i(n.profile)&&L(e,f,n,!1,!0),r?(I(e,c,n,r.attributes,o),I(e,f,n,r.attributes,i),N(e,c,n,r.uniforms,o),N(e,f,n,r.uniforms,i),H(e,c,f,n)):(t=e.global.def("{}"),r=n.shader.progVar.append(e,f),u=f.def(r,".id"),c=f.def(t,"[",u,"]"),f(e.shared.gl,".useProgram(",r,".program);","if(!",c,"){",c,"=",t,"[",u,"]=",e.link(function(t){return V(W,e,n,t,2)}),"(",r,");}",c,".call(this,a0[",s,"],",s,");"))}function Y(e,n){function r(t){var r=n.shader[t];r&&i.set(o.shader,"."+t,r.append(e,i))}var i=e.proc("scope",3);e.batchId="a2";var o=e.shared,a=o.current;C(e,i,n.context),n.framebuffer&&n.framebuffer.append(e,i),F(Object.keys(n.state)).forEach(function(t){var r=n.state[t].append(e,i);g(r)?r.forEach(function(n,r){i.set(e.next[t],"["+r+"]",n)}):i.set(o.next,"."+t,r)}),L(e,i,n,!0,!0),["elements","offset","count","instances","primitive"].forEach(function(t){var r=n.draw[t];r&&i.set(o.draw,"."+t,""+r.append(e,i))}),Object.keys(n.uniforms).forEach(function(r){i.set(o.uniforms,"["+t.id(r)+"]",n.uniforms[r].append(e,i))}),Object.keys(n.attributes).forEach(function(t){var r=n.attributes[t].append(e,i),o=e.scopeAttrib(t);Object.keys(new X).forEach(function(e){i.set(o,"."+e,r[e])})}),r("vert"),r("frag"),0<Object.keys(n.state).length&&(i(a,".dirty=true;"),i.exit(a,".dirty=true;")),i("a1(",e.shared.context,",a0,",e.batchId,");")}function Q(e,t,n){var r=t.static[n];if(r&&function(e){if("object"==typeof e&&!g(e)){for(var t=Object.keys(e),n=0;n<t.length;++n)if(U.isDynamic(e[t[n]]))return!0;return!1}}(r)){var i=e.global,o=Object.keys(r),a=!1,s=!1,u=!1,c=e.global.def("{}");o.forEach(function(t){var n=r[t];if(U.isDynamic(n))"function"==typeof n&&(n=r[t]=U.unbox(n)),t=B(n,null),a=a||t.thisDep,u=u||t.propDep,s=s||t.contextDep;else{switch(i(c,".",t,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(e.link(n))}i(";")}}),t.dynamic[n]=new U.DynamicVariable(4,{thisDep:a,contextDep:s,propDep:u,ref:c,append:function(e,t){o.forEach(function(n){var i=r[n];U.isDynamic(i)&&(i=e.invoke(t,i),t(c,".",n,"=",i,";"))})}}),delete t.static[n]}}var X=f.Record,K={add:32774,subtract:32778,"reverse subtract":32779};n.ext_blend_minmax&&(K.min=32775,K.max=32776);var Z=n.angle_instanced_arrays,$=n.webgl_draw_buffers,ee={dirty:!0,profile:m.profile},te={},re=[],ie={},oe={};b("dither",3024),b("blend.enable",3042),y("blend.color","blendColor",[0,0,0,0]),y("blend.equation","blendEquationSeparate",[32774,32774]),y("blend.func","blendFuncSeparate",[1,0,1,0]),b("depth.enable",2929,!0),y("depth.func","depthFunc",513),y("depth.range","depthRange",[0,1]),y("depth.mask","depthMask",!0),y("colorMask","colorMask",[!0,!0,!0,!0]),b("cull.enable",2884),y("cull.face","cullFace",1029),y("frontFace","frontFace",2305),y("lineWidth","lineWidth",1),b("polygonOffset.enable",32823),y("polygonOffset.offset","polygonOffset",[0,0]),b("sample.alpha",32926),b("sample.enable",32928),y("sample.coverage","sampleCoverage",[1,!1]),b("stencil.enable",2960),y("stencil.mask","stencilMask",-1),y("stencil.func","stencilFunc",[519,0,-1]),y("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]),y("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]),b("scissor.enable",3089),y("scissor.box","scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),y("viewport","viewport",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var ae={gl:e,context:p,strings:t,next:te,current:ee,draw:d,elements:a,buffer:i,shader:l,attributes:f.state,uniforms:c,framebuffer:u,extensions:n,timer:h,isBufferArgs:P},se={primTypes:ne,compareFuncs:ke,blendFuncs:xe,blendEquations:K,stencilOps:Ae,glTypes:J,orientationType:Ee};$&&(se.backBuffer=[1029],se.drawBuffer=o(r.maxDrawbuffers,function(e){return 0===e?[0]:o(e,function(e){return 36064+e})}));var ue=0;return{next:te,current:ee,procs:function(){var e=_(),t=e.proc("poll"),n=e.proc("refresh"),i=e.block();t(i),n(i);var a,s=e.shared,u=s.gl,c=s.next,f=s.current;i(f,".dirty=false;"),S(e,t),S(e,n,null,!0),Z&&(a=e.link(Z));for(var l=0;l<r.maxAttributes;++l){var d=n.def(s.attributes,"[",l,"]"),p=e.cond(d,".buffer");p.then(u,".enableVertexAttribArray(",l,");",u,".bindBuffer(",34962,",",d,".buffer.buffer);",u,".vertexAttribPointer(",l,",",d,".size,",d,".type,",d,".normalized,",d,".stride,",d,".offset);").else(u,".disableVertexAttribArray(",l,");",u,".vertexAttrib4f(",l,",",d,".x,",d,".y,",d,".z,",d,".w);",d,".buffer=null;"),n(p),Z&&n(a,".vertexAttribDivisorANGLE(",l,",",d,".divisor);")}return Object.keys(ie).forEach(function(r){var o=ie[r],a=i.def(c,".",r),s=e.block();s("if(",a,"){",u,".enable(",o,")}else{",u,".disable(",o,")}",f,".",r,"=",a,";"),n(s),t("if(",a,"!==",f,".",r,"){",s,"}")}),Object.keys(oe).forEach(function(r){var a,s,l=oe[r],d=ee[r],p=e.block();p(u,".",l,"("),g(d)?(l=d.length,a=e.global.def(c,".",r),s=e.global.def(f,".",r),p(o(l,function(e){return a+"["+e+"]"}),");",o(l,function(e){return s+"["+e+"]="+a+"["+e+"];"}).join("")),t("if(",o(l,function(e){return a+"["+e+"]!=="+s+"["+e+"]"}).join("||"),"){",p,"}")):(a=i.def(c,".",r),s=i.def(f,".",r),p(a,");",f,".",r,"=",a,";"),t("if(",a,"!==",s,"){",p,"}")),n(p)}),e.compile()}(),compile:function(e,t,n,r,i){var o=_();return o.stats=o.link(i),Object.keys(t.static).forEach(function(e){Q(o,t,e)}),we.forEach(function(t){Q(o,e,t)}),n=E(e,t,n,r),function(e,t){var n=e.proc("draw",1);D(e,n),C(e,n,t.context),S(e,n,t.framebuffer),T(e,n,t),O(e,n,t.state),L(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)G(e,n,t,t.shader.program);else{var i=e.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(e.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",e.link(function(n){return V(G,e,t,n,1)}),"(",r,");",a,".call(this,a0);"))}0<Object.keys(t.state).length&&n(e.shared.current,".dirty=true;")}(o,n),Y(o,n),function(e,t){function n(e){return e.contextDep&&i||e.propDep}var r=e.proc("batch",2);e.batchId="0",D(e,r);var i=!1,o=!0;Object.keys(t.context).forEach(function(e){i=i||t.context[e].propDep}),i||(C(e,r,t.context),o=!1);var a=!1;if((s=t.framebuffer)?(s.propDep?i=a=!0:s.contextDep&&i&&(a=!0),a||S(e,r,s)):S(e,r,null),t.state.viewport&&t.state.viewport.propDep&&(i=!0),T(e,r,t),O(e,r,t.state,function(e){return!n(e)}),t.profile&&n(t.profile)||L(e,r,t,!1,"a1"),t.contextDep=i,t.needsContext=o,t.needsFramebuffer=a,(o=t.shader.progVar).contextDep&&i||o.propDep)q(e,r,t,null);else if(o=o.append(e,r),r(e.shared.gl,".useProgram(",o,".program);"),t.shader.program)q(e,r,t,t.shader.program);else{var s=e.global.def("{}"),u=(a=r.def(o,".id"),r.def(s,"[",a,"]"));r(e.cond(u).then(u,".call(this,a0,a1);").else(u,"=",s,"[",a,"]=",e.link(function(n){return V(q,e,t,n,2)}),"(",o,");",u,".call(this,a0,a1);"))}0<Object.keys(t.state).length&&r(e.shared.current,".dirty=true;")}(o,n),o.compile()}}}function I(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}var N=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e},H=0,U={DynamicVariable:e,define:function(n,r){return new e(n,t(r+""))},isDynamic:function(t){return"function"==typeof t&&!t._reglType||t instanceof e},unbox:function(t,n){return"function"==typeof t?new e(0,t):t},accessor:t},V={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},G="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date},W=s();W.zero=s();var q=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(34047));var r=1,i=1;t.webgl_draw_buffers&&(r=e.getParameter(34852),i=e.getParameter(36063));var o=!!t.oes_texture_float;if(o){o=e.createTexture(),e.bindTexture(3553,o),e.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var a=e.createFramebuffer();if(e.bindFramebuffer(36160,a),e.framebufferTexture2D(36160,36064,3553,o,0),e.bindTexture(3553,null),36053!==e.checkFramebufferStatus(36160))o=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384);var s=W.allocType(5126,4);e.readPixels(0,0,1,1,6408,5126,s),e.getError()?o=!1:(e.deleteFramebuffer(a),e.deleteTexture(o),o=1===s[0]),W.freeType(s)}}return s=!0,s=e.createTexture(),a=W.allocType(5121,36),e.activeTexture(33984),e.bindTexture(34067,s),e.texImage2D(34069,0,6408,3,3,0,6408,5121,a),W.freeType(a),e.bindTexture(34067,null),e.deleteTexture(s),s=!e.getError(),{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter(function(e){return!!t[e]}),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:o,npotTextureCube:s}},Y=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},Q=function(e){return Object.keys(e).map(function(t){return e[t]})},X={shape:function(e){for(var t=[];e.length;e=e[0])t.push(e.length);return t},flatten:function(e,t,n,r){var i=1;if(t.length)for(var o=0;o<t.length;++o)i*=t[o];else i=0;switch(n=r||W.allocType(n,i),t.length){case 0:break;case 1:for(r=t[0],t=0;t<r;++t)n[t]=e[t];break;case 2:for(r=t[0],t=t[1],o=i=0;o<r;++o)for(var a=e[o],s=0;s<t;++s)n[i++]=a[s];break;case 3:c(e,t[0],t[1],t[2],n,0);break;default:!function e(t,n,r,i,o){for(var a=1,s=r+1;s<n.length;++s)a*=n[s];var u=n[r];if(4==n.length-r){var f=n[r+1],l=n[r+2];for(n=n[r+3],s=0;s<u;++s)c(t[s],f,l,n,i,o),o+=a}else for(s=0;s<u;++s)e(t[s],n,r+1,i,o),o+=a}(e,t,0,n,0)}return n}},K={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},J={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Z={dynamic:35048,stream:35040,static:35044},$=X.flatten,ee=X.shape,te=[];te[5120]=1,te[5122]=2,te[5124]=4,te[5121]=1,te[5123]=2,te[5125]=4,te[5126]=4;var ne={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},re=new Float32Array(1),ie=new Uint32Array(re.buffer),oe=[9984,9986,9985,9987],ae=[0,6409,6410,6407,6408],se={};se[6409]=se[6406]=se[6402]=1,se[34041]=se[6410]=2,se[6407]=se[35904]=3,se[6408]=se[35906]=4;var ue=v("HTMLCanvasElement"),ce=v("CanvasRenderingContext2D"),fe=v("ImageBitmap"),le=v("HTMLImageElement"),de=v("HTMLVideoElement"),pe=Object.keys(K).concat([ue,ce,fe,le,de]),he=[];he[5121]=1,he[5126]=4,he[36193]=2,he[5123]=2,he[5125]=4;var me=[];me[32854]=2,me[32855]=2,me[36194]=2,me[34041]=4,me[33776]=.5,me[33777]=.5,me[33778]=1,me[33779]=1,me[35986]=.5,me[35987]=1,me[34798]=1,me[35840]=.5,me[35841]=.25,me[35842]=.5,me[35843]=.25,me[36196]=.5;var ge=[];ge[32854]=2,ge[32855]=2,ge[36194]=2,ge[33189]=2,ge[36168]=1,ge[34041]=4,ge[35907]=4,ge[34836]=16,ge[34842]=8,ge[34843]=6;var ve=function(e,t,n,r,i){function o(e){this.id=c++,this.refCount=1,this.renderbuffer=e,this.format=32854,this.height=this.width=0,i.profile&&(this.stats={size:0})}function a(t){var n=t.renderbuffer;e.bindRenderbuffer(36161,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete f[t.id],r.renderbufferCount--}var s={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(s.srgba=35907),t.ext_color_buffer_half_float&&(s.rgba16f=34842,s.rgb16f=34843),t.webgl_color_buffer_float&&(s.rgba32f=34836);var u=[];Object.keys(s).forEach(function(e){u[s[e]]=e});var c=0,f={};return o.prototype.decRef=function(){0>=--this.refCount&&a(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var e=0;return Object.keys(f).forEach(function(t){e+=f[t].stats.size}),e}),{create:function(t,n){function a(t,n){var r=0,o=0,f=32854;if("object"==typeof t&&t?("shape"in t?(r=0|(o=t.shape)[0],o=0|o[1]):("radius"in t&&(r=o=0|t.radius),"width"in t&&(r=0|t.width),"height"in t&&(o=0|t.height)),"format"in t&&(f=s[t.format])):"number"==typeof t?(r=0|t,o="number"==typeof n?0|n:r):t||(r=o=1),r!==c.width||o!==c.height||f!==c.format)return a.width=c.width=r,a.height=c.height=o,c.format=f,e.bindRenderbuffer(36161,c.renderbuffer),e.renderbufferStorage(36161,f,r,o),i.profile&&(c.stats.size=ge[c.format]*c.width*c.height),a.format=u[c.format],a}var c=new o(e.createRenderbuffer());return f[c.id]=c,r.renderbufferCount++,a(t,n),a.resize=function(t,n){var r=0|t,o=0|n||r;return r===c.width&&o===c.height?a:(a.width=c.width=r,a.height=c.height=o,e.bindRenderbuffer(36161,c.renderbuffer),e.renderbufferStorage(36161,c.format,r,o),i.profile&&(c.stats.size=ge[c.format]*c.width*c.height),a)},a._reglType="renderbuffer",a._renderbuffer=c,i.profile&&(a.stats=c.stats),a.destroy=function(){c.decRef()},a},clear:function(){Q(f).forEach(a)},restore:function(){Q(f).forEach(function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,t.renderbuffer),e.renderbufferStorage(36161,t.format,t.width,t.height)}),e.bindRenderbuffer(36161,null)}}},be=[];be[6408]=4,be[6407]=3;var ye=[];ye[5121]=1,ye[5126]=4,ye[36193]=2;var _e=["x","y","z","w"],we="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),xe={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},ke={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ae={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Ee={cw:2304,ccw:2305},Ce=new j(!1,!1,!1,function(){});return function(e){function t(){if(0===X.length)x&&x.update(),$=null;else{$=V.next(t),l();for(var e=X.length-1;0<=e;--e){var n=X[e];n&&n(D,null,0)}g.flush(),x&&x.update()}}function n(){!$&&0<X.length&&($=V.next(t))}function r(){$&&(V.cancel(t),$=null)}function o(e){e.preventDefault(),r(),K.forEach(function(e){e()})}function a(e){g.getError(),b.restore(),z.restore(),F.restore(),R.restore(),B.restore(),H.restore(),x&&x.restore(),W.procs.refresh(),n(),J.forEach(function(e){e()})}function s(e){function t(e){var t={},n={};return Object.keys(e).forEach(function(r){var i=e[r];U.isDynamic(i)?n[r]=U.unbox(i,r):t[r]=i}),{dynamic:n,static:t}}var n=t(e.context||{}),r=t(e.uniforms||{}),i=t(e.attributes||{}),o=t(function(e){function t(e){if(e in n){var t=n[e];delete n[e],Object.keys(t).forEach(function(r){n[e+"."+r]=t[r]})}}var n=N({},e);return delete n.uniforms,delete n.attributes,delete n.context,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),t("blend"),t("depth"),t("cull"),t("stencil"),t("polygonOffset"),t("scissor"),t("sample"),n}(e)),a=(n=W.compile(o,i,r,n,e={gpuTime:0,cpuTime:0,count:0})).draw,s=n.batch,u=n.scope,c=[];return N(function(e,t){var n;if("function"==typeof e)return u.call(this,null,e,0);if("function"==typeof t)if("number"==typeof e)for(n=0;n<e;++n)u.call(this,null,t,n);else{if(!Array.isArray(e))return u.call(this,e,t,0);for(n=0;n<e.length;++n)u.call(this,e[n],t,n)}else if("number"==typeof e){if(0<e)return s.call(this,function(e){for(;c.length<e;)c.push(null);return c}(0|e),0|e)}else{if(!Array.isArray(e))return a.call(this,e);if(e.length)return s.call(this,e,e.length)}},{stats:e})}function u(e,t){var n=0;W.procs.poll();var r=t.color;r&&(g.clearColor(+r[0]||0,+r[1]||0,+r[2]||0,+r[3]||0),n|=16384),"depth"in t&&(g.clearDepth(+t.depth),n|=256),"stencil"in t&&(g.clearStencil(0|t.stencil),n|=1024),g.clear(n)}function c(e){return X.push(e),n(),{cancel:function(){var t=I(X,e);X[t]=function e(){var t=I(X,e);X[t]=X[X.length-1],--X.length,0>=X.length&&r()}}}}function f(){var e=Y.viewport,t=Y.scissor_box;e[0]=e[1]=t[0]=t[1]=0,D.viewportWidth=D.framebufferWidth=D.drawingBufferWidth=e[2]=t[2]=g.drawingBufferWidth,D.viewportHeight=D.framebufferHeight=D.drawingBufferHeight=e[3]=t[3]=g.drawingBufferHeight}function l(){D.tick+=1,D.time=m(),f(),W.procs.poll()}function d(){f(),W.procs.refresh(),x&&x.update()}function m(){return(G()-k)/1e3}if(!(e=i(e)))return null;var g=e.gl,v=g.getContextAttributes();g.isContextLost();var b=function(e,t){function n(t){var n;t=t.toLowerCase();try{n=r[t]=e.getExtension(t)}catch(e){}return!!n}for(var r={},i=0;i<t.extensions.length;++i){var o=t.extensions[i];if(!n(o))return t.onDestroy(),t.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(n),{extensions:r,restore:function(){Object.keys(r).forEach(function(e){if(r[e]&&!n(e))throw Error("(regl): error restoring extension "+e)})}}}(g,e);if(!b)return null;var y=function(){var e={"":0},t=[""];return{id:function(n){var r=e[n];return r||(r=e[n]=t.length,t.push(n),r)},str:function(e){return t[e]}}}(),_={bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},w=b.extensions,x=function(e,t){function n(){this.endQueryIndex=this.startQueryIndex=-1,this.sum=0,this.stats=null}function r(e,t,r){var i=a.pop()||new n;i.startQueryIndex=e,i.endQueryIndex=t,i.sum=0,i.stats=r,s.push(i)}if(!t.ext_disjoint_timer_query)return null;var i=[],o=[],a=[],s=[],u=[],c=[];return{beginQuery:function(e){var n=i.pop()||t.ext_disjoint_timer_query.createQueryEXT();t.ext_disjoint_timer_query.beginQueryEXT(35007,n),o.push(n),r(o.length-1,o.length,e)},endQuery:function(){t.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:r,update:function(){var e,n;if(0!==(e=o.length)){c.length=Math.max(c.length,e+1),u.length=Math.max(u.length,e+1),u[0]=0;var r=c[0]=0;for(n=e=0;n<o.length;++n)t.ext_disjoint_timer_query.getQueryObjectEXT(f=o[n],34919)?(r+=t.ext_disjoint_timer_query.getQueryObjectEXT(f,34918),i.push(f)):o[e++]=f,u[n+1]=r,c[n+1]=e;for(o.length=e,n=e=0;n<s.length;++n){var f,l=(r=s[n]).startQueryIndex;r.sum+=u[f=r.endQueryIndex]-u[l],(f=c[f])===(l=c[l])?(r.stats.gpuTime+=r.sum/1e6,a.push(r)):(r.startQueryIndex=l,r.endQueryIndex=f,s[e++]=r)}s.length=e}},getNumPendingQueries:function(){return o.length},clear:function(){i.push.apply(i,o);for(var e=0;e<i.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(i[e]);o.length=0,i.length=0},restore:function(){o.length=0,i.length=0}}}(0,w),k=G(),O=g.drawingBufferHeight,D={tick:0,time:0,viewportWidth:P=g.drawingBufferWidth,viewportHeight:O,framebufferWidth:P,framebufferHeight:O,drawingBufferWidth:P,drawingBufferHeight:O,pixelRatio:e.pixelRatio},M=q(g,w),P=function(e,t,n,r){for(e=n.maxAttributes,t=Array(e),n=0;n<e;++n)t[n]=new C;return{Record:C,scope:{},state:t}}(g,w,M),F=p(g,_,e,P),j=h(g,w,F,_),z=S(g,y,_,e),R=A(g,w,M,function(){W.procs.poll()},D,_,e),B=ve(g,w,0,_,e),H=E(g,w,M,R,B,_),W=L(g,y,w,M,F,j,0,H,{},P,z,{elements:null,primitive:4,count:-1,offset:0,instances:-1},D,x,e),Y=(y=T(g,H,W.procs.poll,D),W.next),Q=g.canvas,X=[],K=[],J=[],Z=[e.onDestroy],$=null;Q&&(Q.addEventListener("webglcontextlost",o,!1),Q.addEventListener("webglcontextrestored",a,!1));var ee=H.setFBO=s({framebuffer:U.define.call(null,1,"framebuffer")});return d(),v=N(s,{clear:function(e){if("framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var t=0;6>t;++t)ee(N({framebuffer:e.framebuffer.faces[t]},e),u);else ee(e,u);else u(0,e)},prop:U.define.bind(null,1),context:U.define.bind(null,2),this:U.define.bind(null,3),draw:s({}),buffer:function(e){return F.create(e,34962,!1,!1)},elements:function(e){return j.create(e,!1)},texture:R.create2D,cube:R.createCube,renderbuffer:B.create,framebuffer:H.create,framebufferCube:H.createCube,attributes:v,frame:c,on:function(e,t){var n;switch(e){case"frame":return c(t);case"lost":n=K;break;case"restore":n=J;break;case"destroy":n=Z}return n.push(t),{cancel:function(){for(var e=0;e<n.length;++e)if(n[e]===t){n[e]=n[n.length-1],n.pop();break}}}},limits:M,hasExtension:function(e){return 0<=M.extensions.indexOf(e.toLowerCase())},read:y,destroy:function(){X.length=0,r(),Q&&(Q.removeEventListener("webglcontextlost",o),Q.removeEventListener("webglcontextrestored",a)),z.clear(),H.clear(),B.clear(),R.clear(),j.clear(),F.clear(),x&&x.clear(),Z.forEach(function(e){e()})},_gl:g,_refresh:d,poll:function(){l(),x&&x.update()},now:m,stats:_}),e.onDone(null,v),v}},"object"==typeof n&&void 0!==t?t.exports=i():"function"==typeof define&&define.amd?define(i):r.createREGL=i()},{}],60:[function(e,t,n){(function(e){"use strict";var n=256,r=[],i=void 0===e?window:e,o=Math.pow(n,6),a=Math.pow(2,52),s=2*a,u=n-1,c=Math.random;function f(e){var t,r=e.length,i=this,o=0,a=i.i=i.j=0,s=i.S=[];for(r||(e=[r++]);o<n;)s[o]=o++;for(o=0;o<n;o++)s[o]=s[a=u&a+e[o%r]+(t=s[o])],s[a]=t;(i.g=function(e){for(var t,r=0,o=i.i,a=i.j,s=i.S;e--;)t=s[o=u&o+1],r=r*n+s[u&(s[o]=s[a=u&a+t])+(s[a]=t)];return i.i=o,i.j=a,r})(n)}function l(e,t){for(var n,r=e+"",i=0;i<r.length;)t[u&i]=u&(n^=19*t[u&i])+r.charCodeAt(i++);return d(t)}function d(e){return String.fromCharCode.apply(0,e)}t.exports=function(e,u){if(u&&!0===u.global)return u.global=!1,Math.random=t.exports(e,u),u.global=!0,Math.random;var c=[],p=(l(function e(t,n){var r,i=[],o=(typeof t)[0];if(n&&"o"==o)for(r in t)try{i.push(e(t[r],n-1))}catch(e){}return i.length?i:"s"==o?t:t+"\0"}(u&&u.entropy||!1?[e,d(r)]:0 in arguments?e:function(e){try{return i.crypto.getRandomValues(e=new Uint8Array(n)),d(e)}catch(e){return[+new Date,i,i.navigator&&i.navigator.plugins,i.screen,d(r)]}}(),3),c),new f(c));return l(d(p.S),r),function(){for(var e=p.g(6),t=o,r=0;e<a;)e=(e+r)*n,t*=n,r=p.g(1);for(;e>=s;)e/=2,t/=2,r>>>=1;return(e+r)/t}},t.exports.resetGlobal=function(){Math.random=c},l(Math.random(),r)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],61:[function(e,t,n){!function(){"use strict";var e=.5*(Math.sqrt(3)-1),r=(3-Math.sqrt(3))/6,i=1/6,o=(Math.sqrt(5)-1)/4,a=(5-Math.sqrt(5))/20;function s(e){var t;t="function"==typeof e?e:e?function(){var e=0,t=0,n=0,r=1,i=(o=4022871197,function(e){e=e.toString();for(var t=0;t<e.length;t++){var n=.02519603282416938*(o+=e.charCodeAt(t));n-=o=n>>>0,o=(n*=o)>>>0,o+=4294967296*(n-=o)}return 2.3283064365386963e-10*(o>>>0)});var o;e=i(" "),t=i(" "),n=i(" ");for(var a=0;a<arguments.length;a++)(e-=i(arguments[a]))<0&&(e+=1),(t-=i(arguments[a]))<0&&(t+=1),(n-=i(arguments[a]))<0&&(n+=1);return i=null,function(){var i=2091639*e+2.3283064365386963e-10*r;return e=t,t=n,n=i-(r=0|i)}}(e):Math.random,this.p=u(t),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var n=0;n<512;n++)this.perm[n]=this.p[255&n],this.permMod12[n]=this.perm[n]%12}function u(e){var t,n=new Uint8Array(256);for(t=0;t<256;t++)n[t]=t;for(t=0;t<255;t++){var r=t+~~(e()*(256-t)),i=n[t];n[t]=n[r],n[r]=i}return n}s.prototype={grad3:new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),grad4:new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),noise2D:function(t,n){var i,o,a=this.permMod12,s=this.perm,u=this.grad3,c=0,f=0,l=0,d=(t+n)*e,p=Math.floor(t+d),h=Math.floor(n+d),m=(p+h)*r,g=t-(p-m),v=n-(h-m);g>v?(i=1,o=0):(i=0,o=1);var b=g-i+r,y=v-o+r,_=g-1+2*r,w=v-1+2*r,x=255&p,k=255&h,A=.5-g*g-v*v;if(A>=0){var E=3*a[x+s[k]];c=(A*=A)*A*(u[E]*g+u[E+1]*v)}var C=.5-b*b-y*y;if(C>=0){var S=3*a[x+i+s[k+o]];f=(C*=C)*C*(u[S]*b+u[S+1]*y)}var T=.5-_*_-w*w;if(T>=0){var O=3*a[x+1+s[k+1]];l=(T*=T)*T*(u[O]*_+u[O+1]*w)}return 70*(c+f+l)},noise3D:function(e,t,n){var r,o,a,s,u,c,f,l,d,p,h=this.permMod12,m=this.perm,g=this.grad3,v=(e+t+n)*(1/3),b=Math.floor(e+v),y=Math.floor(t+v),_=Math.floor(n+v),w=(b+y+_)*i,x=e-(b-w),k=t-(y-w),A=n-(_-w);x>=k?k>=A?(u=1,c=0,f=0,l=1,d=1,p=0):x>=A?(u=1,c=0,f=0,l=1,d=0,p=1):(u=0,c=0,f=1,l=1,d=0,p=1):k<A?(u=0,c=0,f=1,l=0,d=1,p=1):x<A?(u=0,c=1,f=0,l=0,d=1,p=1):(u=0,c=1,f=0,l=1,d=1,p=0);var E=x-u+i,C=k-c+i,S=A-f+i,T=x-l+2*i,O=k-d+2*i,D=A-p+2*i,M=x-1+.5,P=k-1+.5,F=A-1+.5,j=255&b,z=255&y,R=255&_,B=.6-x*x-k*k-A*A;if(B<0)r=0;else{var L=3*h[j+m[z+m[R]]];r=(B*=B)*B*(g[L]*x+g[L+1]*k+g[L+2]*A)}var I=.6-E*E-C*C-S*S;if(I<0)o=0;else{var N=3*h[j+u+m[z+c+m[R+f]]];o=(I*=I)*I*(g[N]*E+g[N+1]*C+g[N+2]*S)}var H=.6-T*T-O*O-D*D;if(H<0)a=0;else{var U=3*h[j+l+m[z+d+m[R+p]]];a=(H*=H)*H*(g[U]*T+g[U+1]*O+g[U+2]*D)}var V=.6-M*M-P*P-F*F;if(V<0)s=0;else{var G=3*h[j+1+m[z+1+m[R+1]]];s=(V*=V)*V*(g[G]*M+g[G+1]*P+g[G+2]*F)}return 32*(r+o+a+s)},noise4D:function(e,t,n,r){var i,s,u,c,f,l,d,p,h,m,g,v,b,y,_,w,x,k=this.perm,A=this.grad4,E=(e+t+n+r)*o,C=Math.floor(e+E),S=Math.floor(t+E),T=Math.floor(n+E),O=Math.floor(r+E),D=(C+S+T+O)*a,M=e-(C-D),P=t-(S-D),F=n-(T-D),j=r-(O-D),z=0,R=0,B=0,L=0;M>P?z++:R++,M>F?z++:B++,M>j?z++:L++,P>F?R++:B++,P>j?R++:L++,F>j?B++:L++;var I=M-(l=z>=3?1:0)+a,N=P-(d=R>=3?1:0)+a,H=F-(p=B>=3?1:0)+a,U=j-(h=L>=3?1:0)+a,V=M-(m=z>=2?1:0)+2*a,G=P-(g=R>=2?1:0)+2*a,W=F-(v=B>=2?1:0)+2*a,q=j-(b=L>=2?1:0)+2*a,Y=M-(y=z>=1?1:0)+3*a,Q=P-(_=R>=1?1:0)+3*a,X=F-(w=B>=1?1:0)+3*a,K=j-(x=L>=1?1:0)+3*a,J=M-1+4*a,Z=P-1+4*a,$=F-1+4*a,ee=j-1+4*a,te=255&C,ne=255&S,re=255&T,ie=255&O,oe=.6-M*M-P*P-F*F-j*j;if(oe<0)i=0;else{var ae=k[te+k[ne+k[re+k[ie]]]]%32*4;i=(oe*=oe)*oe*(A[ae]*M+A[ae+1]*P+A[ae+2]*F+A[ae+3]*j)}var se=.6-I*I-N*N-H*H-U*U;if(se<0)s=0;else{var ue=k[te+l+k[ne+d+k[re+p+k[ie+h]]]]%32*4;s=(se*=se)*se*(A[ue]*I+A[ue+1]*N+A[ue+2]*H+A[ue+3]*U)}var ce=.6-V*V-G*G-W*W-q*q;if(ce<0)u=0;else{var fe=k[te+m+k[ne+g+k[re+v+k[ie+b]]]]%32*4;u=(ce*=ce)*ce*(A[fe]*V+A[fe+1]*G+A[fe+2]*W+A[fe+3]*q)}var le=.6-Y*Y-Q*Q-X*X-K*K;if(le<0)c=0;else{var de=k[te+y+k[ne+_+k[re+w+k[ie+x]]]]%32*4;c=(le*=le)*le*(A[de]*Y+A[de+1]*Q+A[de+2]*X+A[de+3]*K)}var pe=.6-J*J-Z*Z-$*$-ee*ee;if(pe<0)f=0;else{var he=k[te+1+k[ne+1+k[re+1+k[ie+1]]]]%32*4;f=(pe*=pe)*pe*(A[he]*J+A[he+1]*Z+A[he+2]*$+A[he+3]*ee)}return 27*(i+s+u+c+f)}},s._buildPermutationTable=u,"undefined"!=typeof define&&define.amd&&define(function(){return s}),void 0!==n?n.SimplexNoise=s:"undefined"!=typeof window&&(window.SimplexNoise=s),void 0!==t&&(t.exports=s)}()},{}],62:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;n.default=class{constructor(e=1,t=1,n,r){this.width=e,this.height=t,this.widthSegments=n,this.heightSegments=r,this.calculateAttributes()}calculateAttributes(){const e=Math.floor(this.widthSegments)||1,t=Math.floor(this.heightSegments)||1,n=this.widthSegments+1,r=this.heightSegments+1,i=this.width/e,o=this.height/t;let a,s;for(this.cells=[],this.positions=[],this.normals=[],this.uvs=[],a=0;a<n;a++){const n=a*i-this.width/2;for(s=0;s<r;s++)this.positions.push([n,-(s*o-this.height/2),0]),this.normals.push(0,0,1),this.uvs.push(a/e),this.uvs.push(1-s/t)}for(a=0;a<e;a++)for(s=0;s<t;s++){const e=a+n*(s+1),t=a+1+n*(s+1),r=a+1+n*s;this.cells.push(a+n*s,e,r),this.cells.push(e,t,r)}}}},{}],63:[function(e,t,n){"use strict";function r(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");let n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}Object.defineProperty(n,"__esModule",{value:!0}),n.getParameterByName=r,n.getParameterByNameInt=function(e,t){const n=r(e,t);if(!n)return;return parseInt(n)},n.replaceUrlParam=function(e,t,n){null==n&&(n="");var r=new RegExp("\\b("+t+"=).*?(&|#|$)");if(e.search(r)>=0)return e.replace(r,"$1"+n+"$2");return(e=e.replace(/[?#]$/,""))+(e.indexOf("?")>0?"&":"?")+t+"="+n}},{}],64:[function(e,t,n){"use strict";var r=d(e("canvas-sketch")),i=d(e("regl")),o=d(e("gl-mat4")),a=d(e("glsl-solid-wireframe")),s=e("canvas-sketch-util"),u=d(e("lodash/chunk")),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(e("dat.gui")),f=d(e("./Grid")),l=e("./browser");function d(e){return e&&e.__esModule?e:{default:e}}const p=e("glslify"),h=new c.GUI,m={backgroundColor:[0,0,51],meshColor:[153,25,153],lineThickness:.5,isSameAsBackgroundColor:!1,inverse:!0,fogDistance:[0,140],displacement:6},g=(e,t)=>m[t]=e,v=e=>e.map(e=>s.math.mapRange(e,0,255,0,1)),b={big:160,medium:40,small:10};let y=(0,l.getParameterByName)("size",window.location.href);y=y&&y.length>0&&b.hasOwnProperty(y)?y:"big",h.add({size:y},"size",[...Object.keys(b)]).name("Size (   PAGE REFRESH!)").onChange(e=>{window.location.href=(0,l.replaceUrlParam)(window.location.href,"size",e)}),h.addColor(m,"backgroundColor").onChange(e=>{g(e,"backgroundColor")}),h.addColor(m,"meshColor").onChange(e=>{g(e,"meshColor")}),h.add(m,"displacement").min(1).max(20).onChange(e=>{g(e,"displacement")}),h.add(m,"lineThickness").min(.1).max(3.5).onChange(e=>{g(e,"lineThickness")});const _=p(['    \n    precision highp float;\n#define GLSLIFY 1\n\n\n    uniform mat4 uProjection, uView, uRotate;\n    uniform float uTime;\n    uniform vec3 uEye;\n    uniform float uDisplacement;\n    \n    attribute vec3 aPosition;\n    attribute vec2 aUv;\n    attribute vec2 aBarycentric;\n    attribute vec3 aNormal;\n\n    varying vec2 vB;\n    // varying float vNoise;\n    varying vec3 vDisplacementZ;\n    varying float vDistanceFromEye;\n\n    //\n// GLSL textureless classic 4D noise "cnoise",\n// with an RSL-style periodic variant "pnoise".\n// Author:  Stefan Gustavson (stefan.gustavson@liu.se)\n// Version: 2011-08-22\n//\n// Many thanks to Ian McEwan of Ashima Arts for the\n// ideas for permutation and gradient selection.\n//\n// Copyright (c) 2011 Stefan Gustavson. All rights reserved.\n// Distributed under the MIT license. See LICENSE file.\n// https://github.com/ashima/webgl-noise\n//\n\nvec4 mod289(vec4 x)\n{\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute(vec4 x)\n{\n  return mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nvec4 fade(vec4 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\n// Classic Perlin noise\nfloat cnoise(vec4 P)\n{\n  vec4 Pi0 = floor(P); // Integer part for indexing\n  vec4 Pi1 = Pi0 + 1.0; // Integer part + 1\n  Pi0 = mod289(Pi0);\n  Pi1 = mod289(Pi1);\n  vec4 Pf0 = fract(P); // Fractional part for interpolation\n  vec4 Pf1 = Pf0 - 1.0; // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = vec4(Pi0.zzzz);\n  vec4 iz1 = vec4(Pi1.zzzz);\n  vec4 iw0 = vec4(Pi0.wwww);\n  vec4 iw1 = vec4(Pi1.wwww);\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n  vec4 ixy00 = permute(ixy0 + iw0);\n  vec4 ixy01 = permute(ixy0 + iw1);\n  vec4 ixy10 = permute(ixy1 + iw0);\n  vec4 ixy11 = permute(ixy1 + iw1);\n\n  vec4 gx00 = ixy00 * (1.0 / 7.0);\n  vec4 gy00 = floor(gx00) * (1.0 / 7.0);\n  vec4 gz00 = floor(gy00) * (1.0 / 6.0);\n  gx00 = fract(gx00) - 0.5;\n  gy00 = fract(gy00) - 0.5;\n  gz00 = fract(gz00) - 0.5;\n  vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);\n  vec4 sw00 = step(gw00, vec4(0.0));\n  gx00 -= sw00 * (step(0.0, gx00) - 0.5);\n  gy00 -= sw00 * (step(0.0, gy00) - 0.5);\n\n  vec4 gx01 = ixy01 * (1.0 / 7.0);\n  vec4 gy01 = floor(gx01) * (1.0 / 7.0);\n  vec4 gz01 = floor(gy01) * (1.0 / 6.0);\n  gx01 = fract(gx01) - 0.5;\n  gy01 = fract(gy01) - 0.5;\n  gz01 = fract(gz01) - 0.5;\n  vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);\n  vec4 sw01 = step(gw01, vec4(0.0));\n  gx01 -= sw01 * (step(0.0, gx01) - 0.5);\n  gy01 -= sw01 * (step(0.0, gy01) - 0.5);\n\n  vec4 gx10 = ixy10 * (1.0 / 7.0);\n  vec4 gy10 = floor(gx10) * (1.0 / 7.0);\n  vec4 gz10 = floor(gy10) * (1.0 / 6.0);\n  gx10 = fract(gx10) - 0.5;\n  gy10 = fract(gy10) - 0.5;\n  gz10 = fract(gz10) - 0.5;\n  vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);\n  vec4 sw10 = step(gw10, vec4(0.0));\n  gx10 -= sw10 * (step(0.0, gx10) - 0.5);\n  gy10 -= sw10 * (step(0.0, gy10) - 0.5);\n\n  vec4 gx11 = ixy11 * (1.0 / 7.0);\n  vec4 gy11 = floor(gx11) * (1.0 / 7.0);\n  vec4 gz11 = floor(gy11) * (1.0 / 6.0);\n  gx11 = fract(gx11) - 0.5;\n  gy11 = fract(gy11) - 0.5;\n  gz11 = fract(gz11) - 0.5;\n  vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);\n  vec4 sw11 = step(gw11, vec4(0.0));\n  gx11 -= sw11 * (step(0.0, gx11) - 0.5);\n  gy11 -= sw11 * (step(0.0, gy11) - 0.5);\n\n  vec4 g0000 = vec4(gx00.x,gy00.x,gz00.x,gw00.x);\n  vec4 g1000 = vec4(gx00.y,gy00.y,gz00.y,gw00.y);\n  vec4 g0100 = vec4(gx00.z,gy00.z,gz00.z,gw00.z);\n  vec4 g1100 = vec4(gx00.w,gy00.w,gz00.w,gw00.w);\n  vec4 g0010 = vec4(gx10.x,gy10.x,gz10.x,gw10.x);\n  vec4 g1010 = vec4(gx10.y,gy10.y,gz10.y,gw10.y);\n  vec4 g0110 = vec4(gx10.z,gy10.z,gz10.z,gw10.z);\n  vec4 g1110 = vec4(gx10.w,gy10.w,gz10.w,gw10.w);\n  vec4 g0001 = vec4(gx01.x,gy01.x,gz01.x,gw01.x);\n  vec4 g1001 = vec4(gx01.y,gy01.y,gz01.y,gw01.y);\n  vec4 g0101 = vec4(gx01.z,gy01.z,gz01.z,gw01.z);\n  vec4 g1101 = vec4(gx01.w,gy01.w,gz01.w,gw01.w);\n  vec4 g0011 = vec4(gx11.x,gy11.x,gz11.x,gw11.x);\n  vec4 g1011 = vec4(gx11.y,gy11.y,gz11.y,gw11.y);\n  vec4 g0111 = vec4(gx11.z,gy11.z,gz11.z,gw11.z);\n  vec4 g1111 = vec4(gx11.w,gy11.w,gz11.w,gw11.w);\n\n  vec4 norm00 = taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));\n  g0000 *= norm00.x;\n  g0100 *= norm00.y;\n  g1000 *= norm00.z;\n  g1100 *= norm00.w;\n\n  vec4 norm01 = taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));\n  g0001 *= norm01.x;\n  g0101 *= norm01.y;\n  g1001 *= norm01.z;\n  g1101 *= norm01.w;\n\n  vec4 norm10 = taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));\n  g0010 *= norm10.x;\n  g0110 *= norm10.y;\n  g1010 *= norm10.z;\n  g1110 *= norm10.w;\n\n  vec4 norm11 = taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));\n  g0011 *= norm11.x;\n  g0111 *= norm11.y;\n  g1011 *= norm11.z;\n  g1111 *= norm11.w;\n\n  float n0000 = dot(g0000, Pf0);\n  float n1000 = dot(g1000, vec4(Pf1.x, Pf0.yzw));\n  float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.zw));\n  float n1100 = dot(g1100, vec4(Pf1.xy, Pf0.zw));\n  float n0010 = dot(g0010, vec4(Pf0.xy, Pf1.z, Pf0.w));\n  float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));\n  float n0110 = dot(g0110, vec4(Pf0.x, Pf1.yz, Pf0.w));\n  float n1110 = dot(g1110, vec4(Pf1.xyz, Pf0.w));\n  float n0001 = dot(g0001, vec4(Pf0.xyz, Pf1.w));\n  float n1001 = dot(g1001, vec4(Pf1.x, Pf0.yz, Pf1.w));\n  float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));\n  float n1101 = dot(g1101, vec4(Pf1.xy, Pf0.z, Pf1.w));\n  float n0011 = dot(g0011, vec4(Pf0.xy, Pf1.zw));\n  float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.zw));\n  float n0111 = dot(g0111, vec4(Pf0.x, Pf1.yzw));\n  float n1111 = dot(g1111, Pf1);\n\n  vec4 fade_xyzw = fade(Pf0);\n  vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);\n  vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);\n  vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);\n  vec2 n_yzw = mix(n_zw.xy, n_zw.zw, fade_xyzw.y);\n  float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);\n  return 2.2 * n_xyzw;\n}\n\n    \n\n    void main () {\n        float r = cnoise(vec4(0.05 * aPosition + vec3(uTime ), vec3( 100. )));\n        mat4 modelView = uProjection * uView;\n        vec3 scaledNormal = aNormal * uDisplacement;\n        vec3 displacement = aPosition + scaledNormal * cnoise(vec4(aPosition, uTime)) * r;\n\n        vB = aBarycentric;\n        vDisplacementZ = displacement;\n        vDistanceFromEye = distance(vec3(uProjection * vec4(aPosition, 1.)), uEye);\n\n        gl_Position = modelView * uRotate * vec4(displacement, 1.);\n    }\n',""]),w=p(["\n    precision highp float;\n    #extension GL_OES_standard_derivatives : enable\n#define GLSLIFY 1\n\n\n    uniform vec3 uBackgroundColor;\n    uniform vec3 uMeshColor;\n    uniform float uLineThickness;\n    uniform bool uIsSameAsBackgroundColor;\n    uniform bool uInverse;\n    uniform vec2 uFogDist;\n\n    varying vec2 vB;\n    varying float vNoise;\n    varying vec3 vDisplacementZ;\n    varying float vDistanceFromEye;\n\n    // #pragma glslify: grid = require(glsl-solid-wireframe/barycentric/scaled)\n    // http://codeflow.org/entries/2012/aug/02/easy-wireframe-display-with-barycentric-coordinates/\n    float _gridFactor (vec2 vBC, float width, float feather) {\n        float w1 = width - feather * 0.5;\n        vec3 bary = vec3(vBC.x, vBC.y, 1.0 - vBC.x - vBC.y);\n        vec3 d = fwidth(bary);\n        vec3 a3 = smoothstep(d * w1, d * (w1 + feather), bary);\n        return min(min(a3.x, a3.y), a3.z);\n    }\n    \n    void main () {\n        vec3 wireColor;\n        if (uIsSameAsBackgroundColor) {\n            wireColor = uBackgroundColor;\n        } else {\n            wireColor = uMeshColor;\n        }\n        \n        if(uInverse) {\n            wireColor *= mix(uBackgroundColor, wireColor * vec3(vDisplacementZ.z * 10.), vec3(vDisplacementZ.z));\n        } else {\n            wireColor *= mix(wireColor * vec3(vDisplacementZ.z * 10.), uBackgroundColor, vec3(vDisplacementZ.z));\n        }\n        \n        vec3 finalGrid = mix(\n            wireColor, \n            uBackgroundColor, \n            vec3(_gridFactor(vB, uLineThickness, .5))\n        );\n\n        // FOG\n        float fogFactor = clamp((uFogDist.y - vDistanceFromEye) / uFogDist.y - uFogDist.x, 0.0, 1.0);\n\n        vec3 color = mix(uBackgroundColor, finalGrid, fogFactor);\n        \n        gl_FragColor = vec4(color, 1.);\n    }\n",""]);(0,r.default)(({gl:e})=>{const{isSameAsBackgroundColor:t,inverse:n,fogDistance:r}=m,c=(0,i.default)({gl:e,extensions:["OES_standard_derivatives"]}),l=new f.default(150,100,b[y],b[y]),{barycentric:d}=(0,a.default)({positions:l.positions,cells:(0,u.default)(l.cells,3)}),p=c({vert:_,frag:w,attributes:{aPosition:l.positions,aUv:l.uvs,aBarycentric:d,aNormal:l.normals},elements:l.cells,uniforms:{uView:(e,{eye:t})=>o.default.lookAt([],t,[0,0,0],[0,1,0]),uProjection:({viewportWidth:e,viewportHeight:t})=>o.default.perspective([],Math.PI/4,e/t,.01,1e3),uRotate:()=>{const e=o.default.create();return o.default.rotateX(e,e,s.math.degToRad(70)),e},uTime:(e,{time:t})=>t,uDisplacement:(e,{displacement:t})=>t,uFogDist:r,uEye:(e,{eye:t})=>new Float32Array(t),uBackgroundColor:(e,{backgroundColor:t})=>new Float32Array(t),uMeshColor:(e,{meshColor:t})=>new Float32Array(t),uLineThickness:(e,{lineThickness:t})=>t,uInverse:n,uIsSameAsBackgroundColor:t},depth:{enable:!0}});return({time:e})=>{const{meshColor:t,backgroundColor:n,displacement:r,lineThickness:i}=m;c.poll(),c.clear({color:[...v(n),1],depth:1}),p({time:.5*e,eye:[40*Math.cos(.5*e),5*Math.sin(e),-70],backgroundColor:v(n),meshColor:v(t),displacement:r,lineThickness:i})}},{context:"webgl",attributes:{antialias:!0},animate:!0})},{"./Grid":62,"./browser":63,"canvas-sketch":4,"canvas-sketch-util":1,"dat.gui":6,"gl-mat4":23,"glsl-solid-wireframe":38,glslify:65,"lodash/chunk":48,regl:59}],65:[function(e,t,n){t.exports=function(e){"string"==typeof e&&(e=[e]);for(var t=[].slice.call(arguments,1),n=[],r=0;r<e.length-1;r++)n.push(e[r],t[r]||"");return n.push(e[r]),n.join("")}},{}]},{},[64]);